{
  super.paintComponent(g);
  BaseXLayout.antiAlias(g,gui.prop);
  g.setFont(GUIConstants.font);
  final Performance perf=new Performance();
  perf.initTimer();
  fontHeight=g.getFontMetrics().getHeight();
  if (nodeHeight == -1)   nodeHeight=fontHeight;
  setLevelDistance();
  if (windowSizeChanged()) {
    if (markedImage != null) {
      markedImage=null;
      refreshedMark=true;
    }
    focusedRect=null;
    treeImage=createImage();
    final Graphics tIg=treeImage.getGraphics();
    if (rectsPerLevel == null) {
      rectsPerLevel=new ArrayList<ArrayList<TreeRect>>();
    }
 else {
      rectsPerLevel.clear();
    }
    final Nodes curr=gui.context.current();
    for (int i=0; i < curr.size(); i++) {
      treeView(curr.nodes[i],tIg);
    }
  }
  g.drawImage(treeImage,0,0,getWidth(),getHeight(),this);
  if (refreshedMark)   markNodes();
  if (markedImage != null)   g.drawImage(markedImage,0,0,getWidth(),getHeight(),this);
  if (focus()) {
    highlightNode(g,markColor,focusedRect,focusedRectLevel,showParentNode,showChildNodes);
  }
}
