{
  final FTPos tmp=ctx.ftpos;
  return new FTNodeIter(){
    @Override public FTNodeItem next() throws XQException {
      ctx.ftpos=pos;
      pos.init(ctx.ftitem);
      FTNodeItem it=expr[0].iter(ctx).next();
      if (ctx.ftpos != null) {
        if (it.ftn.size > 0) {
          init(it);
          while (!posFilter()) {
            it=expr[0].iter(ctx).next();
            if (it.ftn.size == 0) {
              ctx.ftpos=tmp;
              return it;
            }
            init(it);
          }
        }
      }
      final double d=checkDbl(ctx.iter(weight));
      if (d < 0 || d > 1000)       Err.or(FTWEIGHT,d);
      if (d != -1)       it.score(it.score() * d);
      ctx.ftpos=tmp;
      return it;
    }
    /** 
 * Init FTPos for next seqEval with index use.
 * @param it current FTNode 
 */
    void init(    final FTNodeItem it){
      pos.setPos(it.ftn.convertPos(),it.ftn.p.list[0]);
      if (it.ftn.getToken() != null) {
        pos.ft.init(it.data.text(it.ftn.getPre()));
        pos.term=pos.ft.getTokenList();
      }
    }
    /** 
 * Evaluates the position filters.
 * @return result of check
 * @throws XQException query exception
 */
    boolean posFilter() throws XQException {
      if (!pos.valid())       return false;
      if (pos.dunit != null) {
        final long mn=checkItr(ctx.iter(dist[0]));
        final long mx=checkItr(ctx.iter(dist[1]));
        if (!pos.distance(mn,mx))         return false;
      }
      if (pos.wunit != null) {
        final long c=checkItr(ctx.iter(window));
        if (!pos.window(c))         return false;
      }
      return true;
    }
  }
;
}
