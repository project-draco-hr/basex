{
  final int s=sta != null ? Integer.valueOf(sta) : 0;
  final int m=cnt != null ? Integer.valueOf(cnt) : Integer.MAX_VALUE - s;
  final boolean surround=sur != null && Boolean.parseBoolean(sur);
  final String xquery=query != null ? query : ".";
  XMLSerializer xml=null;
  QueryProcessor proc=null;
  try {
    xml=new XMLSerializer(out,surround,true);
    proc=new QueryProcessor(xquery,ctx);
    final Iter iter=proc.iter();
    for (int c=0; c < s + m; c++) {
      final Item it=iter.next();
      if (it == null)       break;
      if (c < s)       continue;
      xml.openResult();
      it.serialize(xml);
      xml.closeResult();
    }
  }
 catch (  final Exception ex) {
    throw new WebApplicationException(ex);
  }
 finally {
    try {
      if (xml != null)       xml.close();
    }
 catch (    final Exception ex) {
    }
    try {
      if (proc != null)       proc.close();
    }
 catch (    final Exception ex) {
    }
  }
}
