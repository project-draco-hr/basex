{
  final String xquery=query != null ? query : ".";
  final int s=start != null ? Integer.valueOf(start) : 0;
  final int m=count != null ? Integer.valueOf(count) : Integer.MAX_VALUE - s;
  final Properties props=new Properties();
  if (wrap != null && Boolean.parseBoolean(wrap)) {
    props.setProperty("wrap-prefix",JAXRX);
    props.setProperty("wrap-uri",URL);
  }
  if (serialize != null) {
    for (    final String ser : serialize.split(",")) {
      final String[] sprop=ser.split("=");
      if (sprop.length == 2)       props.setProperty(sprop[0],sprop[1]);
    }
  }
  QueryProcessor proc=null;
  try {
    XMLSerializer xml=new XMLSerializer(out,props);
    proc=new QueryProcessor(xquery,ctx);
    final Iter iter=proc.iter();
    for (int c=0; c < s + m; c++) {
      final Item it=iter.next();
      if (it == null)       break;
      if (c < s)       continue;
      xml.openResult();
      it.serialize(xml);
      xml.closeResult();
    }
    xml.close();
  }
 catch (  final Exception ex) {
    throw new WebApplicationException(ex);
  }
 finally {
    try {
      if (proc != null)       proc.close();
    }
 catch (    final Exception ex) {
    }
  }
}
