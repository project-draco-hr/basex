{
  String mt;
  final byte[] contTypeHdr=request.headers.get(lc(token(CONTENT_TYPE)));
  if (contTypeHdr != null) {
    mt=string(contTypeHdr);
  }
 else {
    mt=string(request.payloadAttrs.get(MEDIA_TYPE));
    if (request.isMultipart) {
      final byte[] b=request.payloadAttrs.get(BOUNDARY);
      mt=new TokenBuilder().add(mt).add("; ").add(BOUNDARY).add('=').add(b != null ? b : DEFAULT_BOUND).toString();
    }
  }
  conn.setRequestProperty(CONTENT_TYPE,mt);
}
