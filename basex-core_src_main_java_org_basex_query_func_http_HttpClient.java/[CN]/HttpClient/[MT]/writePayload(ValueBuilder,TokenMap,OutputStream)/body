{
  final byte[] m=payloadAtts.get(METHOD);
  final String method;
  if (m == null) {
    final byte[] tp=payloadAtts.get(MEDIA_TYPE);
    final String type=tp == null ? "" : string(tp);
    if (eq(type,APP_HTML_XML)) {
      method=SerialMethod.XHTML.toString();
    }
 else     if (eq(type,TEXT_HTML)) {
      method=SerialMethod.HTML.toString();
    }
 else     if (isXML(type)) {
      method=SerialMethod.XML.toString();
    }
 else     if (isText(type)) {
      method=SerialMethod.TEXT.toString();
    }
 else {
      method=SerialMethod.XML.toString();
    }
  }
 else {
    method=string(m);
  }
  final byte[] src=payloadAtts.get(SRC);
  if (src == null) {
    write(payload,payloadAtts,method,out);
  }
 else {
    final IOUrl io=new IOUrl(string(src));
    if (eq(method,BINARY)) {
      out.write(io.read());
    }
 else {
      final ValueBuilder vb=new ValueBuilder().add(Str.get(new TextInput(io).content()));
      write(vb,payloadAtts,method,out);
    }
  }
}
