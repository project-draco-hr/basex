{
  if (gui.updating || opened == null)   return;
  super.keyPressed(e);
  int focus=focusedPos == -1 ? 0 : focusedPos;
  if (gui.context.focused == -1)   gui.context.focused=0;
  final int focusPre=gui.context.focused;
  final Data data=gui.context.data;
  int kind=data.kind(focusPre);
  int key=e.getKeyCode();
  final boolean fs=data.fs != null;
  if (key == KeyEvent.VK_RIGHT || key == KeyEvent.VK_LEFT) {
    final boolean open=key == KeyEvent.VK_RIGHT;
    if (e.isShiftDown()) {
      opened[focusPre]=open;
      final int s=data.meta.size;
      for (int pre=focusPre + (fs ? data.attSize(focusPre,kind) : 1); pre != s && data.parent(pre,data.kind(pre)) >= focusPre; pre+=fs ? data.attSize(pre,kind) : 1) {
        opened[pre]=open;
        kind=data.kind(pre);
      }
      refreshHeight();
      repaint();
      return;
    }
    if (open ^ opened[focusPre] && (!ViewData.isLeaf(gui.prop,data,focusPre) || data.attSize(focusPre,kind) > 1)) {
      opened[focusPre]=open;
      refreshHeight();
      repaint();
    }
 else {
      key=open ? KeyEvent.VK_DOWN : KeyEvent.VK_UP;
    }
  }
  if (key == KeyEvent.VK_DOWN) {
    focus=Math.min(data.meta.size - 1,focus + 1);
  }
 else   if (key == KeyEvent.VK_UP) {
    focus=Math.max(0,focus - 1);
  }
 else   if (key == KeyEvent.VK_PAGE_DOWN) {
    focus=Math.min(data.meta.size - 1,focus + getHeight() / lineH);
  }
 else   if (key == KeyEvent.VK_PAGE_UP) {
    focus=Math.max(0,focus - getHeight() / lineH);
  }
 else   if (key == KeyEvent.VK_HOME) {
    focus=0;
  }
 else   if (key == KeyEvent.VK_END) {
    focus=data.meta.size - 1;
  }
  if (focus == focusedPos)   return;
  gui.context.focused=-1;
  final Nodes curr=gui.context.current;
  int pre=curr.nodes[0];
  final FolderIterator it=new FolderIterator(this);
  while (it.more() && focus-- != 0)   pre=it.pre;
  if (pre == curr.nodes[0] && key == KeyEvent.VK_DOWN)   pre++;
  gui.notify.focus(pre,this);
  jumpTo(pre,false);
  repaint();
}
