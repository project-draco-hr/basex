{
  ImageIcon icon=null;
  String msg="";
  try {
    if (BUTTONSTASERV.equals(cmd)) {
      final int p=Integer.parseInt(ports.getText());
      ctx.prop.set(Prop.PORT,p);
      ctx.prop.set(Prop.SERVERPORT,p);
      portc.setText(ports.getText());
      final String path=IOFile.file(getClass().getProtectionDomain().getCodeSource().getLocation().toString());
      final String mem="-Xmx" + Runtime.getRuntime().maxMemory();
      final String clazz=org.basex.BaseXServer.class.getName();
      new ProcessBuilder(new String[]{"java",mem,"-cp",path,clazz,"-p",String.valueOf(p)}).start();
      running=ping(true);
    }
 else     if (BUTTONSTOSERV.equals(cmd)) {
      new BaseXServer("stop");
      running=ping(true);
      connected=connected && ping(false);
    }
 else     if (BUTTONCONNECT.equals(cmd)) {
      gui.prop.set(GUIProp.SERVERUSER,loguser.getText());
      gui.prop.set(GUIProp.SERVERPASS,new String(logpass.getPassword()));
      ctx.prop.set(Prop.HOST,host.getText());
      ctx.prop.set(Prop.PORT,Integer.parseInt(portc.getText()));
      cs=new ClientSession(ctx,gui.prop.get(GUIProp.SERVERUSER),gui.prop.get(GUIProp.SERVERPASS));
      user.setCs(cs);
      connected=true;
    }
 else     if (BUTTONDISCONNECT.equals(cmd)) {
      cs.execute(new Exit());
      connected=false;
    }
 else     if (connected) {
      user.action(cmd);
    }
  }
 catch (  final IOException ex) {
    Main.debug(ex);
    if (ex instanceof BindException)     msg=SERVERBIND;
 else     if (ex instanceof LoginException)     msg=SERVERLOGIN;
 else     msg=ex.getMessage();
  }
  final boolean valp=portc.getText().matches("[\\d]+") && Integer.parseInt(portc.getText()) <= 65535;
  final boolean valpl=ports.getText().matches("[\\d]+") && Integer.parseInt(ports.getText()) <= 65535;
  final boolean vallu=loguser.getText().matches("[\\w]*");
  final boolean vallp=new String(logpass.getPassword()).matches("[\\w]*");
  final boolean valh=host.getText().matches("([\\w]+://)?[\\w.-]+");
  if (!msg.isEmpty()) {
    icon=BaseXLayout.icon("error");
  }
 else   if (!(valpl && valh && valp&& vallu&& vallp)) {
    icon=BaseXLayout.icon("warn");
    msg=(!valpl ? LOCAL + PORT : !valh ? HOST : !valp ? PORT : !vallu ? SERVERUSER : SERVERPW) + INVALID;
  }
  ports.setEnabled(!running);
  start.setEnabled(!running && valpl);
  stop.setEnabled(running);
  loguser.setEnabled(!connected);
  logpass.setEnabled(!connected);
  host.setEnabled(!connected);
  portc.setEnabled(!connected);
  connect.setEnabled(!connected && vallu && vallp&& valh&& valp&& !loguser.getText().isEmpty()&& logpass.getPassword().length != 0);
  disconnect.setEnabled(connected);
  tabs.setEnabledAt(1,connected);
  info.setText(msg);
  info.setIcon(icon);
  ctx.prop.write();
}
