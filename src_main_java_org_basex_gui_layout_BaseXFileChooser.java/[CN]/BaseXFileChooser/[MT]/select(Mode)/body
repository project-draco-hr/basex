{
  IOFile io=null;
  if (fd != null) {
    if (mode == Mode.FDOPEN)     fd.setFile(" ");
    fd.setMode(mode == Mode.FSAVE || mode == Mode.DSAVE ? FileDialog.SAVE : FileDialog.LOAD);
    fd.setVisible(true);
    final String f=fd.getFile();
    if (f == null)     return null;
    final String dir=fd.getDirectory();
    return new IOFile(mode == Mode.DOPEN || mode == Mode.DSAVE ? dir : dir + "/" + fd.getFile());
  }
  int state=0;
switch (mode) {
case FOPEN:
    state=fc.showOpenDialog(gui);
  break;
case FDOPEN:
fc.setFileSelectionMode(JFileChooser.FILES_AND_DIRECTORIES);
state=fc.showOpenDialog(gui);
break;
case FSAVE:
state=fc.showSaveDialog(gui);
break;
case DOPEN:
case DSAVE:
fc.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
state=fc.showDialog(gui,null);
break;
}
if (state != JFileChooser.APPROVE_OPTION) return null;
io=new IOFile(fc.getSelectedFile().getPath());
if (mode != Mode.FSAVE) return io;
if (suffix != null && io.path().indexOf(".") == -1) io=new IOFile(io.path() + suffix);
return !io.exists() || Dialog.confirm(gui,Util.info(FILE_EXISTS_X,io)) ? io : null;
}
