{
  final AxisIter parts=multipart.children();
  ANode part=null;
  while ((part=parts.next()) != null) {
    AxisIter partChildren=part.children();
    ANode child=null;
    TokenMap partHeaders=new TokenMap();
    ANode partContent=null;
    while ((child=partChildren.next()) != null) {
      if (eq(child.nname(),HEADER)) {
        final AxisIter attrs=child.atts();
        ANode attr=null;
        byte[] name=null;
        byte[] value=null;
        while ((attr=attrs.next()) != null) {
          if (eq(attr.nname(),HDR_NAME))           name=attr.atom();
          if (eq(attr.nname(),HDR_VALUE))           value=attr.atom();
          if (name != null && name.length != 0 && value != null && value.length != 0)           partHeaders.add(name,value);
        }
      }
 else       if (eq(child.nname(),BODY)) {
        partContent=child;
      }
    }
    writePart(partHeaders,partContent,out,contentAttrs.get(BOUNDARY));
  }
  out.write(new TokenBuilder().add("--".getBytes()).add(contentAttrs.get(BOUNDARY)).add("--").finish());
}
