{
  final Value oldVal=ctx.value;
  try {
    ctx.value=root(ctx);
    final Expr rt=root == null ? null : root.inline(ctx,scp,v,e);
    if (rt != null) {
      setRoot(ctx,rt);
      ctx.value=oldVal;
      ctx.value=root(ctx);
    }
    boolean change=rt != null;
    for (int i=0; i < steps.length; i++) {
      final Expr nw=steps[i].inline(ctx,scp,v,e);
      if (nw != null) {
        steps[i]=nw;
        change=true;
      }
    }
    return change ? optimize(ctx,scp) : null;
  }
  finally {
    ctx.value=oldVal;
  }
}
