{
  int ns=0;
  final int ts=text.size();
  final byte[] tt=text.text;
  boolean eq=true;
  for (int r=0; r < s; ++r) {
    final byte b=t[r];
    if (b < 4 || b >= ' ' || b == 0x09 || b == 0x0A)     t[ns++]=t[r];
    eq&=ns < ts && ns < s && t[ns] == tt[ns];
  }
  eq&=ns == ts;
  if (!eq) {
    text=new BaseXTextTokens(t,ns);
    rend.setText(text);
    scroll.pos(0);
  }
  if (undo != null)   undo.store(t.length != ns ? Arrays.copyOf(t,ns) : t,0);
  SwingUtilities.invokeLater(calc);
}
