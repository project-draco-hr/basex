{
  if (!consumeWS(TYPESWITCH,PAR1,TYPEPAR))   return null;
  check(PAR1);
  final Expr e=simple(check(expr(),NOTYPESWITCH));
  check(PAR2);
  Case[] cases={};
  Expr[] list={};
  while (consumeWS(CASE)) {
    final int s=ctx.vars.size();
    skipWS();
    QNm name=null;
    if (curr() == '$') {
      name=varName();
      check(AS);
    }
    final Var var=new Var(name,sequenceType(),false);
    if (name != null)     ctx.vars.add(var);
    check(RETURN);
    final Expr ret=check(single(),NOTYPESWITCH);
    list=add(list,ret);
    cases=Array.add(cases,new Case(var,ret));
    ctx.vars.reset(s);
  }
  if (cases.length == 0)   error(NOTYPESWITCH);
  check(DEFAULT);
  skipWS();
  final int s=ctx.vars.size();
  final QNm name=curr() == '$' ? varName() : null;
  final Var var=name != null ? new Var(name,null,false) : null;
  if (var != null)   ctx.vars.add(var);
  check(RETURN);
  final Expr ret=check(single(),NOTYPESWITCH);
  list=add(list,ret);
  updating(list);
  ctx.vars.reset(s);
  boolean em=true;
  for (  final Expr l : list)   em&=l.e();
  return em ? Seq.EMPTY : new TypeSwitch(e,cases,var,ret);
}
