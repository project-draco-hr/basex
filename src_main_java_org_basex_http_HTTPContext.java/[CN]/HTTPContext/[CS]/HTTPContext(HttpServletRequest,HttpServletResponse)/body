{
  req=rq;
  res=rs;
  final String mth=rq.getMethod();
  method=HTTPMethod.get(mth);
  final StringBuilder uri=new StringBuilder(req.getRequestURL());
  final String qs=req.getQueryString();
  if (qs != null)   uri.append('?').append(qs);
  log("[" + mth + "] "+ uri,null);
  res.setCharacterEncoding(UTF8);
  segments=toSegments(req.getPathInfo());
  path=join(0);
  final HTTPProp hp=hprop(context);
  user=hp.get(HTTPProp.USER);
  pass=hp.get(HTTPProp.PASSWORD);
  final String auth=req.getHeader(AUTHORIZATION);
  if (auth != null) {
    final String[] values=auth.split(" ");
    if (values[0].equals(BASIC)) {
      final String[] cred=Base64.decode(values[1]).split(":",2);
      if (cred.length != 2)       throw new LoginException(NOPASSWD);
      user=cred[0];
      pass=cred[1];
    }
 else {
      throw new LoginException(WHICHAUTH,values[0]);
    }
  }
}
