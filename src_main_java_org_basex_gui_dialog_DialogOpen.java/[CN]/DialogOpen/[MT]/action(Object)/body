{
  final Context ctx=gui.context;
  final String db=choice.getValue().trim();
  final String opendb=ctx.data != null ? ctx.data.meta.name : null;
  ok=true;
  if (refresh)   choice.setData(List.list(ctx).toArray());
  refresh=false;
  if (cmp == open) {
    close();
  }
 else   if (cmp == rename) {
    final DialogInput dr=new DialogInput(db,RENAMETITLE,gui,1);
    if (!dr.ok() || dr.input().equals(db))     return;
    final AlterDB cmd=new AlterDB(db,dr.input());
    if (cmd.run(ctx)) {
      gui.notify.init();
    }
 else {
      Dialog.error(gui,cmd.info());
    }
    choice.setData(List.list(ctx).toArray());
    action(null);
  }
 else   if (cmp == copy) {
    final DialogInput dc=new DialogInput(db,COPYTITLE,gui,2);
    if (!dc.ok() || dc.input().equals(db))     return;
    setCursor(GUIConstants.CURSORWAIT);
    DialogProgress.execute(this,"",new Copy(db,dc.input()));
    setCursor(GUIConstants.CURSORARROW);
    refresh=true;
  }
 else   if (cmp == drop) {
    if (db.isEmpty() || !Dialog.confirm(gui,Util.info(DROPCONF,db)))     return;
    if (db.equals(opendb)) {
      new Close().run(ctx);
      gui.notify.init();
    }
    DropDB.drop(db,ctx.prop);
    choice.setData(List.list(ctx).toArray());
    choice.requestFocusInWindow();
    if (choice.getValue().isEmpty()) {
      doc.setText("");
      detail.setText(Token.EMPTY);
    }
    action(null);
  }
 else   if (cmp == backup) {
    setCursor(GUIConstants.CURSORWAIT);
    DialogProgress.execute(this,"",new CreateBackup(db));
    setCursor(GUIConstants.CURSORARROW);
  }
 else   if (cmp == restore) {
    setCursor(GUIConstants.CURSORWAIT);
    if (db.equals(opendb)) {
      new Close().run(gui.context);
      gui.notify.init();
    }
    DialogProgress.execute(this,"",new Restore(db));
    setCursor(GUIConstants.CURSORARROW);
    if (db.equals(opendb)) {
      new Open(db).run(gui.context);
      gui.notify.init();
    }
  }
 else {
    ok=ctx.prop.dbexists(db);
    enableOK(buttons,BUTTONDROP,ok);
    if (ok) {
      doc.setText(db);
      DataInput in=null;
      final MetaData meta=new MetaData(db,ctx.prop);
      try {
        in=new DataInput(meta.file(DATAINFO));
        meta.read(in);
        detail.setText(InfoDB.db(meta,true,true,true));
      }
 catch (      final IOException ex) {
        detail.setText(Token.token(ex.getMessage()));
        ok=manage;
      }
 finally {
        if (in != null)         try {
          in.close();
        }
 catch (        final IOException ex) {
        }
      }
    }
    enableOK(buttons,BUTTONOPEN,ok);
    enableOK(buttons,BUTTONRENAME,ok);
    enableOK(buttons,BUTTONBACKUP,ok);
    enableOK(buttons,BUTTONCOPY,ok);
    enableOK(buttons,BUTTONRESTORE,ok && Restore.list(db,ctx).size() != 0);
  }
}
