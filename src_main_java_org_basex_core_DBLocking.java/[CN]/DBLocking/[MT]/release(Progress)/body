{
  final String[] objects=locked.remove(Thread.currentThread());
  if (null == objects)   throw new IllegalMonitorStateException("No locks held by current thread");
  for (  final String object : objects) {
    final ReentrantReadWriteLock lock=locks.get(object);
    if (lock.isWriteLockedByCurrentThread())     lock.writeLock().unlock();
 else     lock.readLock().unlock();
  }
  transactions.decrementAndGet();
synchronized (queue) {
    queue.notifyAll();
  }
}
