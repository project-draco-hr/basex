{
  boolean change=false, thisRound;
  do {
    thisRound=false;
    final ListIterator<Clause> iter=clauses.listIterator();
    while (iter.hasNext()) {
      final Clause c=iter.next();
      final int next=iter.nextIndex();
      if (c instanceof Let) {
        final Let lt=(Let)c;
        if (lt.expr.uses(Use.NDT))         continue;
        final VarUsage uses=count(lt.var,next);
        if (uses == VarUsage.NEVER) {
          ctx.compInfo(QueryText.OPTVAR,lt.var);
          iter.remove();
          change=true;
        }
 else         if (lt.expr.isValue() || lt.expr instanceof VarRef && !lt.var.checksType() || uses == VarUsage.ONCE && !lt.expr.uses(Use.CTX)) {
          ctx.compInfo(QueryText.OPTINLINE,lt);
          inline(ctx,scp,lt.var,lt.inlineExpr(ctx,scp),next);
          thisRound=change=true;
          break;
        }
      }
    }
  }
 while (thisRound);
  return change;
}
