{
  final Key key=new SecretKeySpec(k,string(a));
  byte[] hash=null;
  byte[] aa=a.length == 0 ? DEFA : a;
  if (ALGHMAC.id(lc(aa)) == 0)   CRYPTOINVHASH.thrw(input,aa);
  final boolean b64=eq(lc(enc),BASE64) || enc.length == 0;
  if (!b64 && !eq(lc(enc),HEX))   CRYPTOENC.thrw(input,enc);
  try {
    final Mac mac=Mac.getInstance(string(ALGHMAC.get(lc(aa))));
    mac.init(key);
    hash=mac.doFinal(msg);
  }
 catch (  final NoSuchAlgorithmException e) {
    CRYPTOINVHASH.thrw(input,e);
  }
catch (  final InvalidKeyException e) {
    CRYPTOKEYINV.thrw(input,e);
  }
  if (b64)   return Str.get(Base64.encode(hash));
  return Str.get(Token.hex(hash,true));
}
