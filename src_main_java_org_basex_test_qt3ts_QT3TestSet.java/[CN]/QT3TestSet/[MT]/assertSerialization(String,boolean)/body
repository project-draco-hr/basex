{
  final XdmValue value=result.value;
  if (value == null)   return fail(Util.info("Serializes to: '%'",expect));
  final String res=normNL(asString("serialize(.,map{'indent':='no'})",value));
  if (expect.equals(res))   return true;
  String flags="'" + Flag.ALLNODES + '\'';
  if (!ignorePref)   flags+=",'" + Flag.NAMESPACES + '\'';
  final String query="util:deep-equal(<X>" + expect + "</X>,"+ "<X>"+ res+ "</X>,("+ flags+ "))";
  return result(asBoolean(query,null),expect);
}
