{
  final int h=getHeight() - BOTTOM_MARGIN;
  final int rl=gui.context.current.nodes.length;
  int lvs=0;
  for (int i=0; i < rl; i++) {
    final int th=cache.getHeight(i);
    if (th > lvs)     lvs=th;
  }
  int lD;
  while ((lD=(int)((h - lvs * nodeHeight) / (double)(lvs - 1))) < (nodeHeight < CHANGE_NODE_HEIGHT_TILL ? MIN_LEVEL_DISTANCE : BEST_LEVEL_DISTANCE) && nodeHeight >= MIN_NODE_HEIGHT)   nodeHeight--;
  levelDistance=lD < MIN_LEVEL_DISTANCE ? MIN_LEVEL_DISTANCE : lD > MAX_LEVEL_DISTANCE ? MAX_LEVEL_DISTANCE : lD;
  final int ih=(int)((h - (levelDistance * (lvs - 1) + lvs * nodeHeight)) / 2d);
  topMargin=ih < TOP_MARGIN ? TOP_MARGIN : ih;
}
