{
  treeImage=createImage();
  final Graphics tg=treeImage.getGraphics();
  tg.setFont(font);
  smooth(tg);
  final int[] roots=gui.context.current.nodes;
  numRoots=roots.length;
  for (int rn=0; rn < numRoots; rn++) {
    final int h=cache.getHeight(rn);
    for (int lv=0; lv < h; lv++) {
      final boolean br=cache.isBigRectangle(rn,lv);
      final TreeRect[] lr=cache.getTreeRectsPerLevel(rn,lv);
      for (int i=0; i < lr.length; i++) {
        final TreeRect r=lr[i];
        final int pre=cache.getPrePerIndex(rn,lv,i);
        drawRectangle(tg,rn,lv,r,pre,DRAW_RECTANGLE);
      }
      if (br) {
        final TreeRect r=lr[0];
        int nh=nodeHeight;
        final int w=r.x + r.w - 1;
        int x=r.x + 1;
        final int y=getYperLevel(lv);
        final int box=4;
        tg.setColor(GUIConstants.back);
        while (nh > 0) {
          nh=nh - box;
          tg.drawLine(x,y + nh,w,y + nh);
        }
        while (x < w) {
          x=x + box;
          tg.drawLine(x,y,x,y + nodeHeight);
        }
      }
    }
    if (SHOW_CONN_MI)     highlightNode(tg,rn,roots[rn],cache.getTreeRectPerIndex(rn,0,0),0,-1,DRAW_CONN);
  }
}
