{
  final VarRef local=resolveLocalVar(name,ii);
  if (local != null)   return local;
  final byte[] uri=name.uri();
  if ((sc.xquery3() || qc.vars.declared(name)) && (module == null || eq(module.uri(),uri) || modules.contains(uri)))   return qc.vars.newRef(name,sc,ii);
  throw error(VARUNDEF,'$' + string(name.string()));
}
