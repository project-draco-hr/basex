{
  if (!wsConsumeWs(TYPESWITCH,PAREN1,TYPEPAR))   return null;
  wsCheck(PAREN1);
  final Expr ts=check(expr(),NOTYPESWITCH);
  wsCheck(PAREN2);
  TypeCase[] cases={};
  final ArrayList<SeqType> types=new ArrayList<>();
  final int s=openSubScope();
  boolean cs;
  do {
    types.clear();
    cs=wsConsumeWs(CASE);
    if (!cs) {
      wsCheck(DEFAULT);
      skipWs();
    }
    Var var=null;
    if (curr('$')) {
      var=addVar(varName(),null,false);
      if (cs)       wsCheck(AS);
    }
    if (cs) {
      do       types.add(sequenceType());
 while (sc.xquery3() && wsConsume(PIPE));
    }
    wsCheck(RETURN);
    final Expr ret=check(single(),NOTYPESWITCH);
    cases=Array.add(cases,new TypeCase(info(),var,types.toArray(new SeqType[types.size()]),ret));
    closeSubScope(s);
  }
 while (cs);
  if (cases.length == 1)   throw error(NOTYPESWITCH);
  return new TypeSwitch(info(),ts,cases);
}
