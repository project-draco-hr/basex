{
  final IO io=sc.io(string(path));
  final byte[] pth=token(io.path());
  final byte[] u=qc.modParsed.get(pth);
  if (u != null) {
    if (!eq(uri,u))     throw error(WRONGMODULE,uri,qc.context.user.has(Perm.ADMIN) ? io.path() : io.name());
    if (!sc.xquery3() && qc.modStack.contains(pth))     throw error(CIRCMODULE);
    return;
  }
  qc.modParsed.put(pth,uri);
  imports.put(uri);
  final String qu;
  try {
    qu=string(io.read());
  }
 catch (  final IOException ex) {
    throw error(WHICHMODFILE,qc.context.user.has(Perm.ADMIN) ? io.path() : io.name());
  }
  qc.modStack.push(pth);
  final StaticContext sub=new StaticContext(qc.context);
  final LibraryModule lib=new QueryParser(qu,io.path(),qc,sub).parseLibrary(false);
  final byte[] muri=lib.name.uri();
  if (!eq(uri,muri))   throw error(WRONGMODULE,muri,file);
  if (sub.initType != null) {
    if (sc.initType == null) {
      sc.initType=sub.initType;
    }
 else     if (!sub.initType.eq(sc.initType)) {
      throw error(CITYPES,sub.initType,sc.initType);
    }
  }
  qc.modStack.pop();
}
