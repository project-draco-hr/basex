{
  curr=f;
  atts.reset();
  final String name=f.getName();
  final long size=f.length();
  atts.add(NAME,token(name));
  if (!singlemode) {
    builder.startElem(FILE,atts);
    if ((Prop.fsmeta || Prop.fscont) && f.canRead() && f.isFile()&& f.getName().indexOf('.') != -1) {
      final int dot=name.lastIndexOf('.');
      final String suffix=name.substring(dot + 1).toLowerCase();
      if (size > 0) {
        final AbstractParser parser=getParser(suffix);
        if (parser != null) {
          final BufferedFileChannel bfc=new BufferedFileChannel(f,buffer);
          try {
            parse0(parser,bfc);
          }
 catch (          final IOException e) {
            BaseX.debug("NewFSParser: Failed to parse file metadata (%).",bfc.getFileName());
          }
 finally {
            try {
              bfc.close();
            }
 catch (            final IOException e1) {
            }
          }
        }
      }
    }
    addFSAtts(f,size);
    builder.endElem(FILE);
  }
  sizeStack[lvl]+=size;
}
