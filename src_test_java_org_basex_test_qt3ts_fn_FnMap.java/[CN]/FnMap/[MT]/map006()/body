{
  final XQuery query=new XQuery("\n" + "            declare function local:children($n as node()) as node()* \n" + "                { $n/child::node() }; \n"+ "            declare function local:attributes($e as node()) as node()* \n"+ "                { $e/attribute::node() }; \n"+ "            declare function local:self($e as node()) as node() \n"+ "                { $e }; \n"+ "            declare function local:union(\n"+ "                        $f as function(node()) as node()*, \n"+ "                        $g as function(node()) as node()*) as function(node()) as node()* { \n"+ "                function($a) {$f($a) | $g($a)} };\n"+ "            let $data := (/a), \n"+ "                $f := local:union(local:children#1, local:union(local:attributes#1, local:self#1)) \n"+ "            return map($f, $data/*)[not(. instance of attribute())]\n"+ "        ",ctx);
  query.context(node(file("fn/higherOrder/doc1.xml")));
  final QT3Result res=result(query);
  result=res;
  test(assertSerialization("<b bid=\"b\"><b1/></b><b1/><c cid=\"c\"><c1/></c><c1/>",false));
}
