{
  final boolean text=kind != ATTR;
  if (meta.updindex) {
    final int id=id(pre);
    final byte[] oldval=text(pre,text);
    final DiskValues index=(DiskValues)(text ? textIndex : attrIndex);
    if (index != null && kind != DOC)     index.replace(oldval,value,id);
  }
  final DataAccess store=text ? texts : values;
  final long len=store.length();
  final long v=toSimpleInt(value);
  if (v == Integer.MIN_VALUE) {
    final byte[] val=COMP.get().pack(value);
    final long old=textOff(pre);
    final long off;
    if (number(old)) {
      off=len;
    }
 else {
      final int vl=val.length;
      off=store.free(old & IO.OFFCOMP - 1,vl + Num.length(vl));
    }
    store.writeToken(off,val);
    textOff(pre,val == value ? off : off | IO.OFFCOMP);
  }
 else {
    textOff(pre,v | IO.OFFNUM);
  }
}
