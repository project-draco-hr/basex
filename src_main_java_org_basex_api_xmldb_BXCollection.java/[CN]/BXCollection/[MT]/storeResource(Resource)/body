{
  check();
  final BXXMLResource xml=checkXML(res);
  if (res.getContent() == null)   throw new XMLDBException(ErrorCodes.INVALID_RESOURCE,ERR_EMPTY);
  final String id=res.getId();
  if (id == null)   throw new XMLDBException(ErrorCodes.INVALID_RESOURCE,ERR_ID);
  final Resource old=getResource(id);
  if (old != null)   removeResource(getResource(id));
  final Object cont=xml.content;
  try {
    final Parser p=cont instanceof Document ? new DOCWrapper((Document)cont,id,ctx.prop) : Parser.xmlParser(new IOContent((byte[])cont,id),ctx.prop,"");
    final Data data=ctx.data;
    final MemData d=new MemBuilder(p).build(id);
    data.insert(data.meta.size,-1,d);
    data.flush();
    ctx.update();
  }
 catch (  final IOException ex) {
    throw new XMLDBException(ErrorCodes.INVALID_RESOURCE,ex.getMessage());
  }
}
