{
  final XQuery query=new XQuery("\n" + "      \t<bib> { \n" + "      \t\tfor $b in //book \n"+ "      \t\twhere count($b/author) > 0 \n"+ "      \t\treturn <book> \n"+ "      \t\t\t{ $b/title } \n"+ "      \t\t\t{ for $a in $b/author[position()<=2] return $a } \n"+ "      \t\t\t{ if (count($b/author) > 2) then <et-al/> else () } \n"+ "      \t\t\t</book> } \n"+ "      \t</bib>\n"+ "      ",ctx);
  query.context(node(file("docs/bib.xml")));
  final QT3Result res=result(query);
  result=res;
  test(assertSerialization("<bib><book><title>TCP/IP Illustrated</title><author><last>Stevens</last><first>W.</first></author></book><book><title>Advanced Programming in the Unix environment</title><author><last>Stevens</last><first>W.</first></author></book><book><title>Data on the Web</title><author><last>Abiteboul</last><first>Serge</first></author><author><last>Buneman</last><first>Peter</first></author><et-al/></book></bib>",false));
}
