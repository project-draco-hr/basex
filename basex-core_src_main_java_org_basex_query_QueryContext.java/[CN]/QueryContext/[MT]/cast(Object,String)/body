{
  final StaticContext sc=root != null ? root.sc : new StaticContext(true);
  if (type == null || type.isEmpty())   return val instanceof Expr ? (Expr)val : JavaMapping.toValue(val,this,sc);
  try {
    if (type.equalsIgnoreCase(MainParser.JSON.toString())) {
      final JsonParserOptions jp=new JsonParserOptions();
      jp.set(JsonOptions.SPEC,JsonSpec.ECMA_262);
      jp.set(JsonOptions.FORMAT,JsonFormat.MAP);
      return JsonConverter.convert(token(val.toString()),null,jp);
    }
  }
 catch (  final QueryIOException ex) {
    throw ex.getCause();
  }
  final QNm nm=new QNm(token(type.replaceAll("\\(.*?\\)$","")),sc);
  if (!nm.hasURI() && nm.hasPrefix())   throw NOURI.get(null,nm.string());
  Type t;
  if (type.endsWith(")")) {
    t=NodeType.find(nm);
  }
 else {
    t=ListType.find(nm);
    if (t == null)     t=AtomType.find(nm,false);
  }
  if (t == null)   throw NOTYPE.get(null,type);
  return t.cast(val,this,sc,null);
}
