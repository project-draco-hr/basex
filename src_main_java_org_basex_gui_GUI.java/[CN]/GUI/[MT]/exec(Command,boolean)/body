{
  final int thread=++threadID;
  while (command != null) {
    command.stop();
    Performance.sleep(50);
    if (threadID != thread)     return true;
  }
  cursor(CURSORWAIT);
  try {
    final Performance perf=new Performance();
    final Nodes current=context.current;
    final Data data=context.data;
    command=c;
    final ArrayOutput ao=new ArrayOutput().max(context.prop.num(Prop.MAXTEXT));
    final boolean up=c.writing(context);
    updating=up;
    boolean ok=true;
    String inf=null;
    try {
      c.execute(context,ao);
      inf=c.info();
    }
 catch (    final BaseXException ex) {
      ok=false;
      inf=ex.getMessage();
      if (!ok && inf.equals(PROGERR)) {
        command=null;
        return false;
      }
    }
 finally {
      updating=false;
    }
    final String time=perf.getTimer();
    info.setInfo(inf,c,time,ok);
    info.reset();
    boolean feedback=main;
    if (!main && query.visible() && c instanceof XQuery) {
      query.info(inf,ok);
      feedback=true;
    }
    if (!ok) {
      if (!feedback && !info.visible())       GUICommands.SHOWINFO.execute(this);
    }
 else {
      final Result result=c.result();
      final Nodes nodes=result instanceof Nodes ? (Nodes)result : null;
      if (ok && ao.size() != 0 && nodes == null) {
        if (!text.visible())         GUICommands.SHOWTEXT.execute(this);
        text.setText(ao,c);
      }
      final Data ndata=context.data;
      Nodes marked=context.marked;
      if (ndata != data) {
        notify.init();
      }
 else       if (up) {
        notify.update();
      }
 else       if (result != null) {
        if (context.current != current || prop.is(GUIProp.FILTERRT)) {
          if (nodes != null) {
            notify.context((Nodes)result,prop.is(GUIProp.FILTERRT),null);
          }
        }
 else         if (marked != null) {
          if (nodes != null) {
            marked=nodes;
          }
 else           if (marked.size() != 0) {
            marked=new Nodes(data);
          }
          notify.mark(marked,null);
          if (thread != threadID) {
            command=null;
            return true;
          }
        }
      }
      setHits(result == null ? 0 : result.size());
      status.setText(Util.info(PROCTIME,time));
    }
  }
 catch (  final Exception ex) {
    Util.stack(ex);
    Dialog.error(this,Util.info(PROCERR,c,!ex.toString().isEmpty() ? ex.toString() : ex.getMessage()));
    updating=false;
  }
  cursor(CURSORARROW,true);
  command=null;
  return true;
}
