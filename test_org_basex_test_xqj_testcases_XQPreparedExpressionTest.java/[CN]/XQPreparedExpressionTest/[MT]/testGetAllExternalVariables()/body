{
  XQPreparedExpression xqpe;
  QName[] extVars=null;
  xqpe=xqc.prepareExpression("'Hello world!'");
  xqpe.close();
  try {
    xqpe.getAllExternalVariables();
    fail("A-XQPE-4.1: closed prepared expression supports getAllExternalVariables()");
  }
 catch (  final XQException e) {
  }
  xqpe=xqc.prepareExpression("'Hello world!'");
  try {
    extVars=xqpe.getAllExternalVariables();
  }
 catch (  final XQException e) {
    fail("A-XQPE-4.2: getAllExternalVariables on prepared expression without external variables failed with message: " + e.getMessage());
  }
  assertNotNull("A-XQPE-4.2: getAllExternalVariables on prepared expression without external variables",extVars);
  assertEquals("A-XQPE-4.2: getAllExternalVariables on prepared expression without external variables",0,extVars.length);
  xqpe.close();
  xqpe=xqc.prepareExpression("declare variable $v external; $v");
  try {
    extVars=xqpe.getAllExternalVariables();
  }
 catch (  final XQException e) {
    fail("A-XQPE-4.3: getAllExternalVariables on prepared expression with external variables failed with message: " + e.getMessage());
  }
  assertNotNull("A-XQPE-4.3: getAllExternalVariables on prepared expression with external variables",extVars);
  assertEquals("A-XQPE-4.3: getAllExternalVariables on prepared expression with external variables",1,extVars.length);
  assertEquals("A-XQPE-4.3: getAllExternalVariables on prepared expression with external variables","v",extVars[0].getLocalPart());
  assertEquals("A-XQPE-4.3: getAllExternalVariables on prepared expression with external variables","",extVars[0].getNamespaceURI());
  xqpe.close();
}
