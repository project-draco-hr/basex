{
  final Item ci=ctx.item;
  final int cp=ctx.pos;
  final Iter iter=checkCtx(ctx);
  return new NodeIter(){
    /** 
 * Temporary iterator. 
 */
    NodeIter ir;
    boolean first=true;
    boolean finished=false;
    Nod nod;
    Nod temp;
    @Override public Nod next() throws XQException {
      if (finished)       return null;
      if (first) {
        first=false;
        ctx.pos=1;
      }
      while (true) {
        if (ir == null) {
          final Item it=iter.next();
          if (it == null) {
            ctx.item=ci;
            ctx.pos=cp;
            if (lastFlag && temp != null) {
              finished=true;
              return temp;
            }
            return null;
          }
          if (!it.node())           Err.or(NODESPATH,this,it.type);
          ir=axis.init((Nod)it);
        }
        nod=ir.next();
        if (nod != null) {
          if (test.e(nod)) {
            boolean add=true;
            ctx.item=nod;
            final Item i=ctx.iter(expr[0]).ebv();
            if (i.n() ? i.dbl() == ctx.pos : i.bool()) {
              nod.score(i.score());
            }
 else {
              add=false;
            }
            temp=lastFlag ? nod.finish() : null;
            ctx.pos++;
            if (add) {
              ctx.item=ci;
              if (numFlag) {
                finished=true;
                return nod.finish();
              }
              return nod.finish();
            }
          }
        }
 else {
          ir=null;
        }
      }
    }
    @Override public String toString(){
      return IterStep.this.toString();
    }
  }
;
}
