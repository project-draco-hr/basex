{
  super.compile(ctx);
  Expr e=this;
  final SeqType t=expr.type();
  if (expr.isValue()) {
    e=preEval(ctx);
  }
 else   if (type.type == AtomType.BLN || type.type == AtomType.FLT || type.type == AtomType.DBL || type.type == AtomType.QNM || type.type == AtomType.URI) {
    if (t.eq(type) || t.type == type.type && t.one() && type.zeroOrOne())     e=expr;
    if (e != this)     optPre(e,ctx);
  }
  if (e == this && t.one())   type=SeqType.get(type.type,Occ.ONE);
  return e;
}
