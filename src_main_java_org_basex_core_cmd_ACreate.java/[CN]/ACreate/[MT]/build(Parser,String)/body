{
  if (!validName(db))   return error(NAMEINVALID,db);
  new Close().run(context);
  try {
    if (context.pinned(db))     return error(DBLOCKED,db);
    final boolean mem=prop.is(Prop.MAINMEM);
    builder=mem ? new MemBuilder(p,prop) : new DiskBuilder(p,prop);
    progress(builder);
    final Data d=builder.build(db);
    if (mem) {
      context.openDB(d);
      context.pin(d);
    }
 else {
      d.close();
      final Open open=new Open(db);
      if (!open.run(context))       return error(open.info());
      final Data data=context.data;
      if (prop.is(Prop.TEXTINDEX))       index(IndexType.TEXT,data);
      if (prop.is(Prop.ATTRINDEX))       index(IndexType.ATTRIBUTE,data);
      if (prop.is(Prop.FTINDEX))       index(IndexType.FULLTEXT,data);
    }
    return info(DBCREATED,db,perf);
  }
 catch (  final ProgressException ex) {
    throw ex;
  }
catch (  final Exception ex) {
    Util.debug(ex);
    abort();
    final String msg=ex instanceof IOException ? ex.getMessage() : Util.info(PARSEERR,p.file);
    return error(msg != null ? msg : args[0]);
  }
}
