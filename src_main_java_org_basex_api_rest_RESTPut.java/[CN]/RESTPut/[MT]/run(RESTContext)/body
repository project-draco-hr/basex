{
  parseOptions(ctx);
  final Session session=ctx.session;
  if (ctx.depth() == 0)   throw new RESTException(SC_NOT_FOUND,ERR_NOPATH);
  boolean xml=true;
  InputStream in=ctx.in;
  final String ct=ctx.req.getContentType();
  if (APP_JSON.equals(ct)) {
    session.execute("set parser json");
  }
 else   if (APP_JSONML.equals(ct)) {
    session.execute("set parser json");
    session.execute("set parseropt jsonml=true");
  }
 else   if (TEXT_PLAIN.equals(ct)) {
    session.execute("set parser text");
  }
 else   if (TEXT_CSV.equals(ct)) {
    session.execute("set parser csv");
  }
 else   if (TEXT_HTML.equals(ct)) {
    session.execute("set parser html");
  }
 else   if (ct != null && !APP_XML.equals(ct)) {
    xml=false;
  }
  if (ctx.depth() == 1) {
    if (xml) {
      session.create(ctx.db(),in);
    }
 else {
      session.create(ctx.db(),new ArrayInput(""));
      session.store(ctx.db(),in);
    }
  }
 else {
    open(ctx);
    if (xml) {
      session.replace(ctx.dbpath(),in);
    }
 else {
      session.execute(new Delete(ctx.dbpath()));
      session.store(ctx.dbpath(),in);
    }
  }
  throw new RESTException(SC_CREATED,session.info());
}
