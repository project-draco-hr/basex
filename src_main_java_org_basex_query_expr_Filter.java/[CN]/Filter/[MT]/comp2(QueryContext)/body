{
  if (!ctx.dynamic)   return this;
  final SeqType t=root.type();
  final long s=root.size();
  if (s != -1) {
    if (pos != null) {
      size=Math.max(0,s + 1 - pos.min) - Math.max(0,s - pos.max);
    }
 else     if (last) {
      size=s > 0 ? 1 : 0;
    }
    if (size == 0)     return optPre(null,ctx);
    type=SeqType.get(t.type,size);
  }
 else {
    type=SeqType.get(t.type,t.zeroOrOne() ? Occ.ZERO_ONE : Occ.ZERO_MORE);
  }
  if (!super.uses(Use.POS))   return new IterFilter(this);
  if (preds.length == 1 && (last || pos != null)) {
    if (root.isValue() && t.one() && (last || pos.min == 1 && pos.max == 1)) {
      return optPre(root,ctx);
    }
  }
  boolean off=false;
  if (preds.length == 1) {
    final Expr p=preds[0];
    final SeqType st=p.type();
    off=st.type.isNumber() && st.zeroOrOne() && !p.uses(Use.CTX)&& !p.uses(Use.NDT);
    if (off)     type=SeqType.get(type.type,Occ.ZERO_ONE);
  }
  return off || useIterator() ? new IterPosFilter(this,off) : this;
}
