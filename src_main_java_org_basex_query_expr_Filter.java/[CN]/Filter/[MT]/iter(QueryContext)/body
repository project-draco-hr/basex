{
  final Iter iter=ctx.iter(root);
  final Value cv=ctx.value;
  final long cs=ctx.size;
  final long cp=ctx.pos;
  try {
    final ValueBuilder vb=new ValueBuilder();
    for (Item i; (i=iter.next()) != null; )     vb.add(i);
    for (    final Expr p : preds) {
      final long is=vb.size();
      ctx.size=is;
      ctx.pos=1;
      int c=0;
      for (int s=0; s < is; ++s) {
        ctx.value=vb.get(s);
        if (p.test(ctx,input) != null)         vb.set(vb.get(s),c++);
        ctx.pos++;
      }
      vb.size(c);
    }
    return vb;
  }
  finally {
    ctx.value=cv;
    ctx.size=cs;
    ctx.pos=cp;
  }
}
