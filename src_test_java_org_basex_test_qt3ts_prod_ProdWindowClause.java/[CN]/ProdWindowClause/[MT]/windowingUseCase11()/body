{
  final XQuery query=new XQuery("\n" + "<results>{\n" + "  for tumbling window $w in ./stream/event[direction eq \"in\"]\n"+ "    start when true()\n"+ "    only end next $x when  $x/person eq \"Clara\"\n"+ "  return\n"+ "    <result time=\"{ $x/@time }\">{\n"+ "      distinct-values(for $y in $w\n"+ "        where (xs:dateTime($y/@time) + xs:dayTimeDuration(\"PT15M\") ) ge xs:dateTime($x/@time)\n"+ "        return $y/person)\n"+ "    }</result>\n"+ "}</results>\n"+ "      ",ctx);
  query.context(node(file("prod/WindowClause/person_events.xml")));
  final QT3Result res=result(query);
  result=res;
  test(assertSerialization("<results><result time=\"2006-01-01T11:15:00-00:00\">Barbara</result><result time=\"2006-01-02T12:00:00-00:00\"/><result time=\"2006-01-02T12:15:00-00:00\">Clara</result><result time=\"2006-01-02T12:25:00-00:00\">Clara</result><result time=\"2006-01-02T14:00:00-00:00\"/></results>",false));
}
