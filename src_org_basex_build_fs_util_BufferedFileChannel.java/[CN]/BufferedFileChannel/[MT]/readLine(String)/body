{
  final boolean utf=inputEncoding.equalsIgnoreCase(Token.UTF8);
  final TokenBuilder tb=new TokenBuilder(100);
  out:   while (true) {
    for (int i=0, max=buf.remaining(); i < max; i++) {
      final int b=get();
      if (b == '\n') {
        break out;
      }
 else       if (b == '\r') {
        if (remaining() > 0 && buffer(1) && get() != '\n')         skip(-1);
        break out;
      }
 else {
        if (utf)         tb.add((byte)b);
 else         tb.addUTF(b);
      }
    }
    final long r=remaining();
    if (r == 0)     return null;
    final int bs=getBufferSize();
    buffer(r < bs ? (int)r : bs);
  }
  return tb.toString();
}
