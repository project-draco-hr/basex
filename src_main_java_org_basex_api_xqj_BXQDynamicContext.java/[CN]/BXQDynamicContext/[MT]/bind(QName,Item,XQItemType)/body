{
  opened();
  valid(var,QName.class);
  final Type tt=check(it.type,t);
  Item i=it;
  if (tt != it.type) {
    try {
      i=tt.e(it,ctx.ctx,null);
    }
 catch (    final QueryException ex) {
      throw new BXQException(ex);
    }
  }
  if (var == XQConstants.CONTEXT_ITEM) {
    qp.ctx.item=i;
  }
 else {
    final QNm name=new QNm(Token.token(var.getLocalPart()));
    Var v=new Var(name);
    if (this instanceof BXQPreparedExpression) {
      v=qp.ctx.vars.get(v);
      if (v == null)       throw new BXQException(VAR,var);
    }
 else {
      qp.ctx.vars.addGlobal(v);
    }
    try {
      v.bind(i,null);
    }
 catch (    final QueryException ex) {
      throw new BXQException(ex);
    }
  }
}
