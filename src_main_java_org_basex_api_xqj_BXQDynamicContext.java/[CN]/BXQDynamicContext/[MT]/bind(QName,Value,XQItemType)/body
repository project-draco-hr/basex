{
  opened();
  valid(var,QName.class);
  final Type tt=check(v.type,t);
  Value vl=v;
  if (tt != v.type && v instanceof Item) {
    try {
      vl=tt.e((Item)v,ctx.ctx,null);
    }
 catch (    final QueryException ex) {
      throw new BXQException(ex);
    }
  }
  if (var == XQConstants.CONTEXT_ITEM) {
    qp.ctx.value=vl;
  }
 else {
    final QNm name=new QNm(Token.token(var.getLocalPart()));
    Var vr=new Var(name);
    if (this instanceof BXQPreparedExpression) {
      vr=qp.ctx.vars.get(vr);
      if (vr == null)       throw new BXQException(VAR,var);
    }
 else {
      qp.ctx.vars.addGlobal(vr);
    }
    try {
      vr.bind(vl,null);
    }
 catch (    final QueryException ex) {
      throw new BXQException(ex);
    }
  }
}
