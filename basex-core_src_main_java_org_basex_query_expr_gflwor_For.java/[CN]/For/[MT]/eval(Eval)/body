{
  return new Eval(){
    /** 
 * Expression iterator. 
 */
    private Iter iter;
    /** 
 * Current position. 
 */
    private long p;
    @Override public boolean next(    final QueryContext qc) throws QueryException {
      while (true) {
        final Item it=iter == null ? null : iter.next();
        if (it != null) {
          ++p;
          qc.set(var,it,info);
          if (pos != null)           qc.set(pos,Int.get(p),info);
          if (score != null)           qc.set(score,Dbl.get(it.score()),info);
          return true;
        }
        if (empty && iter != null && p == 0) {
          qc.set(var,Empty.SEQ,info);
          if (pos != null)           qc.set(pos,Int.get(p),info);
          if (score != null)           qc.set(score,Dbl.get(0),info);
          iter=null;
          return true;
        }
        if (!sub.next(qc))         return false;
        final boolean s=qc.scoring;
        try {
          qc.scoring=scoring;
          iter=expr.iter(qc);
        }
  finally {
          qc.scoring=s;
        }
        p=0;
      }
    }
  }
;
}
