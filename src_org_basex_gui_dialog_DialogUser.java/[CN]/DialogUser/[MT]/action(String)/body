{
  String msg=null;
  try {
    if (BUTTONCHANGE.equals(cmd)) {
      for (      final Proc p : permps)       if (!sess.execute(p))       msg=sess.info();
      permps.clear();
      setData();
    }
 else     if (BUTTONCREATE.equals(cmd)) {
      final String u=user.getText();
      final String p=new String(pass.getPassword());
      if (!sess.execute(new CreateUser(u,p)))       msg=sess.info();
      user.setText("");
      pass.setText("");
      setData();
    }
 else     if (BUTTONDROP.equals(cmd)) {
      final String u=dropUser.getSelectedItem().toString();
      if (Dialog.confirm(this,Main.info(DRQUESTION,u))) {
        if (!sess.execute(new DropUser(u)))         msg=sess.info();
      }
      setData();
    }
 else     if (BUTTONALTER.equals(cmd)) {
      final String u=alterUser.getSelectedItem().toString();
      final String p=new String(newpass.getPassword());
      if (!sess.execute(new AlterUser(u,p)))       msg=sess.info();
      newpass.setText("");
      setData();
    }
 else     if ("Remove".equals(cmd)) {
      gui.context.data.meta.users.remove(gui.context.data.meta.users.get(removeUser.getSelectedItem().toString()));
      setData();
    }
 else     if ("Add".equals(cmd)) {
      String value=addUser.getSelectedItem().toString();
      for (      StringList l : tempP) {
        if (l.get(0).equals(value)) {
          String db=dia.gui.context.data.meta.name;
          String o=l.get(1);
          Object val=o.equals("") ? Boolean.FALSE : o.equals("X") ? Boolean.TRUE : o;
          String right=CmdPerm.values()[0].toString();
          permps.add(val.equals(true) ? new Grant(right,value,db) : new Revoke(right,value,db));
          o=l.get(2);
          val=o.equals("") ? Boolean.FALSE : o.equals("X") ? Boolean.TRUE : o;
          right=CmdPerm.values()[1].toString();
          permps.add(val.equals(true) ? new Grant(right,value,db) : new Revoke(right,value,db));
        }
      }
      action(BUTTONCHANGE);
    }
  }
 catch (  final IOException ex) {
    Main.debug(ex);
    if (ex instanceof BindException)     msg=SERVERBIND;
 else     if (ex instanceof LoginException)     msg=SERVERLOGIN;
 else     msg=ex.getMessage();
  }
  final boolean valuname=user.getText().matches("[\\w]*");
  final boolean valpass=new String(pass.getPassword()).matches("[\\w]*");
  final boolean valnewpass=new String(newpass.getPassword()).matches("[\\w]*");
  boolean disname=!user.getText().equals(ADMIN);
  for (int i=0; i < dropUser.getItemCount(); i++) {
    disname&=!user.getText().equals(dropUser.getItemAt(i).toString());
  }
  boolean warn=true;
  if (msg != null) {
    warn=false;
  }
 else   if (!(valuname && valpass && valnewpass&& disname)) {
    msg=!disname ? Main.info(USERKNOWN,user.getText()) : Main.info(INVALID,!valuname ? SERVERUSER : SERVERPW);
  }
  info.setError(msg,warn);
  alter.setEnabled(valnewpass && newpass.getPassword().length != 0 && alterUser.getSelectedIndex() != -1);
  create.setEnabled(valuname && valpass && disname&& !user.getText().isEmpty()&& pass.getPassword().length != 0);
  drop.setEnabled(dropUser.getSelectedIndex() != -1);
  remove.setEnabled(removeUser.getSelectedIndex() != -1);
  add.setEnabled(addUser.getSelectedIndex() != -1);
  change.setEnabled(false);
}
