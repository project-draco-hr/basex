{
  final MemData mdata;
  String name=string(pth);
  if (name.endsWith("."))   RESINV.thrw(input,pth);
  IO io=null;
  if (doc.isString()) {
    io=IO.get(string(doc.string(input)));
    if (!io.exists())     RESFNF.thrw(input,pth);
    if (!name.endsWith("/") && (io.isDir() || io.isArchive()))     name+="/";
  }
  String target="";
  final int s=name.lastIndexOf('/');
  if (s != -1) {
    target=name.substring(0,s);
    name=name.substring(s + 1);
  }
  if (doc.isString()) {
    if (!name.isEmpty())     io.name(name);
 else     if (!(io instanceof IOContent))     name=io.name();
  }
  if (name.isEmpty())   RESINV.thrw(input,pth);
  if (doc.isNode()) {
    final ANode nd=(ANode)doc;
    if (nd.type != NodeType.DOC)     UPDOCTYPE.thrw(input,nd);
    mdata=new MemData(data);
    new DataBuilder(mdata).build(nd);
    mdata.update(0,Data.DOC,pth);
  }
 else   if (doc.isString()) {
    final DirParser p=new DirParser(io,target,ctx.prop);
    final MemBuilder b=new MemBuilder(data.meta.name,p,ctx.prop);
    try {
      mdata=b.build();
    }
 catch (    final IOException ex) {
      throw IOERR.thrw(input,ex);
    }
  }
 else {
    throw STRNODTYPE.thrw(input,this,doc.type);
  }
  return mdata;
}
