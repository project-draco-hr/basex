{
  final InputSource is=wrap(source.getInputSource());
  try {
    XMLReader r=source.getXMLReader();
    if (r == null) {
      final SAXParserFactory f=SAXParserFactory.newInstance();
      f.setNamespaceAware(true);
      f.setValidating(false);
      r=f.newSAXParser().getXMLReader();
    }
    sax=new SAXHandler(builder);
    final String cat=prop.get(Prop.CATFILE);
    if (!cat.isEmpty() && null != cm) {
      Class<?> clazz=Class.forName("org.apache.xml.resolver.CatalogManager");
      Method m=clazz.getMethod("setCatalogFiles",String.class);
      m.invoke(cm,cat);
      m=clazz.getMethod("setIgnoreMissingProperties",boolean.class);
      m.invoke(cm,true);
      m=clazz.getMethod("setPreferPublic",boolean.class);
      m.invoke(cm,true);
      m=clazz.getMethod("setUseStaticCatalog",boolean.class);
      m.invoke(cm,false);
      m=clazz.getMethod("setVerbosity",int.class);
      m.invoke(cm,0);
      r.setEntityResolver((EntityResolver)Class.forName("org.apache.xml.resolver.tools.CatalogResolver").getConstructor(new Class[]{Class.forName("org.apache.xml.resolver.CatalogManager")}).newInstance(cm));
    }
    r.setDTDHandler(sax);
    r.setContentHandler(sax);
    r.setProperty("http://xml.org/sax/properties/lexical-handler",sax);
    r.setErrorHandler(sax);
    if (is != null)     r.parse(is);
 else     r.parse(source.getSystemId());
  }
 catch (  final SAXParseException ex) {
    final String msg=Util.info(SCANPOS,ex.getSystemId(),ex.getLineNumber(),ex.getColumnNumber()) + ": " + ex.getMessage();
    final IOException ioe=new IOException(msg);
    ioe.setStackTrace(ex.getStackTrace());
    throw ioe;
  }
catch (  final ProgressException ex) {
    throw ex;
  }
catch (  final Exception ex) {
    final IOException ioe=new IOException(ex.getMessage());
    ioe.setStackTrace(ex.getStackTrace());
    throw ioe;
  }
}
