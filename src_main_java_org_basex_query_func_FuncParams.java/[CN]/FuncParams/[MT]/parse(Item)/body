{
  final InputInfo info=expr == null ? null : expr.info;
  if (it instanceof Map)   return ((Map)it).tokenJavaMap(info);
  final TokenMap tm=new TokenMap();
  if (it == null)   return tm;
  if (it.type != NodeType.ELM || !test.eq((ANode)it))   ELMMAPTYPE.thrw(info,it,root,it.type);
  final AxisIter ai=((ANode)it).children();
  for (ANode n; (n=ai.next()) != null; ) {
    if (n.type != NodeType.ELM)     continue;
    final QNm qn=n.qname();
    if (!eq(qn.uri(),root.uri()))     GENERR.thrw(info,n);
    final byte[] key=qn.local();
    byte[] val=n.attribute(A_VALUE);
    if (val == null)     val=n.string();
    final byte[] o=tm.get(key);
    if (o != null)     val=new TokenBuilder(o).add(',').add(val).finish();
    tm.add(key,val);
  }
  return tm;
}
