{
  final TokenList allkeys=new TokenList(map).sort(true);
  final IntList empty=new IntList(map.size());
  int p=-1;
  final int s=size();
  for (  final byte[] key : allkeys) {
    p=get(key,++p,s);
    if (p < 0)     throw Util.notExpected("Tried to delete ids " + map.get(key) + " of non-existing index key: '"+ string(key)+ '\'');
 else     if (deleteIds(p,key,map.get(key).sort().toArray()) == 0)     empty.add(p);
  }
  if (!empty.isEmpty())   deleteKeys(empty.finish());
}
