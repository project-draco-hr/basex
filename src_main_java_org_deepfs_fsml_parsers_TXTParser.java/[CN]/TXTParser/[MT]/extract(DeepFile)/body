{
  final BufferedFileChannel bfc=deepFile.getBufferedFileChannel();
  final int len=(int)Math.min(bfc.size(),deepFile.maxTextSize());
  final byte[] text=bfc.get(new byte[len]);
  final boolean valid=Token.valid(text);
  if (deepFile.extractText() && valid)   deepFile.addText(0,len,Token.string(text));
  if (deepFile.extractMeta()) {
    final String name=bfc.getFileName();
    final String s=name.substring(name.lastIndexOf('.') + 1).toLowerCase();
    final MimeType mime=SUFFIXES.get(s);
    if (mime == null) {
      deepFile.setFileType(valid ? FileType.TEXT : FileType.UNKNOWN_TYPE);
      deepFile.setFileFormat(MimeType.UNKNOWN);
    }
 else {
      for (      final FileType ft : mime.getMetaTypes())       deepFile.setFileType(ft);
      deepFile.setFileFormat(mime);
    }
  }
}
