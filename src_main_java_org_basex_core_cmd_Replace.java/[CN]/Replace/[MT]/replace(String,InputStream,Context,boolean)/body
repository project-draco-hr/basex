{
  final Data data=ctx.data;
  String path=path(p);
  if (path.isEmpty())   return Util.info(DIRERR,path);
  final byte[] src=token(path);
  final int[] docs=data.doc(p);
  if (docs.length == 0)   return Util.info(FILEWHICH,path);
  for (  final int doc : docs) {
    if (!eq(data.text(doc,true),src))     return Util.info(DIRERR,path);
  }
  final String target;
  final int i=path.lastIndexOf('/');
  if (i != -1) {
    target=path.substring(0,i);
    path=path.substring(i + 1);
  }
 else {
    target="";
  }
  try {
    if (lock)     ctx.register(true);
    for (int d=docs.length - 1; d >= 0; d--)     data.delete(docs[d]);
    Add.add(path,target,input,ctx,null,false);
  }
  finally {
    if (lock)     ctx.unregister(true);
  }
  return Util.info(PATHREPLACED,docs.length);
}
