{
  final Data data=ctx.data();
  if (data == null)   throw new BaseXException(PROCNODB);
  String pth=IOFile.normalize(path);
  String trg="";
  if (pth.isEmpty())   throw new BaseXException(DIRERR,pth);
  final byte[] src=token(pth);
  final IntList docs=data.docs(path);
  final int is=docs.size();
  for (int i=0; i < is; i++) {
    if (!eq(data.text(docs.get(i),true),src))     throw new BaseXException(DIRERR,pth);
  }
  final int i=pth.lastIndexOf('/');
  if (i != -1) {
    trg=pth.substring(0,i);
    pth=pth.substring(i + 1);
  }
  try {
    if (lock)     ctx.register(true);
    final IOFile file=data.meta.binary(path);
    if (file != null && file.exists()) {
      Store.store(file,input);
    }
 else {
      Add.add(pth,trg,input,ctx,null,false);
      for (int d=docs.size() - 1; d >= 0; d--)       data.delete(docs.get(d));
      data.flush();
    }
  }
  finally {
    if (lock)     ctx.unregister(true);
  }
  return Util.info(PATHREPLACED,docs.size());
}
