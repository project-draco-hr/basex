{
  ArrayOutput plan=null;
  QueryProcessor qp=new QueryProcessor(query,CONTEXT);
  try {
    ArrayOutput ao=new ArrayOutput();
    Serializer ser=qp.getSerializer(ao);
    qp.execute().serialize(ser);
    qp.close();
    final String info=qp.info();
    if (result != null)     assertEquals(result,ao.toString().replaceAll("\\r?\\n",""));
    plan=new ArrayOutput();
    qp.plan(Serializer.get(plan));
    qp=new QueryProcessor(plan + "/descendant-or-self::*" + "[self::IndexAccess|self::FTIndexAccess]",CONTEXT);
    ao=new ArrayOutput();
    ser=qp.getSerializer(ao);
    qp.execute().serialize(ser);
    assertTrue("No index used:\nQuery: " + query + "\nInfo: "+ info+ "\nPlan: "+ plan,!ao.toString().isEmpty());
  }
 catch (  final QueryException ex) {
    fail(Util.message(ex) + "\nQuery: " + query+ "\nPlan: "+ plan);
  }
catch (  final IOException ex) {
    fail(Util.message(ex));
  }
}
