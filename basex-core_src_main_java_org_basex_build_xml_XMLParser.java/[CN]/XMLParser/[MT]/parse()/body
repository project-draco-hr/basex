{
  scanner.more();
  while (true) {
    if (scanner.type == Type.TEXT) {
      final byte[] text=scanner.token.finish();
      if (!tags.isEmpty() || fragment || !ws(text)) {
        if (chops.peek())         scanner.token.trim();
        builder.text(scanner.token.finish());
      }
    }
 else     if (scanner.type == Type.COMMENT) {
      builder.comment(scanner.token.finish());
    }
 else     if (scanner.type == Type.PI) {
      builder.pi(scanner.token.finish());
    }
 else     if (scanner.type == Type.EOF) {
      break;
    }
 else     if (scanner.type != Type.DTD) {
      if (!fragment && closed)       throw new BuildException(MOREROOTS,det());
      if (!parseTag())       break;
      continue;
    }
    if (!scanner.more())     break;
  }
  scanner.close();
  builder.encoding(scanner.encoding);
  if (!tags.isEmpty())   throw new BuildException(DOCOPEN,det(),tags.pop());
}
