{
  if (db == null || Prop.onthefly)   return new MemBuilder().build(p,"");
  final Builder builder=new DiskBuilder();
  try {
    final Data data=builder.build(p,db);
    if (data.meta.txtindex)     data.setIndex(IndexToken.Type.TXT,new ValueBuilder(true).build(data));
    if (data.meta.atvindex)     data.setIndex(IndexToken.Type.ATV,new ValueBuilder(false).build(data));
    if (data.meta.ftxindex)     data.setIndex(IndexToken.Type.FTX,data.meta.ftfz ? new FTFuzzyBuilder().build(data) : new FTBuilder().build(data));
    return data;
  }
 catch (  final IOException ex) {
    try {
      builder.close();
    }
 catch (    final IOException e) {
      BaseX.debug(e);
    }
    DropDB.drop(db);
    throw ex;
  }
}
