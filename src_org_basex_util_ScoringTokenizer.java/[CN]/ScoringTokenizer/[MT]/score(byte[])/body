{
  final int c=token.get(key);
  token.set(key,-1);
  return c == 0 ? 0 : Math.max(1,c * 1000 / max);
}
