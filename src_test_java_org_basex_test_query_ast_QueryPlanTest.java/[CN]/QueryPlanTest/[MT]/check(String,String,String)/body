{
  final QueryProcessor qp=new QueryProcessor(qu,context);
  try {
    qp.compile();
    final Data plan=CreateDB.mainMem(new Parser("",context.prop){
      @Override public void parse(      final Builder build) throws IOException {
        build.startDoc(QueryText.PLAN);
        qp.plan(new BuilderSerializer(build));
        build.endDoc();
      }
    }
,context);
    if (res != null) {
      assertEquals(res,qp.execute().toString());
    }
    final Nodes in=new Nodes(0,plan);
    for (    final String p : pr) {
      QueryProcessor query=new QueryProcessor(p,context).context(in);
      if (query.value() != Bln.TRUE) {
        query=new QueryProcessor("/*",context).context(in);
        fail(NL + "- Query: " + qu+ NL+ "- Check: "+ p+ NL+ "- Plan: "+ query.execute().toString());
      }
    }
  }
 catch (  final Exception ex) {
    throw new Error(ex.getMessage(),ex);
  }
 finally {
    qp.close();
  }
}
