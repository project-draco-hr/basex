{
  final QueryProcessor qp=new QueryProcessor(qu,context);
  try {
    qp.compile();
    final Data plan=CreateDB.mainMem(new Parser("",context.prop){
      @Override public void parse(      final Builder build) throws IOException {
        build.startDoc(QueryText.PLAN);
        qp.plan(new BuilderSerializer(build));
        build.endDoc();
      }
    }
,context);
    if (res != null)     assertEquals("Query result:",res,qp.execute().toString());
    context.openDB(plan);
    for (    final String p : pr) {
      if (!new XQuery(p).execute(context).equals("true"))       fail(p + ':' + NL+ qp.ctx.root+ NL+ new XQuery("/").execute(context));
    }
  }
 catch (  final Exception ex) {
    throw new Error(ex.getMessage(),ex);
  }
 finally {
    qp.close();
  }
}
