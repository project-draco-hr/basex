{
  try {
    final Socket s=server.accept();
    final Performance perf=new Performance();
    final DataInputStream dis=new DataInputStream(s.getInputStream());
    final String in=dis.readUTF().trim();
    final InetAddress addr=s.getInetAddress();
    final String ip=addr.toString();
    if (verbose)     BaseX.outln("[%:%] %",addr.getHostAddress(),s.getPort(),in);
    Process pr=null;
    try {
      pr=new CommandParser(in).parse()[0];
    }
 catch (    final QueryException ex) {
      BaseX.errln(ex.getMessage());
      final OutputStream out=s.getOutputStream();
      out.write(0);
      out.close();
      return;
    }
    final Process proc=pr;
    if (proc instanceof Stop) {
      s.getOutputStream().write(1);
      for (int p=0; p < MAX; p++)       if (corc[p] != null)       corc[p].stop();
      running=false;
      return;
    }
    new Thread(){
      @Override public void run(){
        try {
          if (proc instanceof GetResult || proc instanceof GetInfo) {
            final OutputStream os=s.getOutputStream();
            final PrintOutput out=new PrintOutput(new BufferedOutput(os));
            final Process c=session(ip);
            if (c == null) {
              out.print(SERVERFULL);
            }
 else             if (proc instanceof GetResult) {
              c.output(out);
            }
 else             if (proc instanceof GetInfo) {
              c.info(out);
            }
            out.close();
          }
 else {
            boolean ok=save(proc,ip);
            if (ok) {
              ok=proc.execute(context);
              if (!ok && verbose) {
                final PrintOutput o=new ConsoleOutput(System.err);
                proc.info(o);
                o.close();
              }
            }
            final OutputStream out=s.getOutputStream();
            out.write(ok ? 1 : 0);
            out.close();
          }
          dis.close();
        }
 catch (        final Exception ex) {
          if (ex instanceof IOException)           BaseX.errln(SERVERERR);
 else           ex.printStackTrace();
        }
        if (verbose)         BaseX.outln("[%:%] %",addr.getHostAddress(),s.getPort(),perf.getTimer());
      }
    }
.start();
  }
 catch (  final Exception ex) {
    if (ex instanceof IOException)     BaseX.errln(SERVERERR);
 else     ex.printStackTrace();
  }
}
