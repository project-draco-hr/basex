{
  try {
    final Socket s=server.accept();
    final Performance perf=new Performance();
    final DataInputStream dis=new DataInputStream(s.getInputStream());
    final String in=dis.readUTF().trim();
    final InetAddress addr=s.getInetAddress();
    final String ha=addr.getHostAddress();
    final int sp=s.getPort();
    if (verbose)     BaseX.outln("[%:%] %",ha,sp,in);
    Process pr=null;
    try {
      pr=new CommandParser(in).parse()[0];
    }
 catch (    final QueryException ex) {
      BaseX.errln(ex.getMessage());
      send(s,0);
      return;
    }
    final Process proc=pr;
    if (proc instanceof Exit) {
      send(s,1);
      for (      final BaseXSession ss : sess)       ss.core.stop();
      running=false;
      return;
    }
    new Thread(){
      @Override public void run(){
        try {
          if (proc instanceof GetResult || proc instanceof GetInfo) {
            final OutputStream os=s.getOutputStream();
            final PrintOutput out=new PrintOutput(new BufferedOutput(os));
            final int id=Math.abs(Integer.parseInt(proc.args().trim()));
            final Process c=get(id);
            if (c == null) {
              out.print(SERVERFULL);
            }
 else             if (proc instanceof GetResult) {
              c.output(out);
            }
 else             if (proc instanceof GetInfo) {
              c.info(out);
            }
            out.close();
          }
 else {
            add(new BaseXSession(sp,System.nanoTime(),proc));
            send(s,proc.execute(context) ? sp : -sp);
          }
          dis.close();
        }
 catch (        final Exception ex) {
          if (ex instanceof IOException)           BaseX.errln(SERVERERR);
          ex.printStackTrace();
        }
        if (verbose)         BaseX.outln("[%:%] %",ha,sp,perf.getTimer());
      }
    }
.start();
  }
 catch (  final Exception ex) {
    if (ex instanceof IOException)     BaseX.errln(SERVERERR);
    ex.printStackTrace();
  }
}
