{
  int n=nd;
  mod.set(true,n);
  while (n != -1 && n != root && mod.get(p(n))) {
    if (p(n) == l(p(p(n)))) {
      final int y=r(p(p(n)));
      if (y != -1 && mod.get(y)) {
        mod.set(false,p(n));
        mod.set(false,y);
        mod.set(true,p(p(n)));
        n=p(p(n));
      }
 else {
        if (n == r(p(n))) {
          n=p(n);
          rl(n);
        }
        mod.set(false,p(n));
        mod.set(true,p(p(n)));
        if (p(p(n)) != -1)         rr(p(p(n)));
      }
    }
 else {
      final int y=l(p(p(n)));
      if (y != -1 && mod.get(y)) {
        mod.set(false,p(n));
        mod.set(false,y);
        mod.set(true,p(p(n)));
        n=p(p(n));
      }
 else {
        if (n == l(p(n))) {
          n=p(n);
          rr(n);
        }
        mod.set(false,p(n));
        mod.set(true,p(p(n)));
        if (p(p(n)) != -1)         rl(p(p(n)));
      }
    }
  }
  mod.set(false,root);
}
