{
  final InputInfo info=fun.info;
  final IndexContext ic=new IndexContext(data,false);
  if (!data.meta.ftxtindex)   BXDB_INDEX.thrw(info,data.meta.name,IndexType.FULLTEXT.toString().toLowerCase(Locale.ENGLISH));
  final FTOpt tmp=ctx.ftOpt();
  final FTOpt opt=new FTOpt().copy(data.meta);
  FTMode mode=FTMode.ANY;
  if (opts != null) {
    opt.set(FZ,opts.get(FTOptions.FUZZY));
    opt.set(WC,opts.get(FTOptions.WILDCARDS));
    mode=opts.get(FTOptions.MODE);
  }
  ctx.ftOpt(opt);
  FTExpr expr=new FTWords(info,ic,terms,mode,ctx);
  ctx.ftOpt(tmp);
  if (opts != null && opts.contains(FTOptions.DISTANCE)) {
    try {
      final FTDistanceOptions ftdo=new FTDistanceOptions(opts.get(FTOptions.DISTANCE));
      expr=new FTDistance(info,expr,new Expr[]{Int.get(ftdo.get(FTDistanceOptions.MIN)),Int.get(ftdo.get(FTDistanceOptions.MAX))},ftdo.get(FTDistanceOptions.UNIT));
    }
 catch (    final BaseXException ex) {
      INVALIDOPT.thrw(info,ex);
    }
  }
  return new FTIndexAccess(info,expr,ic).iter(ctx);
}
