{
  final Data data=GUI.context.data();
  final int size=parentList.size;
  final HashMap<Integer,Double> temp=new HashMap<Integer,Double>();
  double x=0;
  final int y=1 * level * fontHeight* 2;
  final double width=this.getSize().width - 1;
  final double ratio=width / size;
  final int minSpace=35;
  final boolean space=ratio > minSpace ? true : false;
  for (int i=0; i < size; i++) {
    final int pre=parentList.list[i];
    if (pre == -1) {
      x+=ratio;
      continue;
    }
    final int nodeSize=data.size(pre,Data.ELEM);
    final double nodePercent=nodeSize / (double)sumNodeSizeInLine;
    g.setColor(Color.black);
    g.drawRect((int)x,y,(int)ratio,fontHeight);
    int c=(int)Math.rint(255 * nodePercent * 40);
    c=c > 255 ? 255 : c;
    g.setColor(new Color(c,0,255 - c));
    g.fillRect((int)x + 1,y + 1,(int)(ratio - 1),fontHeight - 1);
    final double boxMiddle=x + ratio / 2f;
    g.setColor(Color.black);
    if (space) {
      String s=Token.string(data.tag(pre));
      int textWidth=0;
      while ((textWidth=BaseXLayout.width(g,s)) + 4 > ratio) {
        s=s.substring(0,s.length() / 2).concat("?");
      }
      g.drawString(s,(int)boxMiddle - textWidth / 2,y + fontHeight - 2);
    }
    if (parentPos != null) {
      final double parentMiddle=parentPos.get(data.parent(pre,Data.ELEM));
      g.setColor(new Color(c,0,255 - c,100));
      g.drawLine((int)boxMiddle,y - 1,(int)parentMiddle,y - fontHeight + 1);
    }
    if (nodeSize > 0)     temp.put(pre,boxMiddle);
    x+=ratio;
  }
  parentPos=temp;
}
