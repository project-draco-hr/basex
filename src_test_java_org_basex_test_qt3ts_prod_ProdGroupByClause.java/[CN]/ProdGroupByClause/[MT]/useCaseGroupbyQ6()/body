{
  final XQuery query=new XQuery("\n" + "               <result>{\n" + "                 for $sales in $sales-records-doc/*/record\n"+ "                 let $storeno := $sales/store-number,\n"+ "                   $product := $products-doc/*/product[name = $sales/product-name],\n"+ "                   $prd := $product,\n"+ "                   $profit := $sales/qty * ($prd/price - $prd/cost)\n"+ "                 group by $storeno\n"+ "                 let $total-store-profit := sum($profit)\n"+ "                 where $total-store-profit > 100\n"+ "                 order by $total-store-profit descending\n"+ "                 return\n"+ "                   <store number = \"{$storeno}\" total-profit = \"{$total-store-profit}\"/>\n"+ "                }</result>\n"+ "      ",ctx);
  query.bind("$products-doc",node(file("prod/GroupByClause/products.xml")));
  query.bind("$sales-records-doc",node(file("prod/GroupByClause/sales-records.xml")));
  query.bind("$stores-doc",node(file("prod/GroupByClause/stores.xml")));
  query.bind("$books-doc",node(file("prod/GroupByClause/books.xml")));
  final QT3Result res=result(query);
  result=res;
  test(assertSerialization("<result><store number=\"3\" total-profit=\"7320\"/><store number=\"2\" total-profit=\"3030\"/><store number=\"1\" total-profit=\"2100\"/></result>",false));
}
