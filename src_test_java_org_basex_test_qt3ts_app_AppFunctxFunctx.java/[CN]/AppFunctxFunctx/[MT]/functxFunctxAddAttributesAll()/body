{
  final XQuery query=new XQuery("\n" + "         declare namespace functx = \"http://www.example.com/\";\n" + "         declare namespace new = \"http://new\";\n"+ "         (:~ \n"+ "            : Adds attributes to XML elements : \n"+ "            : @author Priscilla Walmsley, Datypic \n"+ "            : @version 1.0 : @see http://www.xqueryfunctions.com/xq/functx_add-attributes.html \n"+ "            : @param $elements the element(s) to which you wish to add the attribute \n"+ "            : @param $attrNames the name(s) of the attribute(s) to add \n"+ "            : @param $attrValues the value(s) of the attribute(s) to add :)\n"+ "         declare function functx:add-attributes ( $elements as element()* , $attrNames as xs:QName* , $attrValues as xs:anyAtomicType* ) as element()? { \n"+ "            for $element in $elements \n"+ "            return element { node-name($element)} { \n"+ "               for $attrName at $seq in $attrNames \n"+ "               return if ($element/@*[node-name(.) = $attrName]) then () else attribute {$attrName} {$attrValues[$seq]}, $element/@*, $element/node() } \n"+ "         } ;\n"+ "         let $in-xml := <in-xml> <a>x</a> <b att1=\"x\">x</b> </in-xml> \n"+ "         return (functx:add-attributes( $in-xml/a, xs:QName('att1'), 1), \n"+ "                  functx:add-attributes( $in-xml/a, (xs:QName('att1'),xs:QName('att2')), (1,2)), \n"+ "                  functx:add-attributes( $in-xml/b, (xs:QName('att1'),xs:QName('att2')), (1,2)), \n"+ "                  functx:add-attributes( $in-xml/a, xs:QName('new:att1'), 1), \n"+ "                  functx:add-attributes( $in-xml/a, QName('http://new','new:att1'), 1))\n"+ "      ",ctx);
  final QT3Result res=result(query);
  result=res;
  test(assertSerialization("<a att1=\"1\">x</a><a att1=\"1\" att2=\"2\">x</a><b att2=\"2\" att1=\"x\">x</b><a xmlns:new=\"http://new\" new:att1=\"1\">x</a><a xmlns:new=\"http://new\" new:att1=\"1\">x</a>",false));
}
