{
  final QueryProcessor qp=new QueryProcessor(query,context);
  qp.sc.baseURI(".");
  try {
    final ArrayOutput ao=new ArrayOutput();
    final Serializer ser=qp.getSerializer(ao);
    qp.execute().serialize(ser);
    ser.close();
    final String res=ao.toString().replaceAll("(\\r|\\n)+ *","");
    final StringBuilder sb=new StringBuilder("Query did not fail:\n");
    sb.append(query).append("\n[E]");
    for (    final Err e : error)     sb.append(" ").append(e);
    fail(sb.append("\n[F] ").append(res).toString());
  }
 catch (  final QueryIOException ex) {
    check(query,ex.getCause(),error);
  }
catch (  final QueryException ex) {
    check(query,ex,error);
  }
catch (  final Exception ex) {
    ex.printStackTrace();
    fail("Unexpected exception: " + ex);
  }
 finally {
    qp.close();
  }
}
