{
  final XQuery query=new XQuery("\n" + "<result>{\n" + "  for tumbling window $w in ./stream/event\n"+ "    start  $s when $s/person eq \"Anton\" and $s/direction eq \"in\"\n"+ "    only end $e next $n when  xs:dateTime($n/@time) - xs:dateTime($s/@time) gt\n"+ "      xs:dayTimeDuration(\"PT1H\")\n"+ "      or  ($e/person eq \"Barbara\" and $e/direction eq \"in\")\n"+ "      or ($e/person eq \"Anton\" and $e/direction eq \"out\")\n"+ "  where $e/person eq \"Barbara\" and $e/direction eq \"in\"\n"+ "  return\n"+ "    <warning time=\"{ $e/@time }\">Barbara: Anton arrived 1h ago</warning>\n"+ "}</result>\n"+ "      ",ctx);
  try {
    query.context(node(file("prod/WindowClause/person_events.xml")));
    result=new QT3Result(query.value());
  }
 catch (  final Throwable trw) {
    result=new QT3Result(trw);
  }
 finally {
    query.close();
  }
  test(assertSerialization("<result><warning time=\"2006-01-01T11:00:00-00:00\">Barbara: Anton arrived 1h ago</warning></result>",false));
}
