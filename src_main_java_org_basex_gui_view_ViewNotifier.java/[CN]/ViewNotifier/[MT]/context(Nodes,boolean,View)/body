{
  final Context ctx=gui.context;
  final Nodes newn=nodes.checkRoot();
  final Nodes empty=new Nodes(new int[0],ctx.data(),ctx.marked.ftpos);
  final Nodes curr=quick ? ctx.current() : null;
  final Nodes cmp=quick ? curr : ctx.marked;
  if (cont[hist] == null ? cmp != null : cmp == null || !cont[hist].sameAs(cmp)) {
    checkHist();
    if (quick) {
      queries[hist]="";
      marked[hist]=new Nodes(ctx.data());
      cont[++hist]=curr;
    }
 else {
      final String in=gui.input.getText();
      queries[hist]=in;
      marked[hist]=ctx.marked;
      cont[++hist]=newn;
      queries[hist]=in;
      marked[hist]=empty;
    }
    histsize=hist;
  }
  ctx.set(newn,empty);
  for (  final View v : view)   if (v != vw && v.visible())   v.refreshContext(true,quick);
  gui.refreshControls();
}
