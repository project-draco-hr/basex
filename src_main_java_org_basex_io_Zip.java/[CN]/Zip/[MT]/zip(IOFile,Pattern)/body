{
  if (!(archive instanceof IOFile))   throw new FileNotFoundException(archive.path());
  final byte[] data=new byte[IO.BLOCKSIZE];
  final ZipOutputStream out=new ZipOutputStream(new BufferedOutputStream(new FileOutputStream(archive.path())));
  curr=0;
  try {
    out.setLevel(1);
    out.putNextEntry(new ZipEntry(source.name() + '/'));
    out.closeEntry();
    final StringList files=source.descendants();
    total=files.size();
    for (    final String io : files) {
      curr++;
      if (pattern != null && !pattern.matcher(io).matches())       continue;
      final FileInputStream in=new FileInputStream(new File(source.file(),io));
      try {
        out.putNextEntry(new ZipEntry(source.name() + '/' + io));
        for (int c; (c=in.read(data)) != -1; )         out.write(data,0,c);
        out.closeEntry();
      }
  finally {
        in.close();
      }
    }
  }
  finally {
    out.close();
  }
}
