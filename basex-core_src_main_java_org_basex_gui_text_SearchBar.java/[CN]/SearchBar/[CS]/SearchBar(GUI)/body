{
  layout(new BorderLayout(2,0));
  mode(Fill.NONE);
  setVisible(false);
  gui=main;
  search=new BaseXTextField(main);
  search.history(gui,GUIOptions.SEARCHED);
  search.setPreferredSize(null);
  search.hint(Text.FIND);
  replace=new BaseXTextField(main);
  replace.history(gui,GUIOptions.REPLACED);
  replace.setPreferredSize(null);
  replace.hint(Text.REPLACE_WITH);
  regex=onOffButton("s_regex",Text.REGULAR_EXPR,GUIOptions.SR_REGEX);
  mcase=onOffButton("s_case",Text.MATCH_CASE,GUIOptions.SR_CASE);
  word=onOffButton("s_word",Text.WHOLE_WORD,GUIOptions.SR_WORD);
  multi=onOffButton("s_multi",Text.MULTI_LINE,GUIOptions.SR_MULTI);
  rplc=BaseXButton.get("s_replace",false,Text.REPLACE_ALL,main);
  cls=BaseXButton.get("s_close",false,BaseXLayout.addShortcut(Text.CLOSE,ESCAPE.toString()),main);
  multi.setEnabled(regex.isSelected());
  word.setEnabled(!regex.isSelected());
  search.addKeyListener(new KeyAdapter(){
    @Override public void keyPressed(    final KeyEvent e){
      if (FINDPREV1.is(e) || FINDPREV2.is(e) || FINDNEXT1.is(e)|| FINDNEXT2.is(e)) {
        editor.text.noSelect();
        deactivate(false);
      }
 else       if (ESCAPE.is(e)) {
        deactivate(search.getText().isEmpty());
      }
 else       if (ENTER.is(e)) {
        editor.jump(e.isShiftDown() ? SearchDir.BACKWARD : SearchDir.FORWARD,true);
      }
    }
    @Override public void keyReleased(    final KeyEvent e){
      main.gopts.set(GUIOptions.SR_SEARCH,search.getText());
      search();
    }
  }
);
  BaseXLayout.addDrop(search,new DropHandler(){
    @Override public void drop(    final Object object){
      search.setText(object.toString());
      search();
    }
  }
);
  replace.addKeyListener(escape);
  replace.addKeyListener(new KeyAdapter(){
    @Override public void keyReleased(    final KeyEvent e){
      main.gopts.set(GUIOptions.SR_REPLACE,replace.getText());
    }
  }
);
  cls.addKeyListener(escape);
  cls.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      deactivate(true);
    }
  }
);
  rplc.addKeyListener(escape);
  rplc.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      search.store();
      replace.store();
      final String in=replace.getText();
      editor.replace(new ReplaceContext(regex.isSelected() ? decode(in) : in));
      deactivate(true);
    }
  }
);
}
