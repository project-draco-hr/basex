{
  final int typeIndex=index(p.type);
  if (typeIndex == -1) {
    prim.add(p);
  }
 else {
    final UpdatePrimitive up=prim.get(typeIndex);
    if (up instanceof InsertInto) {
      final InsertInto oprim=(InsertInto)up;
      final InsertInto nprim=(InsertInto)p;
      if (nprim instanceof ReplaceContent) {
        prim.set(typeIndex,nprim);
      }
 else       if (!(oprim instanceof ReplaceContent)) {
        up.merge(p);
      }
    }
 else {
      up.merge(p);
    }
  }
}
