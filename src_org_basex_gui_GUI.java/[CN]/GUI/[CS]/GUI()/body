{
  setTitle(Text.TITLE);
  setIconImage(image("icon"));
  final Dimension scr=Toolkit.getDefaultToolkit().getScreenSize();
  final int w=GUIProp.guisize[0];
  final int h=GUIProp.guisize[1];
  final int x=Math.max(0,Math.min(scr.width - w,GUIProp.guiloc[0]));
  final int y=Math.max(0,Math.min(scr.height - h,GUIProp.guiloc[1]));
  setBounds(x,y,w,h);
  if (GUIProp.maxstate) {
    setExtendedState(MAXIMIZED_HORIZ);
    setExtendedState(MAXIMIZED_VERT);
    setExtendedState(MAXIMIZED_BOTH);
  }
  top=new BaseXBack();
  top.setLayout(new BorderLayout());
  control=new BaseXBack();
  control.setLayout(new BorderLayout());
  control.setBorder(0,0,0,1);
  menu=new GUIMenu(this);
  if (GUIProp.showmenu)   setJMenuBar(menu);
  final Font fnt=new Font(GUIProp.font,1,15);
  buttons=new BaseXBack();
  buttons.setLayout(new BorderLayout());
  toolbar=new GUIToolBar(TOOLBAR,this);
  buttons.add(toolbar,BorderLayout.WEST);
  hits=new BaseXLabel(" ");
  hits.setFont(fnt);
  BaseXLayout.setWidth(hits,150);
  hits.setHorizontalAlignment(SwingConstants.RIGHT);
  BaseXBack b=new BaseXBack();
  b.add(hits);
  buttons.add(b,BorderLayout.EAST);
  if (GUIProp.showbuttons)   control.add(buttons,BorderLayout.CENTER);
  nav=new BaseXBack();
  nav.setLayout(new BorderLayout(5,0));
  nav.setBorder(2,2,0,2);
  mode=new BaseXCombo(new String[]{BUTTONSEARCH,BUTTONXQUERY,BUTTONCMD},HELPMODE);
  mode.setSelectedIndex(2);
  mode.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      final int s=mode.getSelectedIndex();
      if (s == GUIProp.searchmode || !mode.isEnabled())       return;
      GUIProp.searchmode=s;
      input.setText("");
      refreshControls();
    }
  }
);
  mode.addKeyListener(new KeyAdapter(){
    @Override public void keyPressed(    final KeyEvent e){
      checkKeys(e);
    }
  }
);
  nav.add(mode,BorderLayout.WEST);
  input=new GUIInput(this);
  hist=new BaseXButton(icon("cmd-hist"),HELPHIST);
  hist.trim();
  hist.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      final JPopupMenu popup=new JPopupMenu("History");
      final ActionListener al=new ActionListener(){
        public void actionPerformed(        final ActionEvent ac){
          input.setText(ac.getActionCommand());
          input.requestFocusInWindow();
          popup.setVisible(false);
        }
      }
;
      final int i=!context.db() ? 2 : GUIProp.searchmode;
      final String[] hs=i == 0 ? GUIProp.search : i == 1 ? GUIProp.xquery : GUIProp.commands;
      for (      final String en : hs) {
        final JMenuItem jmi=new JMenuItem(en);
        jmi.addActionListener(al);
        popup.add(jmi);
      }
      popup.show(hist,0,hist.getHeight());
    }
  }
);
  b=new BaseXBack();
  b.setLayout(new BorderLayout(5,0));
  b.add(hist,BorderLayout.WEST);
  b.add(input,BorderLayout.CENTER);
  nav.add(b,BorderLayout.CENTER);
  go=new BaseXButton(icon("cmd-go"),HELPGO);
  go.trim();
  go.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      execute();
    }
  }
);
  go.addKeyListener(new KeyAdapter(){
    @Override public void keyPressed(    final KeyEvent e){
      checkKeys(e);
    }
  }
);
  filter=GUIToolBar.newButton(GUICommands.FILTER,this);
  filter.addKeyListener(new KeyAdapter(){
    @Override public void keyPressed(    final KeyEvent e){
      checkKeys(e);
    }
  }
);
  b=new BaseXBack();
  b.setLayout(new TableLayout(1,3));
  b.add(go);
  b.add(Box.createHorizontalStrut(1));
  b.add(filter);
  nav.add(b,BorderLayout.EAST);
  if (GUIProp.showinput)   control.add(nav,BorderLayout.SOUTH);
  top.add(control,BorderLayout.NORTH);
  notify=new ViewNotifier(this);
  query=new QueryView(notify,null);
  text=new TextView(notify);
  info=new InfoView(notify,HELPINFO);
  final ViewPanel textpanel=new ViewPanel(text,TEXTVIEW);
  final ViewPanel[][] panels={{textpanel},{new ViewPanel(new FolderView(notify),FOLDERVIEW),new ViewPanel(new PlotView(notify),PLOTVIEW),new ViewPanel(new TableView(notify),TABLEVIEW),new ViewPanel(new MapView(notify),MAPVIEW),new ViewPanel(query,QUERYVIEW),new ViewPanel(info,INFOVIEW),textpanel}};
  views=new ViewContainer(this,panels);
  views.setViews(false);
  top.add(views,BorderLayout.CENTER);
  setContentBorder();
  status=new GUIStatus(this);
  if (GUIProp.showstatus)   top.add(status,BorderLayout.SOUTH);
  setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);
  add(top);
  setVisible(true);
  views.updateViews();
  refreshControls();
  new Action(){
    public void run(){
      views.run();
    }
  }
.execute();
  input.requestFocusInWindow();
}
