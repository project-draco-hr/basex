{
  final int thread=++threadID;
  while (proc != null) {
    proc.stop();
    Performance.sleep(50);
    if (threadID != thread)     return true;
  }
  cursor(CURSORWAIT);
  try {
    final Performance perf=new Performance();
    final Nodes current=context.current();
    final Data data=context.data();
    proc=pr;
    updating=pr.updating();
    final boolean ok=pr.execute(context);
    updating=false;
    final String inf=pr.info();
    if (!ok && inf.equals(PROGERR)) {
      proc=null;
      return false;
    }
    final Result result=pr.result();
    final Nodes nodes=result instanceof Nodes ? (Nodes)result : null;
    if (ok && pr.printing()) {
      if (!text.visible() && nodes == null)       GUICommands.SHOWTEXT.execute(this);
      if (text.visible()) {
        final CachedOutput out=new CachedOutput(context.prop.num(Prop.MAXTEXT));
        pr.output(out);
        text.setText(out);
      }
    }
    boolean feedback=main;
    if (!main && query.visible() && pr instanceof XQuery) {
      feedback=true;
      query.info(inf,ok);
    }
    if (prop.is(GUIProp.SHOWINFO) && (ok || main))     info.setInfo(Token.token(inf),ok);
    if (!ok) {
      if (!feedback) {
        if (!text.visible())         GUICommands.SHOWTEXT.execute(this);
        text.setText(Token.token(inf));
      }
      cursor(CURSORARROW,true);
      proc=null;
      return false;
    }
    final Data ndata=context.data();
    final String time=perf.getTimer();
    Nodes marked=context.marked();
    if (ndata != data) {
      notify.init();
    }
 else     if (pr.updating()) {
      notify.update();
    }
 else     if (result != null) {
      if (context.current() != current || prop.is(GUIProp.FILTERRT)) {
        if (nodes != null) {
          notify.context((Nodes)result,prop.is(GUIProp.FILTERRT),null);
        }
      }
 else       if (marked != null) {
        if (nodes != null) {
          marked=nodes;
        }
 else         if (marked.size() != 0) {
          marked=new Nodes(data);
        }
        if (!marked.same(context.marked())) {
          notify.mark(marked,null);
        }
        if (thread != threadID) {
          proc=null;
          return true;
        }
      }
    }
    setHits(result == null ? 0 : result.size());
    status.setText(BaseX.info(PROCTIME,time));
  }
 catch (  final Exception ex) {
    ex.printStackTrace();
    Dialog.error(this,BaseX.info(PROCERR,pr,ex.toString().length() != 0 ? ex.toString() : ex.getMessage()));
    updating=false;
  }
  cursor(CURSORARROW,true);
  proc=null;
  return true;
}
