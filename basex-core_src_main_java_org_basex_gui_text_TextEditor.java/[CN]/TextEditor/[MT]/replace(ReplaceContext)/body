{
  final int tl=text.length;
  int start=Math.min(selectPos,selectEnd);
  int end=Math.max(selectPos,selectEnd);
  boolean sel=selected();
  if (sel) {
    int p=start - 1;
    while (++p < end && text[p] != '\n')     ;
    sel=p < end;
  }
  if (!sel) {
    start=0;
    end=tl;
  }
  return rc.replace(search,text,start,end);
}
