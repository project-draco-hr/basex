{
  final boolean frag=p.node instanceof FNode;
  if (t && (frag || !refs.contains(((DBNode)p.node).data)))   Err.or(UPWRONGTRG,p.node);
  if (frag) {
    frags.add(p);
  }
 else   if (p.node instanceof DBNode) {
    final Data d=((DBNode)p.node).data;
    DBPrimitives dp=dbs.get(d);
    if (dp == null) {
      if (ctx.context.perm(User.WRITE,d) != -1)       throw new QueryException(Main.info(PERMNO,CmdPerm.WRITE));
      dp=new DBPrimitives(d);
      dbs.put(d,dp);
    }
    dp.add(p);
  }
}
