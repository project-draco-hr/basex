{
  final Item[] its=new Item[gv.length];
  for (int i=0; i < gv.length; ++i) {
    final Value val=ctx.vars.get(gv[i]).value(ctx);
    if (val.item())     its[i]=(Item)val;
 else     throw new QueryException(null,QueryText.XGRP);
  }
  boolean found=false;
  int p=0;
  final GroupNode cand=new GroupNode(its,gv.length);
  final Integer chash=cand.hashCode();
  if (hashes.containsKey(chash)) {
    final IntList ps=hashes.get(cand.hash);
    for (    final int pp : ps.toArray()) {
      if (cand.eq(partitions.get(pp))) {
        found=true;
        p=pp;
        break;
      }
    }
  }
  if (!found) {
    if (order != null)     order.add(ctx);
    p=partitions.size();
    partitions.add(cand);
    final IntList pos=hashes.get(chash) != null ? hashes.get(chash) : new IntList(8);
    pos.add(p);
    hashes.put(chash,pos);
  }
  addNonGrpIts(ctx,p);
}
