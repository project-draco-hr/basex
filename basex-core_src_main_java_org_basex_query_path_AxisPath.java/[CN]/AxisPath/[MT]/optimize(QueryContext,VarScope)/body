{
  final Expr opt=super.optimize(ctx,scp);
  if (opt != this)   return opt;
  final Value v=ctx.value;
  try {
    ctx.value=root(ctx);
    final Data data=ctx.data();
    if (data != null && ctx.value.type == NodeType.DOC) {
      Expr e=index(ctx,data);
      if (e == this)       e=children(ctx,data);
      if (e != this)       return e.compile(ctx,scp);
    }
    return finish(ctx);
  }
  finally {
    ctx.value=v;
  }
}
