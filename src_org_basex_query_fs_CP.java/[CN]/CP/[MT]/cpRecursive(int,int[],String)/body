{
  int[] dirs=new int[]{pre};
  final TokenList toInsert=new TokenList();
  if (target.length == 1) {
    if (FSUtils.isFile(data,target[0])) {
      error(FSUtils.getName(data,target[0]),20);
      return;
    }
  }
  int d=0;
  while (0 < dirs.length) {
    final IntList allDir=new IntList();
    while (d < dirs.length) {
      final int[] toCopy=FSUtils.getChildren(data,dirs[d]);
      toInsert.add(null);
      toInsert.add(FSUtils.getRelativePath(data,dirs[d],pre));
      for (      final int p : toCopy) {
        if (FSUtils.isDir(data,p)) {
          allDir.add(p);
          toInsert.add(Token.token("d"));
        }
 else {
          toInsert.add(Token.token("f"));
        }
        toInsert.add(FSUtils.getName(data,p));
        toInsert.add(FSUtils.getSuffix(data,p));
        toInsert.add(Token.token(FSUtils.getSize(data,p)));
      }
      ++d;
    }
    dirs=allDir.finish();
    d=0;
  }
  int copyRoot;
  int parPre;
  int preOfNewFile=4;
  if (target.length == 1) {
    if (!(target[0] == FSUtils.getROOTDIR())) {
      preOfNewFile=target[0] + FSUtils.NUMATT;
    }
    parPre=target[0];
    FSUtils.insert(data,true,FSUtils.getName(data,pre),Token.EMPTY,Token.ZERO,FSUtils.currTime(),parPre,preOfNewFile);
    parPre=preOfNewFile;
  }
 else {
    if (!(curPre == FSUtils.getROOTDIR())) {
      preOfNewFile=curPre + FSUtils.NUMATT;
    }
    parPre=preOfNewFile;
    FSUtils.insert(data,true,Token.token(targetFile),Token.EMPTY,Token.ZERO,FSUtils.currTime(),curPre,preOfNewFile);
  }
  copyRoot=parPre;
  final byte[] f=Token.token("f");
  while (toInsert.size != 0) {
    if (toInsert.list[0] == null) {
      toInsert.delete(0);
      parPre=FSUtils.goToDir(data,copyRoot,Token.string(toInsert.delete(0)));
      continue;
    }
    final boolean isDir=!Token.eq(toInsert.delete(0),f);
    FSUtils.insert(data,isDir,toInsert.delete(0),toInsert.delete(0),toInsert.delete(0),FSUtils.currTime(),parPre,parPre + FSUtils.NUMATT);
  }
}
