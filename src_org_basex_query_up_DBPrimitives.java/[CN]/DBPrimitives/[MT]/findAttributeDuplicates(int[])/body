{
  final ObjectMap<Integer> m=new ObjectMap<Integer>();
  final Set<Integer> ats=new HashSet<Integer>();
  for (  final int pre : pres) {
    if (d.kind(pre) == Data.ATTR) {
      ats.add(pre);
      for (      final UpdatePrimitive up : op.get(pre)) {
        if (up == null)         continue;
        changeAttributePool(m,true,up.addAtt());
        changeAttributePool(m,false,up.remAtt());
      }
    }
 else {
      addElementChanges(m,pre);
      for (int p=pre + 1; p < pre + d.attSize(pre,Data.ELEM); p++) {
        if (!ats.contains(p))         changeAttributePool(m,true,d.attName(p));
      }
    }
  }
  findDuplicates(m);
}
