{
  final List<BXResource> dbs=new ArrayList<BXResource>();
  final TokenObjMap<IntList> dirs=new TokenObjMap<IntList>();
  try {
    new Open(dbname).execute(ctx);
    for (    final int pre : prevals) {
      final String doc=string(ctx.data.text(pre,true));
      final String s=doc.substring(dirpath.length(),doc.length());
      final int idx=s.lastIndexOf(Prop.DIRSEP);
      if (idx == 0)       dbs.add(new BXDocument(dbname,s.substring(1,s.length()),pre,ctx));
 else       if (idx > 0) {
        final String[] parts=s.split(Prop.DIRSEP);
        final byte[] dir=token(dirpath + Prop.DIRSEP + parts[1]);
        if (dirs.get(dir) == null)         dirs.add(dir,new IntList());
        dirs.get(dir).add(pre);
      }
    }
    for (    final byte[] d : dirs)     dbs.add(new BXFolder(dbname,dirs.get(d).toArray(),string(d),ctx));
    new Close().execute(ctx);
  }
 catch (  BaseXException e) {
    e.printStackTrace();
  }
  return dbs;
}
