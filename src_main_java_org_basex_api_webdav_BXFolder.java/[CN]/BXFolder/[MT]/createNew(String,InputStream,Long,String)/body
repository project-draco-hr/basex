{
  if (supported(contentType)) {
    try {
      final Session s=factory.login(user,pass);
      try {
        s.execute(new Open(db));
        final String doc=path.isEmpty() ? newName : path + SEP + newName;
        if (factory.resource(s,db,doc,user,pass) == null)         s.add(newName,path,inputStream);
 else         s.replace(doc,inputStream);
        if (factory.resource(s,db,path + SEP + EMPTYXML,user,pass) != null)         s.execute(new Delete(path + SEP + EMPTYXML));
        return new BXDocument(db,path + SEP + newName,factory,user,pass);
      }
  finally {
        s.close();
      }
    }
 catch (    Exception ex) {
      handle(ex);
    }
  }
  return null;
}
