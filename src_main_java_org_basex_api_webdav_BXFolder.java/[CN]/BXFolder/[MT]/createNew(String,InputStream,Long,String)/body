{
  return new BXCode<BXDocument>(this){
    @Override public BXDocument get() throws IOException {
      s.execute(new Open(db));
      final String doc=path.isEmpty() ? newName : path + SEP + newName;
      if (count(s,db,doc) == 0) {
        final LookupInput li=new LookupInput(input);
        if (li.lookup() == '<')         s.add(newName,path,li);
 else         s.store(path + SEP + newName,li);
        deleteDummy(s,db,path);
      }
 else {
        s.replace(doc,input);
      }
      return new BXDocument(db,doc,session,isRaw(s,db,doc));
    }
  }
.eval();
}
