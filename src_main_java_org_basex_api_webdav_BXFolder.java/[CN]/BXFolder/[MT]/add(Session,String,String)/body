{
  final Query q=s.query("for $d in " + DBLIST.args("$db","$path") + "let $t := tokenize(substring($d, string-length($path) + 1), '/') "+ "let $p := string-join(($trgdir, $t[position() < last()]), '/') "+ "let $n := $t[last()] return "+ "if ("+ DBISRAW.args("$db","$d")+ ") then "+ DBSTORE.args("$trgdb","$p||'/'||$n",DBRETRIEVE.args("$db","$d"))+ " else "+ DBADD.args("$trgdb",DBOPEN.args("$db","$d"),"$n","$p"));
  q.bind("db",db);
  q.bind("path",path);
  q.bind("trgdb",trgdb);
  q.bind("trgdir",trgdir);
  q.execute();
}
