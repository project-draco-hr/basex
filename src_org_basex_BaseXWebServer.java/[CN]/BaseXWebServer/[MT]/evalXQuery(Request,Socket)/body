{
  final OutputStream os=s.getOutputStream();
  final PrintOutput out=new PrintOutput(new BufferedOutput(os));
  out.println("HTTP/1.1 200 OK");
  out.println("Server: BaseXWebServer");
  out.println("Content-Type: text/html; charset=utf-8" + NL);
  out.println(DOCTYPE);
  try {
    QueryProcessor xq=null;
    if (cache) {
      final String key=req.file + "/" + req.file.date();
      xq=map.get(key);
      if (xq == null) {
        final String query=Token.string(req.file.content());
        xq=new QueryProcessor(query,context);
        xq.ctx.file=req.file;
        map.put(key,xq);
      }
    }
 else {
      final String query=Token.string(req.file.content());
      xq=new QueryProcessor(query,context);
      xq.ctx.file=req.file;
    }
    for (    final String[] arg : req.args) {
      final Var v=new Var(new QNm(Token.token(arg[0])),true);
      final String val=arg.length == 2 ? arg[1] : "";
      xq.ctx.vars.addGlobal(v.bind(Str.get(val),null));
    }
    xq.query().serialize(new XMLSerializer(out));
  }
 catch (  final Exception ex) {
    if (ex instanceof IOException) {
      out.println(SERVERERR);
    }
 else     if (ex instanceof QueryException) {
      out.println(HEADER + "<pre><font color='red'>" + ex.getMessage()+ "</font></pre>"+ FOOTER);
    }
 else {
      out.println(ex.toString());
    }
    BaseX.debug(ex);
  }
  out.close();
}
