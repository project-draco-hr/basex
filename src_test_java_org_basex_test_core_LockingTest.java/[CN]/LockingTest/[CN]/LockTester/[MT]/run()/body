{
  if (null != await) {
    try {
      if (!await.await(WAIT,TimeUnit.MILLISECONDS))       fail("Latch timed out.");
    }
 catch (    final InterruptedException e) {
      throw new RuntimeException("Unexpectedly interrupted.");
    }
  }
  final Command cmd=new Cmd(writing);
  locks.acquire(cmd,null != readObjects ? new StringList().add(readObjects) : null,null != writeObjects ? new StringList().add(writeObjects) : null);
  if (null != countDown)   countDown.countDown();
synchronized (this) {
    try {
      while (!requestRelease || null != downgrade) {
        if (null != downgrade) {
          locks.downgrade(new StringList().add(downgrade));
          downgrade=null;
        }
        if (!requestRelease)         wait();
      }
    }
 catch (    final InterruptedException e) {
      throw new RuntimeException("Unexpectedly interrupted.");
    }
  }
  locks.release(cmd);
}
