{
  parseArguments(args);
  if (Prop.MAC) {
    try {
      osxGUI=new GUIMacOSX();
    }
 catch (    final Exception ex) {
      throw new BaseXException("Failed to initialize native Mac OS X interface",ex);
    }
  }
  final GUIOptions gopts=new GUIOptions();
  context.options.set(MainOptions.CACHEQUERY,true);
  context.options.set(MainOptions.MAXHITS,gopts.num(GUIOptions.MAXHITS));
  GUIConstants.init(gopts);
  SwingUtilities.invokeLater(new Runnable(){
    @Override public void run(){
      init(gopts);
      final GUI gui=new GUI(context,gopts);
      if (osxGUI != null)       osxGUI.init(gui);
      boolean xml=false;
      for (      final String file : files) {
        if (file.matches("^.*\\" + IO.BASEXSUFFIX + "[^.]*$"))         continue;
        final IOFile io=new IOFile(file);
        boolean xq=file.endsWith(IO.BXSSUFFIX);
        for (        final String suf : IO.XQSUFFIXES)         xq|=file.endsWith(suf);
        if (xq) {
          gui.editor.open(io,true);
        }
 else         if (!xml) {
          gopts.set(GUIOptions.INPUTPATH,io.path());
          gopts.set(GUIOptions.DBNAME,io.dbname());
          DialogProgress.execute(gui,new Check(file));
          xml=true;
        }
      }
    }
  }
);
  Runtime.getRuntime().addShutdownHook(new Thread(){
    @Override public synchronized void run(){
      context.close();
    }
  }
);
}
