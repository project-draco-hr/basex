{
  final QNm name=new QNm(qName(DECLFUNC));
  name.uri=name.ns() ? ctx.ns.uri(name.pre()) : ctx.nsFunc;
  if (name.pre().length == 0 && Type.find(name,true) != null)   Err.or(FUNCRES,name);
  if (module != null && !name.uri.eq(module.uri))   Err.or(MODNS,name);
  check(PAR1);
  skipWS();
  Var[] args=new Var[0];
  final int s=ctx.vars.size();
  while (curr() == '$') {
    final QNm arg=varName();
    final SeqType argType=consumeWS(AS) ? sequenceType() : null;
    final Var var=new Var(arg,argType);
    ctx.vars.add(var);
    for (    final Var v : args)     if (v.name.eq(arg))     Err.or(FUNCDUPL,arg);
    args=Array.add(args,var);
    if (!consume(','))     break;
    skipWS();
  }
  check(PAR2);
  final SeqType type=consumeWS(AS) ? sequenceType() : null;
  final Func func=new Func(new Var(name,type),args,true);
  ctx.fun.add(func);
  if (!consumeWS(EXTERNAL))   func.expr=enclosed(NOFUNBODY);
  ctx.vars.reset(s);
}
