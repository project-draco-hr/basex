{
  dirty=true;
  cursor(first);
  int from=first - firstPre;
  final int last=first + nr;
  if (last - 1 < nextPre) {
    copy(bf.buf,from + nr,bf.buf,from,nextPre - last);
    updatePre(nr);
    if (nextPre == firstPre) {
      Array.move(firstPres,index + 1,-1,indexSize - index - 1);
      Array.move(blocks,index + 1,-1,indexSize - index - 1);
      readBlock(index,firstPre,index + 2 > --indexSize ? count : firstPres[index + 1]);
    }
    return;
  }
  int unused=0;
  while (nextPre < last) {
    if (from == 0)     unused++;
    nextBlock();
    from=0;
  }
  if (unused > 0) {
    Array.move(firstPres,index,-unused,indexSize - index);
    Array.move(blocks,index,-unused,indexSize - index);
    indexSize-=unused;
    index-=unused;
  }
  copy(bf.buf,last - firstPre,bf.buf,0,nextPre - last);
  firstPres[index]=first;
  firstPre=first;
  updatePre(nr);
}
