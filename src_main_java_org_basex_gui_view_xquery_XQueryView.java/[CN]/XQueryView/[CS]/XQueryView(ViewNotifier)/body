{
  super(XQUERYVIEW,HELPXQUERYY,man);
  border(6,6,6,6).layout(new BorderLayout()).setFocusable(false);
  header=new BaseXLabel(XQUERYTIT,true,false);
  final BaseXBack b=new BaseXBack(Fill.NONE).layout(new BorderLayout());
  b.add(header,BorderLayout.CENTER);
  final BaseXButton openB=BaseXButton.command(GUICommands.XQOPEN,gui);
  final BaseXButton saveB=new BaseXButton(gui,"xqsave",Token.token(GUISAVETT));
  saveB.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      final JPopupMenu pop=new JPopupMenu();
      final StringBuilder mnem=new StringBuilder();
      final JMenuItem sa=GUIMenu.newItem(GUICommands.XQSAVE,gui,mnem);
      final JMenuItem sas=GUIMenu.newItem(GUICommands.XQSAVEAS,gui,mnem);
      GUICommands.XQSAVE.refresh(gui,sa);
      GUICommands.XQSAVEAS.refresh(gui,sas);
      pop.add(sa);
      pop.add(sas);
      pop.show(saveB,0,saveB.getHeight());
    }
  }
);
  final BaseXTextField find=new BaseXTextField(gui);
  BaseXLayout.setHeight(find,(int)openB.getPreferredSize().getHeight());
  final BaseXButton hist=new BaseXButton(gui,"hist",HELPRECENT);
  hist.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      final JPopupMenu popup=new JPopupMenu();
      final ActionListener al=new ActionListener(){
        @Override public void actionPerformed(        final ActionEvent ac){
          confirm();
          setQuery(IO.get(ac.getActionCommand()));
        }
      }
;
      if (gui.gprop.strings(GUIProp.QUERIES).length == 0) {
        popup.add(new JMenuItem("- No recently opened files -"));
      }
      for (      final String en : gui.gprop.strings(GUIProp.QUERIES)) {
        final JMenuItem jmi=new JMenuItem(en);
        jmi.addActionListener(al);
        popup.add(jmi);
      }
      popup.show(hist,0,hist.getHeight());
    }
  }
);
  final BaseXButton close=BaseXButton.command(GUICommands.XQCLOSE,gui);
  BaseXBack sp=new BaseXBack(Fill.NONE).layout(new TableLayout(1,9));
  sp.add(find);
  sp.add(Box.createHorizontalStrut(5));
  sp.add(openB);
  sp.add(Box.createHorizontalStrut(1));
  sp.add(saveB);
  sp.add(Box.createHorizontalStrut(1));
  sp.add(hist);
  sp.add(Box.createHorizontalStrut(1));
  sp.add(close);
  b.add(sp,BorderLayout.EAST);
  add(b,BorderLayout.NORTH);
  text=new XQueryText(this);
  add(text,BorderLayout.CENTER);
  text.addSearch(find);
  south=new BaseXBack(Fill.NONE).layout(new BorderLayout(8,0));
  sp=new BaseXBack(Fill.NONE).layout(new BorderLayout(8,0));
  info=new BaseXLabel(" ");
  info.setText(OK,Msg.SUCCESS);
  info.addMouseListener(new MouseAdapter(){
    @Override public void mouseClicked(    final MouseEvent e){
      if (info.getName() == null)       return;
      text.setCaret(Integer.parseInt(info.getName()));
      text.requestFocusInWindow();
      pos.setText(text.pos());
    }
  }
);
  sp.add(info,BorderLayout.CENTER);
  pos=new BaseXLabel(" ");
  sp.add(pos,BorderLayout.EAST);
  south.add(sp,BorderLayout.CENTER);
  stop=new BaseXButton(gui,"stop",HELPSTOP);
  stop.addKeyListener(this);
  stop.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      stop.setEnabled(false);
      info.setText(OK,Msg.SUCCESS);
      gui.stop();
    }
  }
);
  stop.setEnabled(false);
  go=new BaseXButton(gui,"go",HELPGO);
  go.addKeyListener(this);
  go.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      text.query();
    }
  }
);
  filter=BaseXButton.command(GUICommands.FILTER,gui);
  filter.addKeyListener(this);
  sp=new BaseXBack(Fill.NONE).border(4,0,0,0).layout(new TableLayout(1,5));
  sp.add(stop);
  sp.add(Box.createHorizontalStrut(1));
  sp.add(go);
  sp.add(Box.createHorizontalStrut(1));
  sp.add(filter);
  south.add(sp,BorderLayout.EAST);
  add(south,BorderLayout.SOUTH);
  refreshLayout();
}
