{
  super(XQUERYVIEW,HELPXQUERYY,man);
  setLayout(new BorderLayout());
  setBorder(6,8,8,8);
  setFocusable(false);
  header=new BaseXLabel(XQUERYTIT,true,false);
  final BaseXBack b=new BaseXBack(Fill.NONE);
  b.setLayout(new BorderLayout());
  b.add(header,BorderLayout.CENTER);
  final BaseXButton open=BaseXButton.command(GUICommands.XQOPEN,gui);
  final BaseXButton saveB=new BaseXButton(gui,"xqsaveas",HELPSAVE);
  saveB.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      final JPopupMenu popup=new JPopupMenu(GUISAVE);
      final ActionListener al=new ActionListener(){
        @Override public void actionPerformed(        final ActionEvent ac){
          if (ac.getActionCommand().equals(GUISAVE)) {
            GUICommands.XQSAVE.execute(gui);
          }
 else {
            GUICommands.XQSAVEAS.execute(gui);
          }
        }
      }
;
      final JMenuItem save=new JMenuItem(GUISAVE);
      final JMenuItem saveAs=new JMenuItem(GUISAVEAS + DOTS);
      save.addActionListener(al);
      saveAs.addActionListener(al);
      popup.add(save);
      popup.add(saveAs);
      popup.show(saveB,0,saveB.getHeight());
    }
  }
);
  final BaseXTextField find=new BaseXTextField(gui);
  BaseXLayout.setHeight(find,(int)open.getPreferredSize().getHeight());
  final BaseXButton hist=new BaseXButton(gui,"hist",HELPRECENT);
  hist.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      final JPopupMenu popup=new JPopupMenu("History");
      final ActionListener al=new ActionListener(){
        @Override public void actionPerformed(        final ActionEvent ac){
          confirm();
          setQuery(IO.get(ac.getActionCommand()));
        }
      }
;
      if (gui.prop.strings(GUIProp.QUERIES).length == 0) {
        popup.add(new JMenuItem("- No recently opened files -"));
      }
      for (      final String en : gui.prop.strings(GUIProp.QUERIES)) {
        final JMenuItem jmi=new JMenuItem(en);
        jmi.addActionListener(al);
        popup.add(jmi);
      }
      popup.show(hist,0,hist.getHeight());
    }
  }
);
  final BaseXButton close=new BaseXButton(gui,"close",HELPQCLOSE);
  close.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      if (header.getText().endsWith("*")) {
        if (Dialog.confirm(gui,Util.info(XQUERYCONF,gui.context.query.name())))         GUICommands.XQSAVE.execute(gui);
      }
      text.setText(new byte[0]);
      header.setText(XQUERYTIT);
      gui.context.query=null;
    }
  }
);
  BaseXBack sp=new BaseXBack(Fill.NONE);
  sp.setLayout(new TableLayout(1,9));
  sp.add(find);
  sp.add(Box.createHorizontalStrut(5));
  sp.add(open);
  sp.add(Box.createHorizontalStrut(1));
  sp.add(saveB);
  sp.add(Box.createHorizontalStrut(1));
  sp.add(hist);
  sp.add(Box.createHorizontalStrut(1));
  sp.add(close);
  b.add(sp,BorderLayout.EAST);
  add(b,BorderLayout.NORTH);
  text=new XQueryText(this);
  add(text,BorderLayout.CENTER);
  text.addSearch(find);
  south=new BaseXBack(Fill.NONE);
  south.setLayout(new BorderLayout());
  info=new BaseXLabel(" ");
  info.setCursor(GUIConstants.CURSORHAND);
  info.setText(OK,Msg.SUCCESS);
  info.addMouseListener(new MouseAdapter(){
    @Override public void mouseClicked(    final MouseEvent e){
      if (info.getName() == null)       return;
      text.setCaret(Integer.parseInt(info.getName()));
      text.requestFocusInWindow();
    }
  }
);
  south.add(info,BorderLayout.CENTER);
  stop=new BaseXButton(gui,"stop",HELPSTOP);
  stop.addKeyListener(this);
  stop.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      stop.setEnabled(false);
      gui.stop();
    }
  }
);
  stop.setEnabled(false);
  go=new BaseXButton(gui,"go",HELPGO);
  go.addKeyListener(this);
  go.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      text.query();
    }
  }
);
  filter=BaseXButton.command(GUICommands.FILTER,gui);
  filter.addKeyListener(this);
  sp=new BaseXBack(Fill.NONE);
  sp.setLayout(new TableLayout(1,5));
  sp.setBorder(4,0,0,0);
  sp.add(stop);
  sp.add(Box.createHorizontalStrut(1));
  sp.add(go);
  sp.add(Box.createHorizontalStrut(1));
  sp.add(filter);
  south.add(sp,BorderLayout.EAST);
  add(south,BorderLayout.SOUTH);
  refreshLayout();
}
