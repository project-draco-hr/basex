{
  final XdmValue value=result.value;
  if (value == null)   return fail(Util.info("Serializes to: '%'",expect));
  final String res=normNL(asString("serialize(.,map{'indent':='no'})",value));
  if (expect.equals(res))   return true;
  String flags="'" + Mode.ALLNODES + "'";
  if (!ignorePref)   flags+=",'" + Mode.NAMESPACES + "'";
  final String query=Function.DEEP_EQUAL_OPT.args("<X>" + expect + "</X>","<X>" + res + "</X>","(" + flags + ")");
  return result(asBoolean(query,null),expect);
}
