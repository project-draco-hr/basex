{
  try {
    fl.release();
    if (lock) {
      exclusiveLock();
      if (fl != null)       return true;
      sharedLock();
      if (fl != null)       return false;
    }
 else {
      sharedLock();
      return fl != null;
    }
  }
 catch (  final IOException ex) {
    Util.stack(ex);
  }
  throw Util.notexpected((lock ? "Exclusive" : "Shared") + " lock could not be acquired.");
}
