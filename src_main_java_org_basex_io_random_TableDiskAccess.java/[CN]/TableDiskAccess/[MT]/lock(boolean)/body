{
  try {
    if (lock) {
      if (exclusiveLock())       return true;
      if (sharedLock())       return false;
    }
 else {
      if (sharedLock())       return true;
    }
  }
 catch (  final IOException ex) {
    Util.stack(ex);
  }
  throw Util.notexpected((lock ? "Exclusive" : "Shared") + " lock could not be acquired.");
}
