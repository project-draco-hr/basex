{
  for (  final DataUpdates up : dbUpdates.values()) {
    if (tmp == null)     tmp=new MemData(up.data().meta.options);
    up.prepare(tmp);
  }
  for (  final NameUpdates up : nameUpdates.values())   up.prepare();
  for (  final NameUpdates up : nameUpdates.values())   up.apply(true);
  final Set<Data> datas=new HashSet<Data>();
  for (  final Data data : dbUpdates.keySet())   datas.add(data);
  int i=0;
  try {
    for (    final Data data : datas) {
      if (!data.startUpdate())       throw BXDB_OPENED.get(null,data.meta.name);
      i++;
    }
    for (    final DataUpdates c : dbUpdates.values())     c.apply();
  }
  finally {
    for (    final Data data : datas) {
      if (i-- > 0)       data.finishUpdate();
    }
  }
  for (  final NameUpdates up : nameUpdates.values())   up.apply(false);
}
