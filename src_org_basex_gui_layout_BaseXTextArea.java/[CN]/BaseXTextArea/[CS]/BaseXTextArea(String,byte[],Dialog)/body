{
  setTabSize(2);
  setLineWrap(true);
  setWrapStyleWord(true);
  setFocusTraversalKeys(0,null);
  setFocusTraversalKeys(1,null);
  BaseXLayout.addDefaultKeys(this,list);
  undo=new Undo();
  if (txt != null) {
    setText(txt);
    selectAll();
  }
  BaseXLayout.addHelp(this,hlp);
  addMouseListener(new MouseAdapter(){
    @Override public void mousePressed(    final MouseEvent e){
      if (SwingUtilities.isRightMouseButton(e))       new BaseXTextPopup(BaseXTextArea.this,e.getPoint());
    }
  }
);
  addKeyListener(new KeyAdapter(){
    @Override public void keyPressed(    final KeyEvent e){
      removeMark();
      final int key=e.getKeyCode();
      if (key == KeyEvent.VK_CONTEXT_MENU) {
        new BaseXTextPopup(BaseXTextArea.this,new Point(10,10));
      }
      if (!e.isControlDown() || hist == null)       return;
      if (key == KeyEvent.VK_UP) {
        restore(hist.prev());
      }
 else       if (key == KeyEvent.VK_DOWN) {
        restore(hist.next());
      }
 else       if (key == KeyEvent.VK_ENTER) {
        store();
      }
 else       if (key == KeyEvent.VK_Z) {
        setText(undo.prev());
        setCaretPosition(undo.cursor());
      }
 else       if (key == KeyEvent.VK_Y) {
        setText(undo.next());
        setCaretPosition(undo.cursor());
      }
    }
    @Override public void keyReleased(    final KeyEvent e){
      final int key=e.getKeyCode();
      if (e.isControlDown() && (key == KeyEvent.VK_Z || key == KeyEvent.VK_Y))       return;
      undo.store(getText(),getCaretPosition());
    }
  }
);
  addFocusListener(new FocusAdapter(){
    @Override public void focusGained(    final FocusEvent e){
      repaint();
    }
    @Override public void focusLost(    final FocusEvent e){
      repaint();
    }
  }
);
}
