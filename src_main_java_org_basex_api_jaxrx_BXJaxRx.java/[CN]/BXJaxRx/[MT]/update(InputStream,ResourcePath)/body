{
  return new BXCode(path){
    @Override String code(){
      try {
        final int d=path.getDepth();
        if (d == 1) {
          session.create(db(path),input);
        }
 else {
          session.execute(new Open(db(path)));
          final StringBuilder target=new StringBuilder();
          for (int i=1; i < d; i++) {
            target.append('/').append(path.getResource(i));
          }
          session.execute(new Delete(target.toString()));
          add(input,path,session);
        }
        return session.info();
      }
 catch (      final IOException ex) {
        throw new JaxRxException(400,ex.getMessage());
      }
    }
  }
.run();
}
