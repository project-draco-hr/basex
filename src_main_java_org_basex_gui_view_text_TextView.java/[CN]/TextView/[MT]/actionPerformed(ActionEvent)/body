{
  final BaseXFileChooser fc=new BaseXFileChooser(SAVE_AS,gui.gprop.get(GUIProp.WORKPATH),gui);
  final IO file=fc.select(Mode.FSAVE);
  if (file == null)   return;
  gui.gprop.set(GUIProp.WORKPATH,file.path());
  PrintOutput out=null;
  gui.cursor(CURSORWAIT,true);
  final Prop prop=gui.context.prop;
  final int mh=prop.num(Prop.MAXHITS);
  prop.set(Prop.MAXHITS,-1);
  prop.set(Prop.CACHEQUERY,false);
  try {
    out=new PrintOutput(file.toString());
    if (cmd != null) {
      cmd.execute(gui.context,out);
    }
 else     if (ns != null) {
      ns.serialize(Serializer.get(out));
    }
 else {
      final byte[] txt=area.getText();
      for (      final byte t : txt)       if (t < 0 || t > ' ' || ws(t))       out.write(t);
    }
  }
 catch (  final IOException ex) {
    BaseXDialog.error(gui,FILE_NOT_SAVED);
  }
 finally {
    if (out != null)     try {
      out.close();
    }
 catch (    final IOException ex) {
    }
    prop.set(Prop.MAXHITS,mh);
    prop.set(Prop.CACHEQUERY,true);
    gui.cursor(CURSORARROW,true);
  }
}
