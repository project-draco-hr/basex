{
  final Var v=current.get(name);
  if (v != null)   return new VarRef(ii,v);
  if (parent != null) {
    final Expr nonLocal=parent.resolve(name,qp,ctx,ii,err);
    if (!(nonLocal instanceof VarRef))     return nonLocal;
    final Var local=new Var(ctx,name,nonLocal.type());
    add(local);
    closure.put(local,nonLocal);
    return new VarRef(ii,local);
  }
  StaticVar global=ctx.vars.get(name);
  if (global == null && err != null)   throw qp.error(err,'$' + string(name.string()));
  return global;
}
