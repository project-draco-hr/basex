{
  final byte[] nm=convert(name);
  final FElem root=new FElem(qname(nm));
  final Class<?> clz=types.get(nm);
  final boolean type=clz == null || clz == JValue.class;
  if (value instanceof JStruct) {
    final boolean obj=value instanceof JObject;
    if (type)     root.add(new FAttr(Q_TYPE,value.type()));
    final JStruct n=(JStruct)value;
    for (int s=0; s < n.size(); s++) {
      root.add(create(obj ? ((JObject)n).name(s) : VALUE,n.value(s)));
    }
  }
 else {
    final JAtom a=(JAtom)value;
    if (type && !(a instanceof JString))     root.add(new FAttr(Q_TYPE,a.type()));
    final byte[] v=a.value();
    if (v != null && v.length != 0)     root.add(new FTxt(v));
  }
  return root;
}
