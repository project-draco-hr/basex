{
  super(args,ctx);
  final MainProp mprop=context.mprop;
  final int port=mprop.num(MainProp.SERVERPORT);
  final int eport=mprop.num(MainProp.EVENTPORT);
  if (port == eport)   throw new BaseXException(SERVERPORTS,port);
  final String host=mprop.get(MainProp.SERVERHOST);
  final InetAddress addr=host.isEmpty() ? null : InetAddress.getByName(host);
  if (service) {
    start(port,args);
    Util.outln(SERVERSTART);
    Performance.sleep(1000);
    return;
  }
  if (stopped) {
    stop(port,eport);
    Util.outln(SERVERSTOPPED);
    Performance.sleep(1000);
    return;
  }
  try {
    for (    final String c : commands)     execute(c);
    log=new Log(context,quiet);
    log.write(SERVERSTART);
    socket=new ServerSocket();
    socket.setReuseAddress(true);
    socket.bind(new InetSocketAddress(addr,port));
    esocket=new ServerSocket();
    esocket.setReuseAddress(true);
    esocket.bind(new InetSocketAddress(addr,eport));
    stop=stopFile(port);
    Runtime.getRuntime().addShutdownHook(new Thread(){
      @Override public void run(){
        log.write(SERVERSTOPPED);
        log.close();
        Util.outln(SERVERSTOPPED);
      }
    }
);
    new Thread(this).start();
    while (!running)     Performance.sleep(100);
    Util.outln(CONSOLE + (console ? CONSOLE2 : SERVERSTART),SERVERMODE);
    if (console) {
      console();
      quit();
    }
  }
 catch (  final IOException ex) {
    if (log != null)     log.write(ex.getMessage());
    throw ex;
  }
}
