{
  error.add(LINE,token(ex.line()));
  error.add(COLUMN,token(ex.column()));
  final String url=IO.get(ex.file()).url();
  if (!file.url().equals(url))   error.add(URI,url);
  if (ex instanceof UnitException) {
    final UnitException ue=(UnitException)ex;
    error.add(elem(ue.returned,RETURNED,ue.count));
    error.add(elem(ue.expected,EXPECTED,ue.count));
  }
 else   if (fail) {
    final Value v=ex.value();
    if (v.isItem()) {
      if (v.type.isNode()) {
        error.add((ANode)v);
      }
 else {
        error.add(((Item)v).string(null));
      }
    }
 else {
      error.add(ex.getLocalizedMessage());
    }
  }
 else {
    error.add(TYPE,ex.qname().prefixId(QueryText.ERRORURI));
    error.add(ex.getLocalizedMessage());
  }
}
