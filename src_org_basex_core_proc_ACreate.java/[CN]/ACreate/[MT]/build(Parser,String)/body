{
  new Close().execute(context);
  final boolean mem=prop.is(Prop.MAINMEM);
  if (!mem) {
    if (context.pinned(db))     return error(DBINUSE);
    if (p.prop.dbpath(db + ".tmp").exists())     return error(DBTMP,db);
  }
  final Builder builder=mem ? new MemBuilder(p) : prop.is(Prop.NATIVEDATA) ? new NativeBuilder(p) : new DiskBuilder(p);
  progress(builder);
  String err=null;
  try {
    final Data data=builder.build(db);
    if (mem) {
      context.openDB(data);
    }
 else {
      index(data);
      data.close();
      if (!move(db,p.prop))       throw new Exception();
      final Process pr=new Open(db);
      if (!pr.execute(context))       throw new IOException(pr.info());
    }
    return info(DBCREATED,db,perf);
  }
 catch (  final FileNotFoundException ex) {
    Main.debug(ex);
    err=Main.info(FILEWHICH,p.io);
  }
catch (  final ProgressException ex) {
    err=PROGERR;
  }
catch (  final IOException ex) {
    Main.debug(ex);
    final String msg=ex.getMessage();
    err=Main.info(msg != null ? msg : args[0]);
  }
catch (  final Exception ex) {
    Main.debug(ex);
    err=Main.info(CREATEERR,args[0]);
  }
  try {
    builder.close();
  }
 catch (  final IOException ex) {
    Main.debug(ex);
  }
  if (!mem)   DropDB.drop(db + ".tmp",prop);
  return error(err);
}
