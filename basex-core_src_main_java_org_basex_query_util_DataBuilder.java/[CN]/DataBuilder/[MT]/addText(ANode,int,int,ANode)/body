{
  int dist=pre - par;
  final ArrayList<DataFTMarker> marks=ftbuilder != null ? ftbuilder.build(node) : null;
  if (marks == null)   return pre + addText(node.string(),dist);
  ANode p=pNode;
  while (p != null) {
    final QNm n=p.qname();
    if (n != null && !n.hasPrefix())     break;
    p=p.parent();
  }
  final int u=p == null ? 0 : data.nspaces.uriId(p.name(),true);
  int ts=marks.size();
  for (  final DataFTMarker marker : marks) {
    if (marker.mark) {
      data.elem(dist++,name,1,2,u,false);
      data.insert(data.meta.size);
      ts++;
    }
    addText(marker.token,marker.mark ? 1 : dist);
    dist++;
  }
  return pre + ts;
}
