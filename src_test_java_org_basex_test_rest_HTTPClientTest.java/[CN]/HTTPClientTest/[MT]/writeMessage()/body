{
  final Request req1=new Request();
  final FakeHttpConnection fakeConn1=new FakeHttpConnection(new URL("http://www.test.com"));
  req1.payloadAttrs.add(MEDIATYPE,token("text/xml"));
  final FElem e1=new FElem(new QNm(token("a")));
  e1.add(new FTxt(token("a")));
  req1.bodyContent.add(e1);
  req1.bodyContent.add(Str.get("<b>b</b>"));
  HTTPClient hc=new HTTPClient(null,CONTEXT.prop);
  hc.setRequestContent(fakeConn1.getOutputStream(),req1);
  assertEquals("<a>a</a> &lt;b&gt;b&lt;/b&gt;",fakeConn1.out.toString());
  final Request req2=new Request();
  final FakeHttpConnection fakeConn2=new FakeHttpConnection(new URL("http://www.test.com"));
  req2.payloadAttrs.add(MEDIATYPE,token("text/plain"));
  final FElem e2=new FElem(new QNm(token("a")));
  e2.add(new FTxt(token("a")));
  req2.bodyContent.add(e2);
  req2.bodyContent.add(Str.get("<b>b</b>"));
  hc=new HTTPClient(null,CONTEXT.prop);
  hc.setRequestContent(fakeConn2.getOutputStream(),req2);
  assertEquals("a&lt;b&gt;b&lt;/b&gt;",fakeConn2.out.toString());
  final Request req3=new Request();
  final FakeHttpConnection fakeConn3=new FakeHttpConnection(new URL("http://www.test.com"));
  req3.payloadAttrs.add(MEDIATYPE,token("text/xml"));
  req3.payloadAttrs.add(token("method"),token("text"));
  final FElem e3=new FElem(new QNm(token("a")));
  e3.add(new FTxt(token("a")));
  req3.bodyContent.add(e3);
  req3.bodyContent.add(Str.get("<b>b</b>"));
  hc=new HTTPClient(null,CONTEXT.prop);
  hc.setRequestContent(fakeConn3.getOutputStream(),req3);
  assertEquals("a&lt;b&gt;b&lt;/b&gt;",fakeConn3.out.toString());
}
