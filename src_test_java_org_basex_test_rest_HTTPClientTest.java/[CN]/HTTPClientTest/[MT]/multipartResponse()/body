{
  final FakeHttpConnection conn=new FakeHttpConnection(new URL("http://www.test.com"));
  final Map<String,List<String>> hdrs=new HashMap<String,List<String>>();
  final List<String> fromVal=new ArrayList<String>();
  fromVal.add("Nathaniel Borenstein <nsb@bellcore.com>");
  hdrs.put("From",fromVal);
  final List<String> mimeVal=new ArrayList<String>();
  mimeVal.add("1.0");
  hdrs.put("MIME-version",mimeVal);
  final List<String> subjVal=new ArrayList<String>();
  subjVal.add("Formatted text mail");
  hdrs.put("Subject",subjVal);
  final List<String> contTypeVal=new ArrayList<String>();
  contTypeVal.add("multipart/alternative");
  contTypeVal.add("boundary=\"boundary42\"");
  hdrs.put("Content-Type",contTypeVal);
  conn.headers=hdrs;
  conn.contentType="multipart/alternative; boundary=\"boundary42\"";
  conn.content=token("--boundary42" + CRLF + "Content-Type: text/plain; charset=us-ascii"+ CRLF+ CRLF+ "...plain text version of message goes here...."+ CRLF+ CRLF+ "--boundary42"+ CRLF+ "Content-Type: text/richtext"+ CRLF+ CRLF+ ".... richtext version of same message goes here ..."+ CRLF+ "--boundary42"+ CRLF+ "Content-Type: text/x-whatever"+ CRLF+ CRLF+ ".... fanciest formatted version of same  "+ "message  goes  here"+ CRLF+ "..."+ CRLF+ "--boundary42--");
  final Iter i=new ResponseHandler(null,CONTEXT.prop).getResponse(conn,Bln.FALSE.string(),null);
  final ItemCache resultIter=new ItemCache();
  final byte[] reqItem=token("<http:response " + "xmlns:http=\"http://expath.org/ns/http-client\" " + "status=\"200\" message=\"OK\">"+ "<http:header name=\"Subject\" value=\"Formatted text mail\"/>"+ "<http:header name=\"Content-Type\" "+ "value=\"multipart/alternative;boundary=&quot;boundary42&quot;\"/>"+ "<http:header name=\"MIME-version\" value=\"1.0\"/>"+ "<http:header name=\"From\" value=\"Nathaniel Borenstein "+ "&lt;nsb@bellcore.com&gt;\"/>"+ "<http:multipart media-type=\"multipart/alternative\" "+ "boundary=\"boundary42\">"+ "<part>"+ "<http:header name=\"Content-Type\" "+ "value=\"text/plain; charset=us-ascii\"/>"+ "<http:body media-type=\"text/plain; charset=us-ascii\"/>"+ "</part>"+ "<part>"+ "<http:header name=\"Content-Type\" value=\"text/richtext\"/>"+ "<http:body media-type=\"text/richtext\"/>"+ "</part>"+ "<part>"+ "<http:header name=\"Content-Type\" value=\"text/x-whatever\"/>"+ "<http:body media-type=\"text/x-whatever\"/>"+ "</part>"+ "</http:multipart>"+ "</http:response> ");
  final IO io=new IOContent(reqItem);
  final Parser reqParser=Parser.xmlParser(io,CONTEXT.prop);
  final DBNode dbNode=new DBNode(reqParser,CONTEXT.prop);
  resultIter.add(dbNode.children().next());
  resultIter.add(Str.get("...plain text version of message " + "goes here....\n\n"));
  resultIter.add(Str.get(".... richtext version of same message " + "goes here ...\n"));
  resultIter.add(Str.get(".... fanciest formatted version of same  " + "message  goes  here\n...\n"));
  assertTrue(Compare.deep(resultIter,i,null));
}
