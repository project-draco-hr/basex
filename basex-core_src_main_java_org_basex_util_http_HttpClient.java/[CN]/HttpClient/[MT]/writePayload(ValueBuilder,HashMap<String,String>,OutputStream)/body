{
  String method=payloadAtts.get(SerializerOptions.METHOD.name());
  if (method == null) {
    final String type=payloadAtts.get(SerializerOptions.MEDIA_TYPE.name());
    if (Strings.eq(type,APP_HTML_XML)) {
      method=SerialMethod.XHTML.toString();
    }
 else     if (Strings.eq(type,TEXT_HTML)) {
      method=SerialMethod.HTML.toString();
    }
 else     if (isXML(type)) {
      method=SerialMethod.XML.toString();
    }
 else     if (isText(type)) {
      method=SerialMethod.TEXT.toString();
    }
 else {
      method=SerialMethod.XML.toString();
    }
  }
  final String src=payloadAtts.get(SRC);
  if (src == null) {
    write(payload,payloadAtts,method,out);
  }
 else {
    final IOUrl io=new IOUrl(src);
    if (Strings.eq(method,BINARY)) {
      out.write(io.read());
    }
 else {
      final ValueBuilder vb=new ValueBuilder().add(Str.get(new TextInput(io).content()));
      write(vb,payloadAtts,method,out);
    }
  }
}
