{
  if (type instanceof AtomType) {
    for (    final Item atom : item.atomValue(ii)) {
      final Type tp=atom.type;
      if (tp.instanceOf(type)) {
        vb.add(atom);
      }
 else       if (tp == AtomType.ATM) {
        if (type.nsSensitive()) {
          if (sc.xquery3())           throw NSSENS_X_X.get(ii,item.type,type);
          throw Err.treatError(ii,item,withOcc(Occ.ONE));
        }
        vb.add(type.cast(atom,qc,sc,ii));
      }
 else       if (type == AtomType.DBL && (tp == AtomType.FLT || tp.instanceOf(AtomType.DEC))) {
        vb.add(Dbl.get(atom.dbl(ii)));
      }
 else       if (type == AtomType.FLT && tp.instanceOf(AtomType.DEC)) {
        vb.add(Flt.get(atom.flt(ii)));
      }
 else       if (type == AtomType.STR && atom instanceof Uri) {
        vb.add(Str.get(atom.string(ii)));
      }
 else {
        throw Err.treatError(ii,item,withOcc(Occ.ONE));
      }
    }
  }
 else   if (item instanceof FItem && type instanceof FuncType) {
    vb.add(((FItem)item).coerceTo((FuncType)type,qc,ii,opt));
  }
 else {
    throw Err.treatError(ii,item,withOcc(Occ.ONE));
  }
}
