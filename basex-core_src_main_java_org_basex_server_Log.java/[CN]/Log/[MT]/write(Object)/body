{
  if (!gopts.get(GlobalOptions.LOG)) {
    close();
    return;
  }
  final Date date=new Date();
  try {
    final String nstart=DateTime.format(date,DateTime.DATE);
    if (fos != null && !start.equals(nstart))     close();
    if (fos == null) {
      final IOFile dir=dir();
      dir.md();
      fos=new FileOutputStream(new IOFile(dir,nstart + IO.LOGSUFFIX).file(),true);
      start=nstart;
    }
    final int ml=gopts.get(GlobalOptions.LOGMSGMAXLEN);
    final TokenBuilder tb=new TokenBuilder(DateTime.format(date,DateTime.TIME));
    for (    final Object s : str) {
      tb.add('\t');
      final String st;
      if (s == null)       st=REQUEST;
 else       if (s instanceof Boolean)       st=(Boolean)s ? OK : ERROR;
 else       if (s instanceof Throwable)       st=Util.message((Throwable)s);
 else       st=s.toString();
      tb.add(chop(token(st.replaceAll("\\s+"," ").trim()),ml));
    }
    tb.add(Prop.NL);
    fos.write(tb.finish());
    fos.flush();
  }
 catch (  final IOException ex) {
    Util.stack(ex);
  }
}
