{
  final XQuery query=new XQuery("\n" + "<result>{\n" + "  for sliding window $w in ./sequence/*\n"+ "    start previous $wSPrev when $wSPrev[self::OrderRequest]\n"+ "    end next $wENext when $wENext/@orderID eq  $wSPrev/@orderID\n"+ "        and ($wENext[self::ConfirmationRequest] and $wENext/@status eq \"reject\"\n"+ "                 or $wENext[self::ShipNotice])\n"+ "  where $wENext[self::ShipNotice]\n"+ "  return\n"+ "    <bundleWith orderId=\"{$wSPrev/@orderID}\">{\n"+ "        for sliding window $bundle in $w\n"+ "          start  $bSCur\n"+ "            when $bSCur[self::OrderRequest] and $bSCur/@shipTo eq $wSPrev/@shipTo\n"+ "          end  $bECur next $bENext\n"+ "            when $bECur/@orderID eq  $bSCur/@orderID\n"+ "             and ($bECur[self::ConfirmationRequest] and $bECur/@status eq \"reject\"\n"+ "              or $bECur[self::ShipNotice])\n"+ "          where empty($bENext)\n"+ "          return $bSCur\n"+ "    }</bundleWith>\n"+ "}</result>\n"+ "      ",ctx);
  try {
    query.context(node(file("prod/WindowClause/cxml.xml")));
    result=new QT3Result(query.value());
  }
 catch (  final Throwable trw) {
    result=new QT3Result(trw);
  }
 finally {
    query.close();
  }
  test(assertSerialization("<result><bundleWith orderId=\"OID01\"><OrderRequest billTo=\"ACME1\" date=\"2006-01-02T14:00:00-00:00\" orderID=\"OID03\" shipTo=\"ACME1\" total=\"10000\" type=\"new\">\n    <Item partID=\"ID3\" quantity=\"100\" unitPrice=\"100\"/>\n  </OrderRequest></bundleWith><bundleWith orderId=\"OID03\"/></result>",false));
}
