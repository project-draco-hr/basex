{
  final XQuery query=new XQuery("\n" + "          let $s := <stocks>\n" + "            <closing> <symbol>ABC</symbol> <date>2008-01-01</date> <price>105</price> </closing>\n"+ "            <closing> <symbol>DEF</symbol> <date>2008-01-01</date> <price>057</price> </closing>\n"+ "            <closing> <symbol>ABC</symbol> <date>2008-01-02</date> <price>101</price> </closing>\n"+ "            <closing> <symbol>DEF</symbol> <date>2008-01-02</date> <price>054</price> </closing>\n"+ "            <closing> <symbol>ABC</symbol> <date>2008-01-03</date> <price>102</price> </closing>\n"+ "            <closing> <symbol>DEF</symbol> <date>2008-01-03</date> <price>056</price> </closing>\n"+ "            <closing> <symbol>ABC</symbol> <date>2008-01-04</date> <price>103</price> </closing>\n"+ "            <closing> <symbol>DEF</symbol> <date>2008-01-04</date> <price>052</price> </closing>\n"+ "            <closing> <symbol>ABC</symbol> <date>2008-01-05</date> <price>101</price> </closing>\n"+ "            <closing> <symbol>DEF</symbol> <date>2008-01-05</date> <price>055</price> </closing>\n"+ "            <closing> <symbol>ABC</symbol> <date>2008-01-06</date> <price>104</price> </closing>\n"+ "            <closing> <symbol>DEF</symbol> <date>2008-01-06</date> <price>059</price> </closing>\n"+ "          </stocks>\n"+ "          for $closings in $s//closing\n"+ "          let $symbol := $closings/symbol\n"+ "          group by $symbol\n"+ "          for tumbling window $w in $closings\n"+ "             start $first next $second when $first/price < $second/price\n"+ "             end $last next $beyond when $last/price > $beyond/price\n"+ "          return\n"+ "             <run-up symbol=\"{$symbol}\">\n"+ "                <start-date>{fn:data($first/date)}</start-date>\n"+ "                <start-price>{fn:data($first/price)}</start-price>\n"+ "                <end-date>{fn:data($last/date)}</end-date>\n"+ "                <end-price>{fn:data($last/price)}</end-price>\n"+ "             </run-up>\n"+ "        ",ctx);
  try {
    result=new QT3Result(query.value());
  }
 catch (  final Throwable trw) {
    result=new QT3Result(trw);
  }
 finally {
    query.close();
  }
  test((assertSerialization("<run-up symbol=\"ABC\"><start-date>2008-01-02</start-date><start-price>101</start-price><end-date>2008-01-04</end-date><end-price>103</end-price></run-up><run-up symbol=\"ABC\"><start-date>2008-01-05</start-date><start-price>101</start-price><end-date>2008-01-06</end-date><end-price>104</end-price></run-up><run-up symbol=\"DEF\"><start-date>2008-01-02</start-date><start-price>054</start-price><end-date>2008-01-03</end-date><end-price>056</end-price></run-up><run-up symbol=\"DEF\"><start-date>2008-01-04</start-date><start-price>052</start-price><end-date>2008-01-06</end-date><end-price>059</end-price></run-up>",false) || assertSerialization("<run-up symbol=\"DEF\"><start-date>2008-01-02</start-date><start-price>054</start-price><end-date>2008-01-03</end-date><end-price>056</end-price></run-up><run-up symbol=\"DEF\"><start-date>2008-01-04</start-date><start-price>052</start-price><end-date>2008-01-06</end-date><end-price>059</end-price></run-up><run-up symbol=\"ABC\"><start-date>2008-01-02</start-date><start-price>101</start-price><end-date>2008-01-04</end-date><end-price>103</end-price></run-up><run-up symbol=\"ABC\"><start-date>2008-01-05</start-date><start-price>101</start-price><end-date>2008-01-06</end-date><end-price>104</end-price></run-up>",false)));
}
