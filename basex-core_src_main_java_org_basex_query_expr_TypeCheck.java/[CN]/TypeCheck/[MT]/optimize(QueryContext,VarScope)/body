{
  final SeqType argType=expr.seqType();
  if (argType.instanceOf(seqType)) {
    qc.compInfo(QueryText.OPTCAST,seqType);
    return expr;
  }
  if (expr.isValue()) {
    if (expr instanceof FuncItem && seqType.type instanceof FuncType) {
      if (!seqType.occ.check(1))       throw INVTREAT.get(info,expr.seqType(),seqType);
      final FuncItem fit=(FuncItem)expr;
      return optPre(fit.coerceTo((FuncType)seqType.type,qc,info,true),qc);
    }
    return optPre(value(qc),qc);
  }
  if (argType.type.instanceOf(seqType.type) && !expr.has(Flag.NDT) && !expr.has(Flag.UPD)) {
    final SeqType.Occ occ=argType.occ.intersect(seqType.occ);
    if (occ == null)     throw INVCAST.get(info,argType,seqType);
  }
  final Expr opt=expr.typeCheck(this,qc,scp);
  if (opt != null)   return optPre(opt,qc);
  return this;
}
