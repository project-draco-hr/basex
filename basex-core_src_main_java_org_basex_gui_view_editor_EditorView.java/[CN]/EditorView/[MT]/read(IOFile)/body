{
  final TokenBuilder text=new TokenBuilder((int)Math.min(1 << 28,file.length()));
  final TextInput ti=new NewlineInput(file).validate(true);
  boolean first=true;
  try {
    while (true) {
      try {
        final int cp=ti.read();
        if (cp == -1)         return text.finish();
        text.add(cp);
      }
 catch (      final InputException ex) {
        if (first) {
          first=false;
          if (BaseXDialog.confirm(gui,H_FILE_BINARY)) {
            try {
              file.open();
            }
 catch (            final IOException ioex) {
              Desktop.getDesktop().open(file.file());
            }
            return null;
          }
        }
      }
    }
  }
  finally {
    ti.close();
  }
}
