{
  if (!refresh && stop.isEnabled())   return;
  ++threadID;
  getEditor().resetError();
  if (refresh) {
    stop.setEnabled(false);
    refreshMark();
  }
  if (stopped || th == null) {
    info.setCursor(CURSORARROW);
    info.setText(stopped ? INTERRUPTED : OK,Msg.SUCCESS);
    info.setToolTipText(null);
    errorInfo=null;
  }
 else {
    info.setCursor(CURSORHAND);
    info.setText(th.getLocalizedMessage(),Msg.ERROR);
    final String tt=th.getMessage().replace("<","&lt;").replace(">","&gt;").replaceAll("\r?\n","<br/>").replaceAll("(<br/>.*?)<br/>.*","$1");
    info.setToolTipText("<html>" + tt + "</html>");
    if (th instanceof QueryException) {
      errorInfo=((QueryException)th).info();
    }
 else     if (th instanceof SAXParseException) {
      final SAXParseException ex=(SAXParseException)th;
      final String path=getEditor().file.path();
      errorInfo=new InputInfo(path,ex.getLineNumber(),ex.getColumnNumber());
    }
 else {
      errorInfo=new InputInfo(getEditor().file.path(),1,1);
    }
    error(false);
  }
}
