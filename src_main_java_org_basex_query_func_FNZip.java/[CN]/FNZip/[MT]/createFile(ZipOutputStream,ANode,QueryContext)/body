{
  final AxisIter ai=elm.children();
  ANode node;
  while ((node=ai.next()) != null) {
    final QNm mode=node.qname();
    if (!mode.eq(E_DIR) && !mode.eq(E_ENTRY))     ZIPUNKNOWN.thrw(input,mode);
    String path=attribute(node,A_NAME,false);
    String src=attribute(node,A_SRC,false);
    if (src != null)     src=src.replaceAll("\\\\","/");
    if (path == null) {
      if (src == null)       throw ZIPINVALID.thrw(input,node.qname(),A_SRC);
      path=src.replaceAll(".*/","");
    }
    final boolean dir=mode.eq(E_DIR);
    if (dir && !path.endsWith("/"))     path+="/";
    final ZipEntry ze=new ZipEntry(path);
    zos.putNextEntry(ze);
    if (dir)     continue;
    if (src != null) {
      final IO source=IO.get(src);
      if (!source.exists())       ZIPNOTFOUND.thrw(input,source);
      zos.write(source.content());
    }
 else {
      try {
        final XMLSerializer xml=new XMLSerializer(zos,serialPar(node,ctx));
        ANode n;
        final AxisIter ch=node.children();
        while ((n=ch.next()) != null)         n.serialize(xml);
        xml.close();
      }
 catch (      final SerializerException ex) {
        throw new QueryException(input,ex);
      }
    }
    zos.closeEntry();
  }
}
