{
  int s=0;
  for (int p=ps - 1; p >= 0; p--) {
    final byte b=text[p];
    if (b == '\n')     break;
    if (b == '\t') {
      s+=TAB;
    }
 else     if (b == ' ') {
      s++;
    }
 else {
      s=0;
    }
  }
  if (ps > 0 && OPENING.indexOf(text[ps - 1]) != -1)   s+=TAB;
  if (ps < text.length && CLOSING.indexOf(text[ps]) != -1)   s-=TAB;
  for (int p=0; p < s; p++)   sb.append(' ');
}
