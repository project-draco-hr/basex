{
  layout(new BorderLayout(2,0));
  mode(Fill.NONE);
  setVisible(false);
  gui=main;
  search=new BaseXTextField(main);
  search.history(gui,GUIProp.SEARCHED);
  search.setToolTipText(SEARCH);
  search.setPreferredSize(null);
  replace=new BaseXTextField(main);
  replace.history(gui,GUIProp.REPLACED);
  replace.setToolTipText(REPLACE_WITH);
  replace.setPreferredSize(null);
  regex=onOffButton("s_regex",REGULAR_EXPR,GUIProp.SR_REGEX);
  mcase=onOffButton("s_case",MATCH_CASE,GUIProp.SR_CASE);
  multi=onOffButton("s_multi",MULTI_LINE,GUIProp.SR_MULTI);
  rplc=new BaseXButton(main,"s_replace",REPLACE_ALL);
  cls=new BaseXButton(main,"s_close",CLOSE);
  multi.setEnabled(regex.isEnabled());
  search.addFocusListener(new FocusAdapter(){
    @Override public void focusGained(    final FocusEvent e){
      search.selectAll();
    }
  }
);
  search.addKeyListener(new KeyAdapter(){
    @Override public void keyPressed(    final KeyEvent e){
      if (FINDPREV.is(e) || FINDPREV2.is(e) || FINDNEXT.is(e)|| FINDNEXT2.is(e)) {
        editor.text.noSelect();
        deactivate(false);
      }
 else       if (ESCAPE.is(e)) {
        deactivate(search.getText().isEmpty());
      }
 else       if (ENTER.is(e)) {
        editor.jump(e.isShiftDown() ? SearchDir.BACKWARD : SearchDir.FORWARD,true);
      }
    }
    @Override public void keyReleased(    final KeyEvent e){
      main.gprop.set(GUIProp.SR_SEARCH,search.getText());
      search();
    }
  }
);
  BaseXLayout.addDrop(search,new DropHandler(){
    @Override public void drop(    final Object object){
      search.setText(object.toString());
      search();
    }
  }
);
  replace.addKeyListener(new KeyAdapter(){
    @Override public void keyPressed(    final KeyEvent e){
      if (ESCAPE.is(e))       deactivate(true);
    }
    @Override public void keyReleased(    final KeyEvent e){
      main.gprop.set(GUIProp.SR_REPLACE,replace.getText());
    }
  }
);
  cls.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      deactivate(true);
    }
  }
);
  rplc.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      search.store();
      replace.store();
      editor.replace(new ReplaceContext(replace.getText()));
    }
  }
);
}
