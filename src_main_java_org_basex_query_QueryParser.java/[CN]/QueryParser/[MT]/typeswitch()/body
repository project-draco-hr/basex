{
  if (!wdConsumeWs(TYPESWITCH,PAR1,TYPEPAR))   return null;
  wsCheck(PAR1);
  final Expr ts=check(expr(),NOTYPESWITCH);
  wsCheck(PAR2);
  TypeCase[] cases={};
  final int s=ctx.vars.size();
  boolean cs=true;
  do {
    cs=wsConsumeWs(CASE);
    if (!cs)     wsCheck(DEFAULT);
    skipWS();
    QNm name=null;
    if (curr('$')) {
      name=varName();
      if (cs)       wsCheck(AS);
    }
    final Var var=new Var(input(),name,cs ? sequenceType() : null);
    if (name != null)     ctx.vars.add(var);
    wsCheck(RETURN);
    final Expr ret=check(single(),NOTYPESWITCH);
    cases=Array.add(cases,new TypeCase(input(),var,ret));
    ctx.vars.reset(s);
  }
 while (cs);
  if (cases.length == 1)   error(NOTYPESWITCH);
  return new TypeSwitch(input(),ts,cases);
}
