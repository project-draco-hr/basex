{
  FTExpr expr=ftOr(prg);
  FTExpr old;
  FTExpr first=null;
  boolean ordered=false;
  do {
    old=expr;
    if (wsConsumeWs(ORDERED)) {
      ordered=true;
      old=null;
    }
 else     if (wsConsumeWs(WINDOW)) {
      expr=new FTWindow(input(),expr,additive(),ftUnit());
    }
 else     if (wsConsumeWs(DISTANCE)) {
      final Expr[] rng=ftRange();
      if (rng == null)       error(FTRANGE);
      expr=new FTDistance(input(),expr,rng,ftUnit());
    }
 else     if (wsConsumeWs(AT)) {
      final boolean start=wsConsumeWs(START);
      final boolean end=!start && wsConsumeWs(END);
      if (!start && !end)       error(INCOMPLETE);
      expr=new FTContent(input(),expr,start,end);
    }
 else     if (wsConsumeWs(ENTIRE)) {
      wsCheck(CONTENT);
      expr=new FTContent(input(),expr,false,false);
    }
 else {
      final boolean same=wsConsumeWs(SAME);
      final boolean diff=!same && wsConsumeWs(DIFFERENT);
      if (same || diff) {
        FTUnit unit=null;
        if (wsConsumeWs(SENTENCE))         unit=FTUnit.SENTENCE;
 else         if (wsConsumeWs(PARAGRAPH))         unit=FTUnit.PARAGRAPH;
 else         error(INCOMPLETE);
        expr=new FTScope(input(),expr,unit,same);
      }
    }
    if (first == null && old != null && old != expr)     first=expr;
  }
 while (old != expr);
  if (ordered) {
    if (first == null)     return new FTOrder(input(),expr);
    first.expr[0]=new FTOrder(input(),first.expr[0]);
  }
  return expr;
}
