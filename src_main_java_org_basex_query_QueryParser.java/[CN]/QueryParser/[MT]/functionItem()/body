{
  skipWS();
  final int pos=qp;
  while (curr('%'))   annotation();
  if (wsConsume(FUNCTION) && wsConsume(PAR1)) {
    final int s=ctx.vars.size();
    final Var[] args=paramList();
    wsCheck(PAR2);
    final SeqType type=optAsType();
    final Expr body=enclosed(NOFUNBODY);
    ctx.vars.size(s);
    return new InlineFunc(input(),type,args,body);
  }
  qp=pos;
  final QNm name=eQName(null,ctx.nsFunc);
  if (name != null && consume('#')) {
    final long card=((Int)numericLiteral(true)).itr(null);
    if (card < 0 || card > Integer.MAX_VALUE)     error(FUNCUNKNOWN,name);
    final Expr[] args=new Expr[(int)card];
    final Var[] vars=new Var[args.length];
    partial(args,vars);
    final TypedFunc f=ctx.funcs.get(name,args,ctx,this);
    if (f == null)     error(FUNCUNKNOWN,name);
    return new LitFunc(input(),name,f,vars);
  }
  qp=pos;
  return null;
}
