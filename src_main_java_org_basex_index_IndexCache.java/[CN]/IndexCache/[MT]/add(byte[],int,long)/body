{
  final int hash=hash(key);
  rwl.writeLock().lock();
  try {
    purge();
    final int i=indexFor(hash,buckets.length);
    BucketEntry current=buckets[i];
    BucketEntry prev=current;
    while (current != null) {
      final BucketEntry next=current.next;
      final IndexEntry entry=current.get();
      if (entry == null) {
        delete(i,current,prev,next);
      }
 else       if (current.hash == hash && eq(entry.key,key)) {
        update(entry,s,p);
        return entry;
      }
      prev=current;
      current=next;
    }
    final IndexEntry entry=new IndexEntry(key,s,p);
    add(i,hash,entry);
    return entry;
  }
  finally {
    rwl.writeLock().unlock();
  }
}
