{
  while (true) {
    final int ch=input.next();
    if (ch < 0)     error(XMLCHAR,-ch);
    if (ch > 0 && ch < ' ' && !ws(ch))     error(XMLCHAR,ch);
    if (ch == '%' && pe) {
      final byte[] key=name(true);
      final byte[] val=pents.get(key);
      if (val == null)       error(UNKNOWNPE,key);
      check(';');
      input.add(val,true);
    }
 else     if (ch != 0x0D) {
      return ch;
    }
  }
}
