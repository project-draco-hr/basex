{
  final RuleBasedCollator rbc=rbc(info);
  final CollationElementIterator i=rbc.getCollationElementIterator(string);
  final CollationElementIterator is=rbc.getCollationElementIterator(sub);
  do {
    final int cs=next(is);
    if (cs == -1)     return 0;
    int c;
    do {
      c=next(i);
      if (c == -1)       return -1;
    }
 while (c != cs);
    final int s=i.getOffset();
    if (startsWith(i,is)) {
      if (mode == Mode.INDEX_AFTER) {
        return i.getOffset();
      }
 else       if (mode == Mode.ENDS_WITH) {
        if (next(i) == -1)         return s - 1;
      }
 else {
        return s - 1;
      }
    }
    i.setOffset(s);
    is.reset();
  }
 while (mode != Mode.STARTS_WITH);
  return -1;
}
