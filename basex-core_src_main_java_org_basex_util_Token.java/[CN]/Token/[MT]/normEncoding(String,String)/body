{
  if (encoding == null)   return old != null ? old : UTF8;
  final String e=encoding.toUpperCase(Locale.ENGLISH);
  if (eq(e,ALL_UTF8))   return UTF8;
  if (e.equals(UTF16LE))   return UTF16LE;
  if (e.equals(UTF16BE))   return UTF16BE;
  if (eq(e,ALL_UTF16))   return old == UTF16LE || old == UTF16BE ? old : UTF16LE;
  if (eq(e,ALL_UTF32))   return UTF32;
  return encoding;
}
