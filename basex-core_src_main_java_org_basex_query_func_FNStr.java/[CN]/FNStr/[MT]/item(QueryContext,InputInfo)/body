{
  final Expr e=expr[0];
switch (sig) {
case CODEPOINTS_TO_STRING:
    return cp2str(ctx.iter(e));
case COMPARE:
  Collation coll=checkColl(expr.length == 3 ? expr[2] : null,ctx,sc);
Item it1=e.item(ctx,info);
Item it2=expr[1].item(ctx,info);
if (it1 == null || it2 == null) return null;
return Int.get(Math.max(-1,Math.min(1,coll == null ? diff(checkEStr(it1),checkEStr(it2)) : coll.compare(checkStr(it1),checkStr(it2)))));
case CODEPOINT_EQUAL:
it1=e.item(ctx,info);
it2=expr[1].item(ctx,info);
if (it1 == null || it2 == null) return null;
return Bln.get(eq(checkEStr(it1),checkEStr(it2)));
case STRING_JOIN:
return strjoin(ctx);
case SUBSTRING:
return substr(ctx);
case NORMALIZE_UNICODE:
return normuni(ctx);
case UPPER_CASE:
return Str.get(uc(checkEStr(e,ctx)));
case LOWER_CASE:
return Str.get(lc(checkEStr(e,ctx)));
case TRANSLATE:
return trans(ctx);
case ENCODE_FOR_URI:
return Str.get(uri(checkEStr(e,ctx),false));
case IRI_TO_URI:
return Str.get(uri(checkEStr(e,ctx),true));
case ESCAPE_HTML_URI:
return Str.get(escape(checkEStr(e,ctx)));
case CONCAT:
return concat(ctx);
case CONTAINS:
coll=checkColl(expr.length == 3 ? expr[2] : null,ctx,sc);
byte[] ss=checkEStr(e,ctx);
byte[] sb=checkEStr(expr[1],ctx);
return Bln.get(coll == null ? contains(ss,sb) : coll.contains(ss,sb,info));
case STARTS_WITH:
coll=checkColl(expr.length == 3 ? expr[2] : null,ctx,sc);
ss=checkEStr(e,ctx);
sb=checkEStr(expr[1],ctx);
return Bln.get(coll == null ? startsWith(ss,sb) : coll.startsWith(ss,sb,info));
case ENDS_WITH:
coll=checkColl(expr.length == 3 ? expr[2] : null,ctx,sc);
ss=checkEStr(e,ctx);
sb=checkEStr(expr[1],ctx);
return Bln.get(coll == null ? endsWith(ss,sb) : coll.endsWith(ss,sb,info));
case SUBSTRING_AFTER:
coll=checkColl(expr.length == 3 ? expr[2] : null,ctx,sc);
ss=checkEStr(e,ctx);
sb=checkEStr(expr[1],ctx);
if (coll == null) {
final int p=indexOf(ss,sb);
return p != -1 ? Str.get(substring(ss,p + sb.length)) : Str.ZERO;
}
return Str.get(coll.after(ss,sb,info));
case SUBSTRING_BEFORE:
coll=checkColl(expr.length == 3 ? expr[2] : null,ctx,sc);
ss=checkEStr(e,ctx);
sb=checkEStr(expr[1],ctx);
if (coll == null) {
final int p=indexOf(ss,sb);
return p != -1 ? Str.get(substring(ss,0,p)) : Str.ZERO;
}
return Str.get(coll.before(ss,sb,info));
default :
return super.item(ctx,ii);
}
}
