{
  final Data data=ctx.data();
  if (data == null && openDB)   throw new BaseXException(NO_DB_OPENED);
  if (!ctx.perm(perm,data != null && !data.inMemory() ? data.meta.name : null))   throw new BaseXException(PERM_REQUIRED_X,perm);
  updating=updating(ctx);
  try {
    register(ctx);
    if (!run(ctx,os)) {
      final BaseXException ex=new BaseXException(info());
      ex.initCause(exception);
      throw ex;
    }
  }
 catch (  final RuntimeException th) {
    Util.stack(th);
    throw th;
  }
 finally {
    unregister(ctx);
  }
}
