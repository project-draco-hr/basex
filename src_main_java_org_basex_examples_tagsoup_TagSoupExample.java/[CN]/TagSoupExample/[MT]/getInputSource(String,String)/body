{
  InputSource is;
  if (encoding != null) {
    is=new InputSource(addr);
    is.setEncoding(encoding);
  }
 else {
    URL url=new URL(addr);
    HttpURLConnection conn=(HttpURLConnection)url.openConnection();
    is=new InputSource(conn.getInputStream());
    String enc=conn.getContentType();
    if (enc != null) {
      String[] parts=enc.split(";\\s*charset\\s*=");
      if (parts.length > 1) {
        enc=parts[1].trim();
        if (!enc.equals(""))         is.setEncoding(enc);
      }
    }
  }
  return is;
}
