{
  out=o instanceof PrintOutput ? (PrintOutput)o : new PrintOutput(o);
  boolean omit=true;
  String sa=SerializeProp.OMIT;
  if (p != null) {
    indent=p.is(SerializeProp.INDENT);
    enc=enc(p.get(SerializeProp.ENCODING));
    if (!Charset.isSupported(enc))     error(SERENCODING,enc);
    version=p.get(SerializeProp.VERSION);
    if (!version.equals("1.0") && !version.equals("1.1"))     error(SERVERSION);
    final String s=p.get(SerializeProp.CDATA_SECTION_ELEMENTS).trim();
    if (s.length() != 0) {
      for (      final String c : s.split(" "))       cdata.add(token(c));
    }
    omit=p.is(SerializeProp.OMIT_XML_DECLARATION);
    sa=p.get(SerializeProp.STANDALONE);
    if (omit && !sa.equals(SerializeProp.OMIT))     error(SERSTAND);
    wrapPre=token(p.get(SerializeProp.WRAP_PRE));
    wrapUri=token(p.get(SerializeProp.WRAP_URI));
    wrap=wrapPre.length != 0;
  }
  if (!omit) {
    print(PI1);
    print(DOCDECL1);
    print(version);
    print(DOCDECL2);
    print(enc);
    print('\'');
    print(PI2);
    ind=indent;
  }
  if (wrap) {
    openElement(concat(wrapPre,COL,RESULTS));
    namespace(wrapPre,wrapUri);
  }
}
