{
  final HTTPContext ctx=new HTTPContext(req,res);
  try {
    ctx.session=new HTTPSession(req).login();
  }
 catch (  final LoginException ex) {
    ctx.status(SC_UNAUTHORIZED,ex.getMessage());
    return;
  }
  try {
    code.run(ctx);
    ctx.status(SC_OK,null);
  }
 catch (  final HTTPException ex) {
    ctx.status(ex.getStatus(),ex.getMessage());
  }
catch (  final IOException ex) {
    ctx.status(SC_BAD_REQUEST,Util.message(ex));
  }
catch (  final Exception ex) {
    Util.errln(Util.bug(ex));
    ctx.status(SC_INTERNAL_SERVER_ERROR,ex.toString());
  }
}
