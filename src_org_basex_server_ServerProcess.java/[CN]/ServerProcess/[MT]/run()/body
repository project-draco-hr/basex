{
  if (info)   Main.outln(this + " Login: " + context.user.name);
  log.write(this + " Login: " + context.user.name);
  try {
    while (true) {
      String input=null;
      try {
        input=in.readString();
      }
 catch (      final IOException ex) {
        exit();
        break;
      }
      final Performance perf=new Performance();
      proc=null;
      try {
        proc=new CommandParser(input,context,true).parse()[0];
      }
 catch (      final QueryException ex) {
        out.write(0);
        out.print(ex.extended());
        out.write(0);
        send(false);
      }
      if (proc instanceof Exit) {
        exit();
        break;
      }
      startTimer(proc);
      final boolean up=proc.updating(context) || (proc.flags & User.CREATE) != 0;
      sem.before(up);
      final boolean ok=proc.execute(context,out);
      out.write(0);
      final String inf=proc.info();
      out.print(inf.equals(PROGERR) ? SERVERTIME : inf);
      out.write(0);
      send(ok);
      stopTimer();
      sem.after(up);
      log.write(this + " " + proc.toString()+ ": "+ context.user.name);
      if (info)       Main.outln(this + " " + in+ ": "+ perf);
    }
    if (info)     Main.outln(this + " Logout: " + context.user.name);
    log.write(this + " Logout: " + context.user.name);
  }
 catch (  final IOException ex) {
    log.write(ex.getMessage());
    Main.error(ex,false);
  }
}
