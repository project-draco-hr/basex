{
  final String file=doc.replaceAll("\\\"","\\\\\"");
  final String name=Main.name(this);
  final boolean up=this instanceof XQUPTest;
  exec(new CreateDB(file,name));
  for (  final Object[] qu : queries) {
    if (up && ((String)qu[0]).startsWith("xxx")) {
      exec(new CreateDB(file,name));
    }
    final boolean correct=qu.length == 3;
    final String query=qu[correct ? 2 : 1].toString();
    final String cmd=qu[0] + ": " + query;
    final Proc proc=new XQuery(query);
    if (proc.exec(context)) {
      final Result val=proc.result();
      final Result cmp=correct ? (Result)qu[1] : null;
      if (val instanceof Nodes && cmp instanceof Nodes) {
        ((Nodes)cmp).data=((Nodes)val).data;
      }
      if (!correct || !val.same(cmp)) {
        fail(cmd + ": Right: " + (correct ? qu[1] : "error")+ "\n  Found: "+ val+ "\n"+ details());
      }
    }
 else     if (correct) {
      fail(qu[0] + ": " + proc.info()+ details());
    }
  }
}
