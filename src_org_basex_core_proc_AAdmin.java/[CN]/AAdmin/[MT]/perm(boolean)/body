{
  final String db=args[2];
  final CmdPerm cmd=getOption(CmdPerm.class);
  int perm=-1;
  if (cmd == CmdPerm.READ) {
    perm=User.READ;
  }
 else   if (cmd == CmdPerm.WRITE) {
    perm=User.WRITE;
  }
 else   if (cmd == CmdPerm.CREATE && db == null) {
    perm=User.CREATE;
  }
 else   if (cmd == CmdPerm.ADMIN && db == null) {
    perm=User.ADMIN;
  }
 else   if (cmd == CmdPerm.ALL) {
    perm=db == null ? User.READ | User.WRITE | User.CREATE| User.ADMIN : User.READ | User.WRITE;
  }
  if (perm == -1)   return error(PERMINV);
  final User user=context.users.get(args[1]);
  if (user == null)   return error(USERNO,args[1]);
  if (db == null) {
    user.perm(set,perm);
    context.users.write();
  }
 else {
    try {
      final Data data=Open.open(context,db);
      User u=data.meta.users.get(args[1]);
      if (u == null) {
        u=user.copy();
        u.perm(false,User.ADMIN);
        u.perm(false,User.CREATE);
        data.meta.users.add(u);
      }
      u.perm(set,perm);
      data.meta.dirty=true;
      Close.close(context,data);
    }
 catch (    final IOException ex) {
      Main.debug(ex);
      final String msg=ex.getMessage();
      return msg.length() != 0 ? error(msg) : error(DBOPENERR,db);
    }
  }
  return info(set ? PERMADD : PERMDEL);
}
