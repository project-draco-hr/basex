{
  final MainOptions opts=new MainOptions(qc.context.options,true);
  final MetaData meta=data.meta;
  options.assignIfEmpty(MainOptions.TEXTINDEX,meta.createtext);
  options.assignIfEmpty(MainOptions.ATTRINDEX,meta.createattr);
  options.assignIfEmpty(MainOptions.FTINDEX,meta.createft);
  options.assignIfEmpty(MainOptions.TEXTINCLUDE,meta.textinclude);
  options.assignIfEmpty(MainOptions.ATTRINCLUDE,meta.attrinclude);
  options.assignIfEmpty(MainOptions.TOKENINCLUDE,meta.tokeninclude);
  options.assignIfEmpty(MainOptions.FTINCLUDE,meta.ftinclude);
  options.assignIfEmpty(MainOptions.INDEXSPLITSIZE,meta.splitsize);
  options.assignIfEmpty(MainOptions.FTINDEXSPLITSIZE,meta.ftsplitsize);
  options.assignIfEmpty(MainOptions.UPDINDEX,meta.updindex);
  options.assignIfEmpty(MainOptions.AUTOOPTIMIZE,meta.autoopt);
  options.assignTo(opts);
  meta.createtext=opts.get(MainOptions.TEXTINDEX);
  meta.createattr=opts.get(MainOptions.ATTRINDEX);
  meta.createtoken=opts.get(MainOptions.TOKENINDEX);
  meta.createft=opts.get(MainOptions.FTINDEX);
  meta.updindex=opts.get(MainOptions.UPDINDEX);
  final int maxcats=opts.get(MainOptions.MAXCATS);
  final int maxlen=opts.get(MainOptions.MAXLEN);
  final String textinclude=opts.get(MainOptions.TEXTINCLUDE);
  final String attrinclude=opts.get(MainOptions.ATTRINCLUDE);
  final String tokeninclude=opts.get(MainOptions.TOKENINCLUDE);
  final boolean rebuild=maxcats != meta.maxcats || maxlen != meta.maxlen;
  final boolean rebuildText=rebuild || !meta.textinclude.equals(textinclude);
  final boolean rebuildAttr=rebuild || !meta.attrinclude.equals(attrinclude);
  final boolean rebuildToken=rebuild || !meta.tokeninclude.equals(tokeninclude);
  meta.textinclude=textinclude;
  meta.attrinclude=attrinclude;
  meta.tokeninclude=tokeninclude;
  meta.maxcats=maxcats;
  meta.maxlen=maxlen;
  meta.splitsize=opts.get(MainOptions.INDEXSPLITSIZE);
  meta.ftsplitsize=opts.get(MainOptions.FTINDEXSPLITSIZE);
  final boolean stemming=opts.get(MainOptions.STEMMING);
  final boolean casesens=opts.get(MainOptions.CASESENS);
  final boolean diacritics=opts.get(MainOptions.DIACRITICS);
  final String stopwords=opts.get(MainOptions.STOPWORDS);
  final Language language=Language.get(opts);
  final String ftinclude=opts.get(MainOptions.FTINCLUDE);
  final boolean rebuildFt=rebuild || !language.equals(meta.language) || stemming != meta.stemming || casesens != meta.casesens || diacritics != meta.diacritics || !stopwords.equals(meta.stopwords) || !meta.ftinclude.equals(ftinclude);
  meta.language=language;
  meta.stemming=stemming;
  meta.casesens=casesens;
  meta.diacritics=diacritics;
  meta.stopwords=stopwords;
  meta.ftinclude=ftinclude;
  meta.autoopt=opts.get(MainOptions.AUTOOPTIMIZE);
  try {
    if (all)     OptimizeAll.optimizeAll(data,qc.context,opts,null);
 else     Optimize.optimize(data,rebuildText,rebuildAttr,rebuildToken,rebuildFt,null);
  }
 catch (  final IOException ex) {
    throw UPDBOPTERR_X.get(info,ex);
  }
  if (all)   qc.resources.remove(meta.name);
}
