{
  if (READER == null)   return io;
  try {
    byte[] content=io.content();
    final ArrayInput ai=new ArrayInput(content);
    String enc=ai.encoding();
    content=ai.content().toArray();
    final byte[] encoding=token("charset=");
    int cs=indexOf(content,encoding);
    if (cs > 0) {
      cs+=encoding.length;
      int ce=cs;
      while (++ce < content.length && content[ce] > 0x28)       ;
      enc=string(substring(content,cs,ce));
    }
    final InputSource is=new InputSource(new ByteArrayInputStream(content));
    is.setEncoding(supported(enc) ? normEncoding(enc,null) : UTF8);
    final StringWriter sw=new StringWriter();
    final XMLReader reader=(XMLReader)Reflect.get(READER);
    reader.setContentHandler((ContentHandler)Reflect.get(WRITER,sw));
    reader.parse(is);
    return new IOContent(token(sw.toString()),io.name());
  }
 catch (  final Exception ex) {
    Util.debug(ex);
    return io;
  }
}
