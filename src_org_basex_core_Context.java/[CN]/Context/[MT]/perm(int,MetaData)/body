{
  int up=user.perm;
  if (m != null) {
    final User us=m.users.get(user.name);
    if (us != null)     up=up & ~(User.READ | User.WRITE) | us.perm;
  }
  int i=4;
  while (--i >= 0 && (1 << i & p) == 0 || (1 << i & up) != 0)   ;
  return i;
}
