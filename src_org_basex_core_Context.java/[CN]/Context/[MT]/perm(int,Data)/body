{
  final User u=user;
  int up=u.perm;
  if (d != null) {
    final User us=d.meta.users.get(u.name);
    if (us != null)     up=up & ~(User.READ | User.WRITE) | us.perm;
  }
  int i=4;
  while (--i >= 0 && (1 << i & p) == 0 || (1 << i & up) != 0)   ;
  return i;
}
