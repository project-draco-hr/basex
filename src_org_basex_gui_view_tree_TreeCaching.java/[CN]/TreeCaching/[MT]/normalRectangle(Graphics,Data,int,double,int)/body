{
  double xx=0;
  double ww=w;
  final RectangleCache[] rects=new RectangleCache[s];
  for (int i=0; i < s; i++) {
    final double boxMiddle=xx + ww / 2f;
    if (SLIM_TO_TEXT) {
      String st=getText(d,getPrePerLevelAndIndex(l,i));
      int o=calcOptimalRectWidth(g,st) + 10;
      if (o < MIN_SPACE)       o=MIN_SPACE;
      if (w > o) {
        xx=boxMiddle - o / 2;
        ww=o;
      }
    }
    final RectangleCache rect=new RectangleCache((int)xx,(int)ww);
    rects[i]=rect;
    xx+=w;
  }
  return rects;
}
