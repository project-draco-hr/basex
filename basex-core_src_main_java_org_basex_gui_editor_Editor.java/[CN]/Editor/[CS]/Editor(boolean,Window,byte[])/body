{
  super(win);
  setFocusable(true);
  setFocusTraversalKeysEnabled(!edit);
  editable=edit;
  addMouseMotionListener(this);
  addMouseWheelListener(this);
  addComponentListener(this);
  addMouseListener(this);
  addKeyListener(this);
  addFocusListener(new FocusAdapter(){
    @Override public void focusGained(    final FocusEvent e){
      if (isEnabled())       cursor(true);
    }
    @Override public void focusLost(    final FocusEvent e){
      cursor(false);
      rend.cursor(false);
    }
  }
);
  layout(new BorderLayout(0,0));
  scroll=new BaseXBar(this);
  lineNumberBar=editable ? new LineNumberBar() : null;
  rend=new Renderer(text,scroll,lineNumberBar);
  setFont(GUIConstants.dmfont);
  if (lineNumberBar != null)   add(lineNumberBar,BorderLayout.WEST);
  add(rend,BorderLayout.CENTER);
  add(scroll,BorderLayout.EAST);
  setText(txt);
  hist=new History(edit ? text.text() : null);
  if (edit) {
    setBackground(Color.white);
    setBorder(new MatteBorder(1,1,0,0,GUIConstants.color(6)));
  }
 else {
    mode(Fill.NONE);
  }
  new BaseXPopup(this,edit ? new GUICmd[]{new UndoCmd(),new RedoCmd(),null,new CutCmd(),new CopyCmd(),new PasteCmd(),new DelCmd(),null,new AllCmd()} : new GUICmd[]{new CopyCmd(),null,new AllCmd()});
}
