{
  final QueryProcessor qp=new QueryProcessor(qu,context);
  try {
    qp.compile();
    final FDoc plan=qp.plan();
    if (res != null)     assertEquals(res,qp.execute().toString());
    for (    final String p : pr) {
      if (new QueryProcessor(p,context).context(plan).value() != Bln.TRUE) {
        fail(NL + "- Query: " + qu+ NL+ "- Check: "+ p+ NL+ "- Plan: "+ plan.serialize());
      }
    }
  }
 catch (  final QueryException|QueryIOException ex) {
    final AssertionError err=new AssertionError(Util.message(ex));
    err.initCause(ex);
    throw err;
  }
 finally {
    qp.close();
  }
}
