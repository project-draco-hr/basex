{
  final XQuery query=new XQuery("\n" + "               <sales-qty-by-product>{\n" + "                 for $sales in $sales-records-doc/*/record\n"+ "                 let $pname := $sales/product-name\n"+ "                 group by $pname\n"+ "                 order by $pname\n"+ "                 return\n"+ "                   <product name=\"{$pname}\">{\n"+ "                     sum($sales/qty)\n"+ "                   }</product>\n"+ "               }</sales-qty-by-product> \n"+ "      ",ctx);
  try {
    query.bind("$products-doc",node(file("prod/GroupByClause/products.xml")));
    query.bind("$sales-records-doc",node(file("prod/GroupByClause/sales-records.xml")));
    query.bind("$stores-doc",node(file("prod/GroupByClause/stores.xml")));
    query.bind("$books-doc",node(file("prod/GroupByClause/books.xml")));
    result=new QT3Result(query.value());
  }
 catch (  final Throwable trw) {
    result=new QT3Result(trw);
  }
 finally {
    query.close();
  }
  test(assertSerialization("<sales-qty-by-product><product name=\"blender\">250</product><product name=\"broiler\">20</product><product name=\"shirt\">10</product><product name=\"socks\">510</product><product name=\"toaster\">200</product></sales-qty-by-product>",false));
}
