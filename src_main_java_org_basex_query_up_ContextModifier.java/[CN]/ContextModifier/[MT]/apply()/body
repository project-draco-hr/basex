{
  final Collection<DatabaseUpdates> updates=pendingUpdates.values();
  final Collection<DBCreate> creates=dbCreates.values();
  if (tmp == null) {
    for (    final DatabaseUpdates c : updates) {
      tmp=new MemData(c.data().meta.prop);
      break;
    }
  }
  for (  final DatabaseUpdates c : updates)   c.check(tmp);
  for (  final DBCreate c : creates)   c.prepare(null);
  int i=0;
  try {
    for (    final DatabaseUpdates c : updates) {
      c.startUpdate();
      i++;
    }
    for (    final DatabaseUpdates c : updates)     c.apply(tmp);
  }
  finally {
    for (    final DatabaseUpdates c : updates) {
      if (i-- == 0)       break;
      c.finishUpdate();
    }
  }
  for (  final DBCreate c : creates)   c.apply();
}
