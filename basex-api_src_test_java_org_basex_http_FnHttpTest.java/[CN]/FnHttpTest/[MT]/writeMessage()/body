{
  final HttpRequest req1=new HttpRequest();
  final FakeHttpConnection fakeConn1=new FakeHttpConnection(new URL("http://www.test.com"));
  req1.payloadAttrs.put(SerializerOptions.MEDIA_TYPE.name(),"text/xml");
  final FElem e1=new FElem("a").add("a");
  req1.bodyContent.add(e1);
  req1.bodyContent.add(Str.get("<b>b</b>"));
  HttpClient.setRequestContent(fakeConn1.getOutputStream(),req1);
  assertEquals("<a>a</a>&lt;b&gt;b&lt;/b&gt;",fakeConn1.out.toString(Strings.UTF8));
  final HttpRequest req2=new HttpRequest();
  final FakeHttpConnection fakeConn2=new FakeHttpConnection(new URL("http://www.test.com"));
  req2.payloadAttrs.put(SerializerOptions.MEDIA_TYPE.name(),"text/plain");
  final FElem e2=new FElem("a").add("a");
  req2.bodyContent.add(e2);
  req2.bodyContent.add(Str.get("<b>b</b>"));
  HttpClient.setRequestContent(fakeConn2.getOutputStream(),req2);
  assertEquals("a<b>b</b>",fakeConn2.out.toString());
  final HttpRequest req3=new HttpRequest();
  final FakeHttpConnection fakeConn3=new FakeHttpConnection(new URL("http://www.test.com"));
  req3.payloadAttrs.put(SerializerOptions.MEDIA_TYPE.name(),"text/xml");
  req3.payloadAttrs.put("method","text");
  final FElem e3=new FElem("a").add("a");
  req3.bodyContent.add(e3);
  req3.bodyContent.add(Str.get("<b>b</b>"));
  HttpClient.setRequestContent(fakeConn3.getOutputStream(),req3);
  assertEquals("a<b>b</b>",fakeConn3.out.toString());
}
