{
  final HttpRequest req=new HttpRequest();
  req.isMultipart=true;
  req.payloadAttrs.put(token("media-type"),token("multipart/alternative"));
  req.payloadAttrs.put(token("boundary"),token("boundary42"));
  final Part p1=new Part();
  p1.headers.put(token("Content-Type"),token("text/plain; charset=us-ascii"));
  p1.bodyAttrs.put(token("media-type"),token("text/plain"));
  final String plain="...plain text....";
  p1.bodyContent.add(Str.get(plain + '\n'));
  final Part p2=new Part();
  p2.headers.put(token("Content-Type"),token("text/richtext"));
  p2.bodyAttrs.put(token("media-type"),token("text/richtext"));
  final String rich=".... richtext version...";
  p2.bodyContent.add(Str.get(rich));
  final Part p3=new Part();
  p3.headers.put(token("Content-Type"),token("text/x-whatever"));
  p3.bodyAttrs.put(token("media-type"),token("text/x-whatever"));
  final String fancy=".... fanciest formatted version...";
  p3.bodyContent.add(Str.get(fancy));
  req.parts.add(p1);
  req.parts.add(p2);
  req.parts.add(p3);
  final FakeHttpConnection fakeConn=new FakeHttpConnection(new URL("http://www.test.com"));
  final HttpClient hc=new HttpClient(null,ctx.options);
  hc.setRequestContent(fakeConn.getOutputStream(),req);
  final String expResult="--boundary42" + CRLF + "Content-Type: text/plain; charset=us-ascii"+ CRLF+ CRLF+ plain+ Prop.NL+ CRLF+ "--boundary42"+ CRLF+ "Content-Type: text/richtext"+ CRLF+ CRLF+ rich+ CRLF+ "--boundary42"+ CRLF+ "Content-Type: text/x-whatever"+ CRLF+ CRLF+ fancy+ CRLF+ "--boundary42--"+ CRLF;
  final String fake=fakeConn.getOutputStream().toString();
  assertEquals(expResult,fake);
}
