{
  final DataInputStream dis=new DataInputStream(socket.getInputStream());
  final String in=dis.readUTF().trim();
  final InetAddress addr=socket.getInetAddress();
  final String ha=addr.getHostAddress();
  final int sp=socket.getPort();
  if (verbose)   BaseX.outln("[%:%] %",ha,sp,in);
  Process pr=null;
  try {
    pr=new CommandParser(in).parse()[0];
  }
 catch (  final QueryException ex) {
    pr=new Process(0){
    }
;
    pr.error(ex.extended());
    core=pr;
    send(socket,-sp);
    return;
  }
  final Process proc=pr;
  if (proc instanceof GetResult || proc instanceof GetInfo) {
    final OutputStream os=socket.getOutputStream();
    final PrintOutput out=new PrintOutput(new BufferedOutput(os));
    final Process c=core;
    if (c == null) {
      out.print(BaseX.info(SERVERTIME,Prop.timeout));
    }
 else     if (proc instanceof GetResult) {
      c.output(out);
    }
 else     if (proc instanceof GetInfo) {
      c.info(out);
    }
    out.close();
  }
 else {
    core=proc;
    send(socket,proc.execute(context) ? sp : -sp);
  }
  dis.close();
}
