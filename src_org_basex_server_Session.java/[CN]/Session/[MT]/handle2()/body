{
  System.out.println("Login from Client " + clientId);
  final DataInputStream dis=new DataInputStream(socket.getInputStream());
  final DataOutputStream dos=new DataOutputStream(socket.getOutputStream());
  final int sp=socket.getPort();
  String in;
  while (running) {
    in=dis.readUTF().trim();
    if (in.equals("exit")) {
      System.out.println("Client " + clientId + " has logged out.");
      running=false;
    }
    Process pr=null;
    try {
      pr=new CommandParser(in).parse()[0];
    }
 catch (    final QueryException ex) {
      pr=new Process(0){
      }
;
      pr.error(ex.extended());
      core=pr;
      dos.writeInt(-sp);
    }
    final Process proc=pr;
    if (proc instanceof GetResult || proc instanceof GetInfo) {
      final OutputStream os=socket.getOutputStream();
      final PrintOutput out=new PrintOutput(new BufferedOutput(os));
      final Process c=core;
      if (c == null) {
        out.print(BaseX.info(SERVERTIME,Prop.timeout));
      }
 else       if (proc instanceof GetResult) {
        c.output(out);
      }
 else       if (proc instanceof GetInfo) {
        c.info(out);
      }
      out.close();
    }
 else {
      core=proc;
      dos.writeInt(proc.execute(context) ? sp : -sp);
    }
  }
  dis.close();
  dos.close();
  socket.close();
}
