{
  final XQuery qdoc=new XQuery("doc(' " + name + "')",ctx);
  final XdmValue doc=qdoc.value();
  final XQuery qset=new XQuery("*:test-set",ctx).context(doc);
  final XdmValue set=qset.value();
  base=IO.get(doc.getBaseURI()).dirPath();
  qdoc.close();
  if (supported(set)) {
    final XQuery qenv=new XQuery("*:environment",ctx).context(set);
    final ArrayList<QT3Env> envs=new ArrayList<QT3Env>();
    for (    final XdmItem ienv : qenv)     envs.add(new QT3Env(ctx,ienv));
    qenv.close();
    final XQuery qts=new XQuery("*:test-case",ctx).context(set);
    for (    final XdmItem its : qts) {
      try {
        testCase(its,envs);
      }
 catch (      final IOException ex) {
        Util.debug(ex);
      }
    }
    qts.close();
  }
  qset.close();
}
