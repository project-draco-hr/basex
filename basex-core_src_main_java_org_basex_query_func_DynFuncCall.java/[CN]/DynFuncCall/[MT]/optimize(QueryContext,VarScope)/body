{
  final Expr f=body();
  final Type t=f.seqType().type;
  final int last=exprs.length - 1;
  if (t instanceof FuncType) {
    final FuncType ft=(FuncType)t;
    if (ft.argTypes != null && ft.argTypes.length != last) {
      final Expr e=f instanceof FuncItem ? ((FuncItem)f).expr : f;
      throw INVARITY_X_X_X_X.get(info,e,last,last == 1 ? "" : "s",ft.argTypes.length);
    }
    if (ft.type != null)     seqType=ft.type;
  }
  if ((f instanceof Map || f instanceof Array) && allAreValues())   return optPre(value(qc),qc);
  if (f instanceof XQFunctionExpr) {
    final XQFunctionExpr fe=(XQFunctionExpr)f;
    if (!(f instanceof FuncItem && comesFrom((FuncItem)f))) {
      checkUpdating(fe);
      final Expr[] args=Arrays.copyOf(exprs,last);
      final Expr in=fe.inlineExpr(args,qc,scp,info);
      if (in != null)       return in;
    }
  }
 else   if (f instanceof Item && !(f instanceof FItem)) {
    throw INVFUNCITEM_X_X.get(info,((Item)f).type,f);
  }
  return this;
}
