{
  final byte[] t=payloadAtts.get(MEDIA_TYPE);
  final String type=t == null ? null : string(t);
  final byte[] src=payloadAtts.get(SRC);
  if (src == null) {
    byte[] m=payloadAtts.get(METHOD);
    if (m == null) {
      if (eq(type,APP_HTML_XML)) {
        m=token(SerialMethod.XHTML.toString());
      }
 else       if (eq(type,TEXT_HTML)) {
        m=token(SerialMethod.HTML.toString());
      }
 else       if (type != null && isXML(type)) {
        m=token(SerialMethod.XML.toString());
      }
 else       if (type != null && isText(type)) {
        m=token(SerialMethod.TEXT.toString());
      }
 else {
        m=token(SerialMethod.XML.toString());
      }
    }
    if (eq(m,BASE64)) {
      writeBase64(payload,out);
    }
 else     if (eq(m,HEXBIN)) {
      writeHex(payload,out);
    }
 else {
      write(payload,payloadAtts,m,out);
    }
  }
 else {
    writeResource(src,out);
  }
}
