{
  final HTTPRequest r=new HTTPRequest();
  parseAttrs(request,r.attrs);
  checkRequest(r);
  final ANode payload=parseHdrs(request.children(),r.headers);
  final byte[] method=lc(r.attrs.get(METHOD));
  if (eq(method,TRACE,DELETE) && (payload != null || bodies != null))   HC_REQ.thrw(info,"Body not expected for method " + string(method));
  if (payload != null) {
    final QNm pl=payload.qname();
    if (pl.eq(Q_HTTP_BODY)) {
      final Item it=bodies != null ? bodies.next() : null;
      parseBody(payload,it,r.payloadAttrs,r.bodyContent);
      r.isMultipart=false;
    }
 else     if (pl.eq(Q_HTTP_MULTIPART)) {
      parseMultipart(payload,bodies,r.payloadAttrs,r.parts);
      r.isMultipart=true;
    }
 else {
      HC_REQ.thrw(info,"Unknown payload element " + pl);
    }
  }
  return r;
}
