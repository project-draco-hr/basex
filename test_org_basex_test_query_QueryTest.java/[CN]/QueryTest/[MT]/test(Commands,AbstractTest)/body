{
  boolean ok=true;
  String name=test.getClass().getSimpleName();
  System.out.println(name + " (" + test.queries.length+ " queries)...");
  out("\nBuilding database...\n");
  final String file=test.doc.replaceAll("\\\"","\\\\\"");
  Proc proc=Proc.get(context,Commands.CREATEXML,"\"" + file + "\"");
  if (!proc.execute()) {
    err("\n",proc.info());
    return false;
  }
  out("\nRunning tests...\n");
  for (  final Object[] qu : test.queries) {
    out("- " + qu[0] + ": ");
    boolean correct=qu.length == 3;
    String query=qu[correct ? 2 : 1].toString();
    proc=Proc.get(context,cmd,query);
    if (proc.execute()) {
      Result value=proc.result();
      if (cmd == Commands.XQUERY)       value=((XQResult)value).xpResult(context.data());
      final Result cmp=correct ? (Result)qu[1] : null;
      if (value instanceof Nodes && cmp instanceof Nodes) {
        ((Nodes)cmp).data=((Nodes)value).data;
      }
      if (!correct || !value.same(cmp)) {
        err("\"" + query + "\":\n  Expected: "+ (correct ? qu[1] : "error")+ "\n  Found: "+ value+ "\n",qu[0]);
        ok=false;
        continue;
      }
      out("ok\n");
    }
 else {
      String info=proc.info().replaceAll("Stopped.*\\n(\\[.*?\\] )?","");
      if (correct) {
        err(info + "\n",qu[0].toString());
        ok=false;
      }
 else {
        out("ok (" + info + ")\n");
      }
    }
  }
  out("\n");
  return ok;
}
