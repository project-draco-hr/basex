{
  boolean ok=true;
  final String file=test.doc.replaceAll("\\\"","\\\\\"");
  Process proc=new CreateDB(file);
  if (!proc.execute(context)) {
    err(proc.info(),null);
    return false;
  }
  for (  final Object[] qu : test.queries) {
    final boolean correct=qu.length == 3;
    final String query=qu[correct ? 2 : 1].toString();
    proc=xquery ? new XQuery(query) : new XPath(query);
    if (proc.execute(context)) {
      Result val=proc.result();
      if (xquery)       val=((XQResult)val).xpResult(context.data());
      final Result cmp=correct ? (Result)qu[1] : null;
      if (val instanceof Nodes && cmp instanceof Nodes) {
        ((Nodes)cmp).data=((Nodes)val).data;
      }
      if (!correct || !val.same(cmp)) {
        err(qu[0] + ": " + (xquery ? "xquery " : "xpath ")+ query,"  Right: " + (correct ? qu[1] : "error") + "\n  Found: "+ val+ (ext != null ? "\n  Flags: " + ext : ""));
        ok=false;
        continue;
      }
    }
 else     if (correct) {
      err(qu[0].toString(),proc.info().replaceAll("Stopped.*\\n(\\[.*?\\] )?",""));
      ok=false;
    }
  }
  final String db=context.data().meta.dbname;
  new Close().execute(context);
  DropDB.drop(db);
  return ok;
}
