{
  if (!ctx.user.has(Perm.CREATE))   throw new BaseXException(PERM_NEEDED_X,CmdPerm.CREATE);
  final Prop prop=ctx.prop;
  if (prop.is(Prop.MAINMEM))   return MemBuilder.build(name,parser);
  if (ctx.pinned(name))   throw new BaseXException(DB_PINNED_X,name);
  final Builder builder=new DiskBuilder(name,parser,ctx);
  try {
    final Data data=builder.build();
    if (data.meta.createtext)     data.setIndex(IndexType.TEXT,new ValueBuilder(data,true).build());
    if (data.meta.createattr)     data.setIndex(IndexType.ATTRIBUTE,new ValueBuilder(data,false).build());
    if (data.meta.createftxt)     data.setIndex(IndexType.FULLTEXT,FTBuilder.get(data).build());
    data.close();
  }
  finally {
    try {
      builder.close();
    }
 catch (    final IOException exx) {
      Util.debug(exx);
    }
  }
  ctx.databases().add(name);
  return Open.open(name,ctx);
}
