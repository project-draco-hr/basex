{
  final NodeCache attrs=extractAttrs(conn);
  final NodeCache hdrs=extractHdrs(conn);
  final String cType=mediaTypeOvr == null ? extractContentType(conn.getContentType()) : string(mediaTypeOvr);
  final ItemCache payloads=new ItemCache();
  final FNode body;
  final boolean s=status != null && Bln.parse(status,input);
  if (cType.startsWith(MULTIPART)) {
    final byte[] boundary=extractBoundary(conn.getContentType());
    final NodeCache a=new NodeCache();
    a.add(new FAttr(new QNm(MEDIATYPE,EMPTY),token(cType)));
    a.add(new FAttr(new QNm(BOUNDARY,EMPTY),boundary));
    body=new FElem(new QNm(HTTP_MULTIPART,HTTPURI),extractParts(conn.getInputStream(),s,payloads,concat(token("--"),boundary)),a,new Atts(HTTP,HTTPURI));
  }
 else {
    body=createBody(cType);
    if (!s)     payloads.add(interpretPayload(extractPayload(conn.getInputStream(),cType,extractCharset(conn.getContentType())),cType));
  }
  final FElem responseEl=new FElem(new QNm(HTTP_RESPONSE,HTTPURI),hdrs,attrs,new Atts(HTTP,HTTPURI));
  responseEl.add(body);
  final ItemCache result=new ItemCache();
  result.add(responseEl);
  result.add(payloads.value());
  return result;
}
