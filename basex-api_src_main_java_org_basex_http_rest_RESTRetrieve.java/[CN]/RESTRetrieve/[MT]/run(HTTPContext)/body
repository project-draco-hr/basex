{
  open(http);
  final LocalSession session=http.session();
  if (http.depth() == 0) {
    final Table table=new Table(session.execute(new List()));
    final SerializerOptions sopts=new SerializerOptions(http.serialization);
    final Serializer ser=Serializer.get(http.res.getOutputStream(),sopts);
    http.initResponse(sopts);
    final FElem el=new FElem(Q_DATABASES).declareNS();
    el.add(RESOURCES,token(table.contents.size()));
    list(table,el,Q_DATABASE,1);
    ser.serialize(el);
    ser.close();
  }
 else   if (!exists(http)) {
    final Table table=new Table(session.execute(new List(http.db(),http.dbpath())));
    final String serial=http.serialization;
    final SerializerOptions sopts=new SerializerOptions(serial);
    final Serializer ser=Serializer.get(http.res.getOutputStream(),sopts);
    http.initResponse(sopts);
    final FElem el=new FElem(Q_DATABASE).declareNS();
    el.add(NAME,http.db());
    el.add(RESOURCES,token(table.contents.size()));
    list(table,el,Q_RESOURCE,0);
    ser.serialize(el);
    ser.close();
  }
 else   if (isRaw(http)) {
    final String ct=SerializerOptions.S_MEDIA_TYPE.name + '=' + contentType(http);
    http.initResponse(new SerializerOptions(ct + ',' + http.serialization));
    session.setOutputStream(http.res.getOutputStream());
    session.execute(new Retrieve(http.dbpath()));
  }
 else {
    http.initResponse(new SerializerOptions(http.serialization));
    session.execute(new Set(MainOptions.SERIALIZER,serial(http)));
    session.setOutputStream(http.res.getOutputStream());
    session.query(".").execute();
  }
}
