{
  final Auth a=HttpManager.request().getAuthorization();
  final String user=a != null ? a.getUser() : null;
  final String pass=a != null ? a.getPassword() : null;
  final HTTPSession session=new HTTPSession(user,pass);
  try {
    final Session s=session.login();
    try {
      Path p=Path.path(dbpath);
      if (!getRequest().getContextPath().isEmpty())       p=p.getStripFirst();
      if (!getRequest().getServletPath().isEmpty())       p=p.getStripFirst();
      if (p.isRoot())       return new BXRootResource(session);
      final String db=p.getFirst();
      return p.getLength() == 1 ? listDBs(s).contains(db) ? new BXDatabase(db,session) : null : resource(s,db,p.getStripFirst().toString(),session);
    }
  finally {
      s.close();
    }
  }
 catch (  final LoginException ex) {
    return NOAUTH;
  }
catch (  final IOException ex) {
    Util.errln(ex);
  }
  return null;
}
