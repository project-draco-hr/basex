{
  for (int p=0; p < preds.length; p++) {
    Expr pred=preds[p].optimizeEbv(qc,scp);
    preds[p]=pred;
    if (pred instanceof CmpG || pred instanceof CmpV) {
      final Cmp cmp=(Cmp)pred;
      final Expr e1=cmp.exprs[0], e2=cmp.exprs[1];
      if (e1.isFunction(Function.POSITION)) {
        final SeqType st2=e2.seqType();
        if (e2.isFunction(Function.LAST) || st2.one() && st2.type.isNumber()) {
          if (cmp instanceof CmpG && ((CmpG)cmp).op == OpG.EQ || cmp instanceof CmpV && ((CmpV)cmp).op == OpV.EQ) {
            qc.compInfo(OPTREWRITE_X,pred);
            preds[p]=e2;
          }
        }
      }
    }
 else     if (pred instanceof And) {
      if (!pred.has(Flag.POS)) {
        qc.compInfo(OPTPRED_X,pred);
        final Expr[] and=((Arr)pred).exprs;
        final int m=and.length - 1;
        final ExprList el=new ExprList(preds.length + m);
        for (        final Expr e : Arrays.asList(preds).subList(0,p))         el.add(e);
        for (        final Expr a : and) {
          el.add(Function.BOOLEAN.get(scp.sc,info,a).optimizeEbv(qc,scp));
        }
        for (        final Expr e : Arrays.asList(preds).subList(p + 1,preds.length))         el.add(e);
        preds=el.finish();
      }
    }
 else     if (pred instanceof ANum) {
      final ANum it=(ANum)pred;
      final long i=it.itr();
      if (i != it.dbl())       return optPre(qc);
      pred=Pos.get(i,info);
      if (!(pred instanceof Pos))       return optPre(qc);
      preds[p]=pred;
    }
 else     if (pred.isValue()) {
      if (pred.ebv(qc,info).bool(info)) {
        qc.compInfo(OPTREMOVE_X_X,this,pred);
        preds=Array.delete(preds,p--);
      }
 else {
        return optPre(qc);
      }
    }
  }
  return this;
}
