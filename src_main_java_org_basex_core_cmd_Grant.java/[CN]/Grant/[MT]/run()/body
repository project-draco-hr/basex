{
  final String name=args[1];
  final String db=args[2];
  if (name.equals(ADMIN))   return error(USERADMIN);
  final CmdPerm cmd=getOption(CmdPerm.class);
  int perm=-1;
  if (cmd == CmdPerm.NONE) {
    perm=User.NONE;
  }
 else   if (cmd == CmdPerm.READ) {
    perm=User.READ;
  }
 else   if (cmd == CmdPerm.WRITE) {
    perm=User.WRITE;
  }
 else   if (cmd == CmdPerm.CREATE && db == null) {
    perm=User.CREATE;
  }
 else   if (cmd == CmdPerm.ADMIN && db == null) {
    perm=User.ADMIN;
  }
  if (perm == -1)   return error(PERMINV);
  final User user=context.users.get(name);
  if (user == null)   return error(USERNO,name);
  if (db == null) {
    user.perm=perm;
    context.users.write();
  }
 else {
    try {
      final Data data=Open.open(db,context);
      User u=data.meta.users.get(name);
      if (u == null) {
        u=user.copy();
        data.meta.users.add(u);
      }
      u.perm=perm;
      data.flush();
      Close.close(context,data);
    }
 catch (    final IOException ex) {
      Util.debug(ex);
      final String msg=ex.getMessage();
      return msg.isEmpty() ? error(DBOPENERR,db) : error(msg);
    }
  }
  return info(PERMUP);
}
