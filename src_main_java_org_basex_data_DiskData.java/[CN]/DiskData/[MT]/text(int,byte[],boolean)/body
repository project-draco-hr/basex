{
  final DataAccess store=text ? texts : values;
  final long len=store.length();
  final long v=toSimpleInt(value);
  final boolean vn=v != Integer.MIN_VALUE;
  final byte[] vl=vn ? null : comp.pack(value);
  final long old=textOff(pre);
  final long off;
  if (num(old)) {
    off=len;
  }
 else {
    final int l=vn ? 0 : vl.length + Num.length(vl.length);
    off=store.free(old & IO.OFFCOMP - 1,l);
  }
  if (vn) {
    textOff(pre,v | IO.OFFNUM);
  }
 else {
    store.writeToken(off,vl);
    textOff(pre,vl == value ? off : off | IO.OFFCOMP);
  }
}
