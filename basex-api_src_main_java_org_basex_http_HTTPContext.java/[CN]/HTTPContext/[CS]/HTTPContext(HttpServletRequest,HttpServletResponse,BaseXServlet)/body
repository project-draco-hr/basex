{
  this.req=req;
  this.res=res;
  params=new HTTPParams(this);
  method=req.getMethod();
  final StringBuilder uri=new StringBuilder(req.getRequestURL());
  final String qs=req.getQueryString();
  if (qs != null)   uri.append('?').append(qs);
  log('[' + method + "] "+ uri,null);
  res.setCharacterEncoding(UTF8);
  path=decode(normalize(req.getPathInfo()));
  final GlobalOptions mprop=context().globalopts;
  user=servlet.user != null ? servlet.user : mprop.get(GlobalOptions.USER);
  pass=servlet.pass != null ? servlet.pass : mprop.get(GlobalOptions.PASSWORD);
  final String auth=req.getHeader(AUTHORIZATION);
  if (auth != null) {
    final String[] values=auth.split(" ");
    if (values[0].equals(BASIC)) {
      final String[] cred=org.basex.util.Base64.decode(values[1]).split(":",2);
      if (cred.length != 2)       throw new LoginException(NOPASSWD);
      user=cred[0];
      pass=cred[1];
    }
 else {
      throw new LoginException(WHICHAUTH,values[0]);
    }
  }
}
