{
  final AtomicUpdateList l=atomics("<a><b/></a>");
  l.addDelete(2);
  l.addDelete(2);
  thrown.expect(RuntimeException.class);
  thrown.expectMessage("Multiple deletes/replaces on node");
  optimize(l,-1);
  l.clear();
  l.addDelete(2);
  l.addReplace(2,data("<newb/>"));
  thrown.expect(RuntimeException.class);
  thrown.expectMessage("Multiple deletes/replaces on node");
  optimize(l,-1);
  l.clear();
  l.addReplace(2,data("<newb/>"));
  l.addReplace(2,data("<newb/>"));
  thrown.expect(RuntimeException.class);
  thrown.expectMessage("Multiple deletes/replaces on node");
  optimize(l,-1);
}
