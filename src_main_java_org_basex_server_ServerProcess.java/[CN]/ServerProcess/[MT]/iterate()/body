{
  String input=in.readString();
  OutputStream o=socket.getOutputStream();
  QueryProcessor processor=new QueryProcessor(input,context);
  try {
    Iter iter=processor.iter();
    XMLSerializer serializer=new XMLSerializer(o);
    o.write(0);
    Item item;
    while (in.read() == 0) {
      if ((item=iter.next()) != null) {
        o.write(0);
        item.serialize(serializer);
        o.write(0);
      }
 else {
        o.write(1);
      }
    }
    serializer.close();
    processor.close();
  }
 catch (  QueryException ex) {
    log.write(this,input,INFOERROR + ex.extended());
    o.write(1);
    out.print(ex.extended());
    out.flush();
    o.write(0);
  }
}
