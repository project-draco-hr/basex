{
  if (fd != null) {
    if (mode == Mode.FDOPEN)     fd.setFile(" ");
    fd.setMode(mode == Mode.FSAVE || mode == Mode.DSAVE ? FileDialog.SAVE : FileDialog.LOAD);
    fd.setVisible(true);
    if (fd.getFile() == null)     return null;
    final String dir=fd.getDirectory();
    return IO.get(mode == Mode.DOPEN || mode == Mode.DSAVE ? dir : dir + "/" + fd.getFile());
  }
  int state=0;
switch (mode) {
case FOPEN:
    state=fc.showOpenDialog(gui);
  break;
case FDOPEN:
fc.setFileSelectionMode(JFileChooser.FILES_AND_DIRECTORIES);
state=fc.showOpenDialog(gui);
break;
case DOPEN:
fc.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
state=fc.showDialog(gui,null);
break;
case FSAVE:
state=fc.showSaveDialog(gui);
break;
case DSAVE:
fc.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
state=fc.showDialog(gui,null);
break;
}
if (state != JFileChooser.APPROVE_OPTION) return null;
final IO io=IO.get(fc.getSelectedFile().getPath());
return io.exists() || mode != Mode.FSAVE || Dialog.confirm(gui,BaseX.info(FILEREPLACE,io.name())) ? io : null;
}
