{
  final Expr e=expr.length != 0 ? expr[0] : checkCtx(ctx);
switch (def) {
case POS:
    return Itr.get(ctx.pos);
case LAST:
  return Itr.get(ctx.size);
case STRING:
Item it=e.atomic(ctx,input);
return it == null ? Str.ZERO : it.str() && !it.unt() ? it : Str.get(it.atom());
case NUMBER:
final Iter ir=ctx.iter(e);
it=ir.next();
return it == null || ir.next() != null ? Dbl.NAN : number(it,ctx);
case STRLEN:
return Itr.get(len(checkEStr(e,ctx)));
case NORM:
return Str.get(norm(checkEStr(e,ctx)));
case URIQNAME:
it=e.atomic(ctx,input);
if (it == null) return null;
final QNm qn=(QNm)checkType(it,Type.QNM);
return qn.hasUri() ? qn.uri() : Uri.uri(ctx.ns.uri(qn.pref(),true,ii));
default :
return super.atomic(ctx,ii);
}
}
