{
  final XQuery query=new XQuery("declare namespace functx = \"http://www.example.com/\";\n" + "         declare namespace new = \"http://new\";\n" + "                    (:~ : Adds attributes to XML elements : : @author Priscilla Walmsley, Datypic : @version 1.0 : @see http://www.xqueryfunctions.com/xq/functx_add-attributes.html : @param $elements the element(s) to which you wish to add the attribute : @param $attrNames the name(s) of the attribute(s) to add : @param $attrValues the value(s) of the attribute(s) to add :)\n"+ "         declare function functx:add-attributes ( $elements as element()* , $attrNames as xs:QName* , $attrValues as xs:anyAtomicType* ) as element()? { \n"+ "            for $element in $elements \n"+ "            return element { node-name($element)} { \n"+ "               for $attrName at $seq in $attrNames \n"+ "               return if ($element/@*[node-name(.) = $attrName]) then () else attribute {$attrName} {$attrValues[$seq]}, $element/@*, $element/node() } \n"+ "            } ;\n"+ "         let $in-xml := <in-xml> <a>x</a> <b att1=\"x\">x</b> </in-xml> \n"+ "         return (functx:add-attributes( $in-xml/a, QName('http://new','new:att1'), 1))\n"+ "      ",ctx);
  try {
    result=new QT3Result(query.value());
  }
 catch (  final Throwable trw) {
    result=new QT3Result(trw);
  }
 finally {
    query.close();
  }
  test(assertSerialization("<a xmlns:new=\"http://new\" new:att1=\"1\">x</a>",false));
}
