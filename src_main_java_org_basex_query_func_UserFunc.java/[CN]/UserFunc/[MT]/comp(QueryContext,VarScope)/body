{
  if (compiled)   return;
  compiled=true;
  for (  final Entry<Var,Expr> e : scope.closure().entrySet())   e.setValue(e.getValue().compile(ctx,outer));
  final StaticContext tmp=ctx.sc;
  ctx.sc=sc;
  final int fp=scope.enter(ctx);
  try {
    for (    final Entry<Var,Expr> e : staticBindings())     ctx.set(e.getKey(),e.getValue().value(ctx),info);
    expr=expr.compile(ctx,scope);
  }
 catch (  final QueryException qe) {
    expr=FNInfo.error(qe,info);
  }
 finally {
    scope.cleanUp(this);
    scope.exit(ctx,fp);
    ctx.sc=tmp;
  }
  if (tco()) {
    ctx.compInfo(OPTTCE,name);
    expr=expr.markTailCalls();
  }
  if (ret == null)   return;
  type=ret;
  if ((ret.type == AtomType.BLN || ret.type == AtomType.FLT || ret.type == AtomType.DBL || ret.type == AtomType.QNM || ret.type == AtomType.URI) && ret.eq(expr.type())) {
    ctx.compInfo(OPTCAST,ret);
    cast=false;
  }
}
