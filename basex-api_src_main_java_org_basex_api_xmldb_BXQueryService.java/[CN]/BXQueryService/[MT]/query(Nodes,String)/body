{
  final QueryProcessor qp=new QueryProcessor(query,coll.ctx).context(nodes);
  try {
    qp.parse();
    try {
      coll.ctx.register(qp);
      for (      final String n : ns.keySet()) {
        qp.sc.ns.add(token(n),token(ns.get(n)),null);
      }
      return new BXResourceSet(qp.execute(),coll);
    }
  finally {
      qp.close();
      coll.ctx.unregister(qp);
    }
  }
 catch (  final QueryException ex) {
    throw new XMLDBException(ErrorCodes.VENDOR_ERROR,ex.getMessage());
  }
}
