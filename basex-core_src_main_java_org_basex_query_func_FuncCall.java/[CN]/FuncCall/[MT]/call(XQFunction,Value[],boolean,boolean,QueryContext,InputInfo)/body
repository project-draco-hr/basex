{
  final int calls=ctx.tailCalls, max=ctx.maxCalls;
  if (tc && max >= 0 && ++ctx.tailCalls >= max) {
    throw new Continuation(fun,arg);
  }
  try {
    if (tc)     return itm ? fun.internalInvItem(ctx,ii,arg) : fun.internalInvValue(ctx,ii,arg);
    XQFunction func=fun;
    Value[] args=arg;
    for (; ; ) {
      try {
        return itm ? func.internalInvItem(ctx,ii,args) : func.internalInvValue(ctx,ii,args);
      }
 catch (      final Continuation c) {
        func=c.getFunc();
        args=c.getArgs();
        ctx.tailCalls=calls;
      }
    }
  }
 catch (  final QueryException ex) {
    ex.add(ii);
    throw ex;
  }
 finally {
    ctx.tailCalls=calls;
  }
}
