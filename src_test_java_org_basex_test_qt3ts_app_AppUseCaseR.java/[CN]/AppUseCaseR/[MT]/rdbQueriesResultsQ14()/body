{
  final XQuery query=new XQuery("\n" + "        <result> { \n" + "            for $i in distinct-values($items//itemno) \n"+ "            let $b := $bids//bid_tuple[itemno = $i] \n"+ "            let $avgbid := avg($b/bid) \n"+ "            where count($b) >= 3 \n"+ "            order by $avgbid descending \n"+ "            return <popular_item> <itemno>{ $i }</itemno> <avgbid>{ $avgbid }</avgbid> </popular_item> \n"+ "        } </result>\n"+ "      ",ctx);
  query.bind("$users",node(file("docs/users.xml")));
  query.bind("$items",node(file("docs/items.xml")));
  query.bind("$bids",node(file("docs/bids.xml")));
  final QT3Result res=result(query);
  result=res;
  test(assertSerialization("<result><popular_item><itemno>1002</itemno><avgbid>800</avgbid></popular_item><popular_item><itemno>1007</itemno><avgbid>200</avgbid></popular_item><popular_item><itemno>1001</itemno><avgbid>45</avgbid></popular_item></result>",false));
}
