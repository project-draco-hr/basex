{
  final XQuery query=new XQuery("\n" + "        <result> { \n" + "            for $highbid in $bids//bid_tuple, \n"+ "                $user in $users//user_tuple \n"+ "            where $user/userid = $highbid/userid and $highbid/bid = max($bids//bid_tuple[itemno=$highbid/itemno]/bid) \n"+ "            order by exactly-one($highbid/itemno) \n"+ "            return <high_bid> { $highbid/itemno } { $highbid/bid } \n"+ "                     <bidder>{ $user/name/text() }</bidder> \n"+ "                   </high_bid> \n"+ "        } </result>\n"+ "      ",ctx);
  try {
    query.bind("$users",node(file("docs/users.xml")));
    query.bind("$items",node(file("docs/items.xml")));
    query.bind("$bids",node(file("docs/bids.xml")));
    result=new QT3Result(query.value());
  }
 catch (  final Throwable trw) {
    result=new QT3Result(trw);
  }
 finally {
    query.close();
  }
  test(assertSerialization("<result><high_bid><itemno>1001</itemno><bid>55</bid><bidder>Mary Doe</bidder></high_bid><high_bid><itemno>1002</itemno><bid>1200</bid><bidder>Mary Doe</bidder></high_bid><high_bid><itemno>1003</itemno><bid>20</bid><bidder>Jack Sprat</bidder></high_bid><high_bid><itemno>1004</itemno><bid>40</bid><bidder>Tom Jones</bidder></high_bid><high_bid><itemno>1007</itemno><bid>225</bid><bidder>Roger Smith</bidder></high_bid></result>",false));
}
