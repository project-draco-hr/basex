{
  final XQuery query=new XQuery("\n" + "        <result> { \n" + "            let $end_dates := $items//item_tuple/end_date \n"+ "            for $m in distinct-values(\n"+ "                        for $e in $end_dates \n"+ "                        return month-from-date($e)) \n"+ "            let $item := $items//item_tuple[year-from-date(exactly-one(end_date)) = 1999 and month-from-date(exactly-one(end_date)) = $m] \n"+ "            order by $m \n"+ "            return <monthly_result> \n"+ "                    <month>{ $m }</month> \n"+ "                    <item_count>{ count($item) }</item_count>\n"+ "                   </monthly_result> \n"+ "        } </result>\n"+ "      ",ctx);
  try {
    query.bind("$users",node(file("docs/users.xml")));
    query.bind("$items",node(file("docs/items.xml")));
    query.bind("$bids",node(file("docs/bids.xml")));
    result=new QT3Result(query.value());
  }
 catch (  final Throwable trw) {
    result=new QT3Result(trw);
  }
 finally {
    query.close();
  }
  test(assertSerialization("<result><monthly_result><month>1</month><item_count>1</item_count></monthly_result><monthly_result><month>2</month><item_count>2</item_count></monthly_result><monthly_result><month>3</month><item_count>3</item_count></monthly_result><monthly_result><month>4</month><item_count>1</item_count></monthly_result><monthly_result><month>5</month><item_count>1</item_count></monthly_result></result>",false));
}
